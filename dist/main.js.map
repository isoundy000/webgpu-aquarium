{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./types.ts","webpack:///./behavior.ts","webpack:///../node_modules/dat.gui/build/dat.gui.module.js","webpack:///./buffer.ts","webpack:///./bufferManager.ts","webpack:///./glslang.ts","webpack:///./uniforms.ts","webpack:///./utils.ts","webpack:///./model.ts","webpack:///./io.ts","webpack:///./program.ts","webpack:///./resourceHelper.ts","webpack:///./stats-js.ts","webpack:///./texture.ts","webpack:///./context.ts","webpack:///./fpsTimer.ts","webpack:///./matrix.ts","webpack:///./aquarium.ts","webpack:///./main.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","BuildArray","size","itemBuilder","a","push","ASSERT","condition","message","Error","Behavior","frame","op","count","this","_frame","_op","_count","colorToString","color","forceCSSHex","colorFormat","__state","conversionName","toString","Math","round","g","b","h","toFixed","v","str","hex","length","ARR_EACH","Array","forEach","ARR_SLICE","slice","Common","BREAK","extend","target","each","arguments","obj","isObject","keys","isUndefined","defaults","compose","toCall","args","apply","itr","scope","_key","defer","fnc","setTimeout","debounce","func","threshold","callImmediately","timeout","delayed","callNow","clearTimeout","toArray","undefined","isNull","isNaN","_isNaN","_x","isArray","constructor","isNumber","isString","isBoolean","isFunction","Function","INTERPRETATIONS","litmus","conversions","THREE_CHAR_HEX","read","original","test","match","space","parseInt","write","SIX_CHAR_HEX","CSS_RGB","parseFloat","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","toReturn","interpret","family","conversion","tmpComponent","ColorMath","hsv_to_rgb","hi","floor","f","q","rgb_to_hsv","min","max","delta","NaN","rgb_to_hex","hex_with_component","component_from_hex","componentIndex","_typeof","iterator","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","props","descriptor","configurable","writable","protoProps","staticProps","receiver","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","inherits","subClass","superClass","setPrototypeOf","__proto__","possibleConstructorReturn","self","ReferenceError","Color","defineRGBComponent","component","componentHexIndex","recalculateRGB","set","defineHSVComponent","recalculateHSV","result","COMPONENTS","Controller","initialValue","domElement","document","createElement","__onChange","__onFinishChange","newValue","updateDisplay","getValue","EVENT_MAP_INV","HTMLEvents","MouseEvents","KeyboardEvents","k","e","CSS_VALUE_PIXELS","cssValueToPixels","val","dom","makeSelectable","elem","selectable","style","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","makeFullscreen","hor","vert","vertical","horizontal","position","left","right","top","bottom","fakeEvent","eventType","pars","aux","params","className","evt","createEvent","clientX","x","clientY","y","initMouseEvent","bubbles","cancelable","window","clickCount","init","initKeyboardEvent","initKeyEvent","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode","initEvent","dispatchEvent","event","newBool","bool","addEventListener","attachEvent","unbind","removeEventListener","detachEvent","addClass","classes","split","indexOf","join","replace","removeClass","removeAttribute","index","splice","hasClass","RegExp","getWidth","getComputedStyle","width","getHeight","height","getOffset","el","offset","offsetParent","offsetLeft","offsetTop","isActive","activeElement","type","href","BooleanController","_Controller","_this2","_this","__prev","__checkbox","setAttribute","setValue","appendChild","checked","OptionController","opts","options","__select","map","element","opt","innerHTML","desiredValue","selectedIndex","StringController","onChange","__input","blur","numDecimals","NumberController","_params","__min","__max","__step","step","__impliedStep","pow","log","abs","LN10","__precision","_v","minValue","maxValue","stepValue","NumberControllerBox","_NumberController","__truncationSuspended","prevY","onFinish","onMouseDrag","diff","onMouseUp","attempted","decimals","tenTo","i1","i2","o1","o2","NumberControllerSlider","preventDefault","bgRect","__background","getBoundingClientRect","onTouchMove","touches","onTouchEnd","__foreground","pct","FunctionController","text","__button","fire","ColorController","__color","__temp","__selector","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input_textShadow","onBlur","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","toOriginal","fieldRect","_ref","padding","backgroundColor","boxShadow","border","borderRadius","zIndex","borderRight","marginRight","display","cursor","background","linearGradient","cssText","outline","textAlign","fontWeight","textShadow","mismatch","flip","_flip","marginLeft","marginTop","toHexString","vendors","vendor","css","cssContent","indoc","doc","injected","head","getElementsByTagName","saveDialogContents","ControllerFactory","requestAnimationFrame$1","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","CenteredDiv","backgroundElement","opacity","WebkitTransition","transition","body","hide","webkitTransform","layout","innerWidth","innerHeight","___$insertStyle","SUPPORTS_LOCAL_STORAGE","localStorage","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","__ul","__folders","__controllers","__rememberedObjects","__rememberedObjectIndecesToControllers","__listening","closeOnTop","autoPlace","DEFAULT_WIDTH","resizable","hideable","load","preset","scrollable","root","useLocalStorage","getItem","getLocalStorageHash","saveToLocalStorage","titleRow","getRoot","gui","__preset_select","setPresetSelectIndex","revert","setWidth","closed","CLASS_CLOSED","onResize","__closeButton","TEXT_OPEN","TEXT_CLOSED","setItem","CLASS_MAIN","savedGui","JSON","parse","CLASS_CLOSE_BUTTON","CLASS_CLOSE_TOP","insertBefore","childNodes","CLASS_CLOSE_BOTTOM","titleRowName","createTextNode","addRow","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","__resizeHandler","onResizeDebounced","addResizeHandle","stringify","getSaveObject","saveToLocalStorageIfPossible","newDom","liBefore","li","removeListeners","markPresetModified","modified","recallSavedValue","controller","matchedIndex","controllerMap","remembered","presetMap","_add","factoryArgs","concat","before","__li","container","CLASS_CONTROLLER_ROW","__gui","_options","nextSibling","nextElementSibling","remove","_nextSibling","_name","firstElementChild","listen","box","method","pc","pb","returned","oldName","wasListening","newController","stopPropagation","borderLeftColor","isModified","augmentController","location","addPresetOption","setSelected","showHideExplain","explain","addSaveMenu","div","__save_row","firstChild","gears","button","button2","button3","select","getElementById","localStorageCheckBox","newConstructorTextArea","which","show","focus","save","presetName","prompt","saveAs","pmouseX","drag","dragStop","CLASS_DRAG","dragStart","__resize_handle","w","getCurrentPreset","useInitialValues","savedValues","toggleHide","CLASS_TOO_TALL","_keydownHandler","add","addColor","removeChild","destroy","subfolder","removeFolder","addFolder","newGuiParams","folders","folder","parentElement","open","close","node","offsetHeight","remember","updateDisplays","controllerArray","GUI$1","context","totalComponents","numComponents","buffer","isIndex","_stride","_offset","_size","_usage","GPUBufferUsage","INDEX","VERTEX","_totalComponents","Float32Array","sizeOfFloat","BYTES_PER_ELEMENT","bufferSize","_buf","createBuffer","COPY_DST","setBufferData","Uint16Array","sizeOfUint16","MergeTypedArrays","_head","_tail","bufferManager","super","reset","data","_bufferMappedResultBuffer","_pixels","encoder","destBuffer","src_offset","dest_offset","pixels","copyBufferToBuffer","resultBuffer","resultData","createBufferMapped","MAP_WRITE","COPY_SRC","ringBuffer","mappedData","mappedBufferList","unmap","mapWriteAsync","then","mappedArray","MapWriteCallback","BufferManager","_enqueuedBufferList","_bufferPoolSize","BUFFER_POOL_MAX_SIZE","destroyBufferPool","_find","oldSize","_usedSize","flush","BUFFER_MAX_COUNT","BUFFER_PER_ALLOCATE_SIZE","BufferManagerWebGPU","sync","createCommandEncoder","cur_offset","availableSize","shift","waitABit","allocate","copy","finish","queue","submit","dispose","reMap","glslang","worldPosition","kWorldPosition","nextPosition","kNextPosition","fishPers","arr","getAsArray","scale","time","attributeName","kPadding","uniforms","kUniforms","lightColor","kLightColor","specular","kSpecular","ambient","kAmbient","lightWorldPos","kLightWorldPos","viewProjection","kViewProjection","viewInverse","kViewInverse","world","kWorld","worldInverseTranspose","kWorldInverseTranspose","worldViewProjection","kWorldViewProjection","clone","worldUniforms","byteSize","colorAttachmentInfo","depthStencil","_colorAttachmentCount","cColorAttachments","kMaxColorAttachments","attachment","storeOp","loadValue","cDepthStencilAttachmentInfo","depthLoadValue","depthStoreOp","stencilLoadValue","stencilStoreOp","colorAttachmentIndex","colorAttachment","colorAttachments","depthStencilAttachment","device","_colorStateCount","primitiveTopology","sampleCount","vertexStage","entryPoint","fragmentStage","cRasterizationState","frontFace","cullMode","depthBias","depthBiasSlopeScale","depthBiasClamp","rasterizationState","blend","srcFactor","dstFactor","cColorStates","format","alphaBlend","colorBlend","writeMask","GPUColorWrite","ALL","colorStateCount","stencilFace","compare","failOp","depthFailOp","passOp","cDepthStencilState","depthWriteEnabled","depthCompare","stencilBack","stencilFront","stencilReadMask","stencilWriteMask","depthStencilState","colorStates","_vertexBufferCount","cVertexBuffers","kMaxVertexBuffers","cAttributes","kMaxVertexAttributes","indexFormat","shaderLocation","arrayStride","stepMode","attributes","vertexBuffers","worldmatrices","textureMap","bufferMap","_program","_blend","MODELNAME","MODELMAX","program","aquarium","_preInstance","_curInstance","_fishPerOffset","_aquarium","z","nextX","nextY","nextZ","MODELSMALLFISHA","fishInfo","fishTable","fishCount","modelName","SeaweedModel","diffuseTexture","normalTexture","reflectionTexture","skyboxTexture","positionBuffer","normalBuffer","texCoordBuffer","tangentBuffer","biNormalBuffer","indicesBuffer","lightFactorUniforms","worldUniformPer","_vertexStateDescriptor","_contextWebGPU","_programWebGPU","_instance","shininess","specularFactor","_pipeline","_groupLayoutModel","_groupLayoutPer","_pipelineLayout","_bindGroupModel","_bindGroupPer","_lightFactorBuffer","_worldBuffer","MODELGLOBEBASE","dataSize","vertexBufferCount","makeBindGroupLayout","entries","binding","visibility","GPUShaderStage","FRAGMENT","hasDynamicOffset","multisampled","viewDimension","textureComponentType","makeBasicPipelineLayout","bindGroupLayouts","groupLayoutGeneral","groupLayoutWorld","createRenderPipeline","createBufferFromData","UNIFORM","makeBindGroup","resource","sampler","textureView","updateBufferData","pass","renderPass","setPipeline","setBindGroup","bindGroupGeneral","bindGroupWorld","setVertexBuffer","setIndexBuffer","drawIndexed","_viewBuffer","calcConstantBufferByteSize","innerUniforms","eta","tankColorFudge","refractionFudge","_innerBuffer","fishVertexUniforms","_enableDynamicBufferOffset","toggleBitset","TOGGLE","ENABLEDYNAMICBUFFEROFFSET","fishLength","fishBendAmount","fishWaveLength","_fishVertexBuffer","groupLayoutFishPer","bindGroupFishPers","MODELSMALLFISHAINSTANCEDDRAWS","_fishPersBuffer","offsetof","seaweedPer","_timeBuffer","mclock","IO","url","error","xhr","XMLHttpRequest","overrideMimeType","send","readyState","responseText","onreadystatechange","success","status","arrayBuffer","response","responseType","json","vertexShaderCodePath","fragmentShaderCodePath","_vertexShaderCodePath","_fragmentShaderCodePath","_vertexShaderCode","_fragmentShaderCode","enableAlphaBlending","alpha","promises","loadshader","shaderPath","stage","Promise","resolve","reject","LoadTextFile","exception","console","SingleShaderStage","Vertex","Fragment","all","catch","_context","_vertexShaderModule","_fragmentShaderModule","enableBlending","loadProgram","createShaderModule","skyBoxUrls","ResourceHelper","path","_path","_imagePath","_programPath","_propPlacementPath","_fishBehaviorPath","skyUrls","statsjsModule","import","default","Texture","urls","_width","_height","_urls","image","imageCanvas","imageCanvasContext","getContext","translate","drawImage","src","toDataURL","flipY","images","img","Image","decode","imageFlipY","getImageData","pixelVec","imageData","bytesPerRow","ceil","Uint8ClampedArray","imagePixelIndex","_gpuTextureHelper","_textureDimension","_textureViewDimension","_format","WebGPUTextureHelper","destroyImageData","_pixelVec","_resizedVec","_textureView","_texture","_sampler","_images","loadImage","_onImageLoaded","dimension","depth","mipLevelCount","usage","GPUTextureUsage","SAMPLED","createTexture","getImagePixels","Uint8Array","bufferCopyView","createBufferCopyView","textureCopyView","createTextureCopyView","copySize","commandBuffers","copyBufferToTexture","viewDescriptor","baseMipLevel","baseArrayLayer","arrayLayerCount","createView","samplerDesc","addressModeU","addressModeV","addressModeW","minFilter","magFilter","mipmapFilter","createSampler","generateMipmappedTexture","imageBitmapSize","trunc","log2","isPowerOf2","_device","mipmapSampler","mipmapBindGroupLayout","mipmapPipeline","createPipelineLayout","code","compileGLSL","imageBitmap","createImageBitmap","textureSize","srcTexture","OUTPUT_ATTACHMENT","defaultQueue","copyImageBitmapToTexture","texture","mipmappedTexture","commandEncoder","beginRenderPass","endPass","bindGroup","createBindGroup","passEncoder","draw","copyTextureToTexture","mipLevel","_resourceHelper","_showOptionWindow","_statsIntialized","_availableToggleBitset","TOGGLEMAX","_clientWidth","_clientHeight","_statsFPS","begin","_statsFrameTime","end","canvas","vsId","fsId","fpsTimer","fisCountGetter","fisCountSetter","showPanel","parentNode","preTotalInstance","curTotalInstance","enableDynamicBufferOffset","_gui","_guiSettings","Resolution","String","clientHeight","MSAAx4","Boolean","ENABLEMSAAx4","ALPHABLENDING","ENABLEALPHABLENDING","DBO","INSTANCEDDRAWS","ENABLEINSTANCEDDRAWS","RENDERPASS","DISABLED3D12RENDERPASS","VALIDATION","DISABLEWEBGPUVALIDATION","BUFFERMAPPINGASNC","BUFFERMAPPINGASYNC","Number","counter","prop","curfishCount","fishSelection","includes","sort","fishCountMap","fishSelectionItem","onFinishChange","pointerEvents","classList","windowWidth","windowHeight","_hasWebGPUValidationErrors","_isSwapchainOutOfDate","_renderPassDescriptor","_preferredSwapChainFormat","_enableMSAA","_enableFullScreenMode","_bufferManager","_initAvailableToggleBitset","_glslang","_sceneRenderTargetView","_sceneDepthStencilView","_backbufferView","_bindGroup","_lightWorldPositionBuffer","_lightBuffer","_fogBuffer","_commandEncoder","_renderPass","_destroyFishResource","_swapChain","_canvas","_disableControlPanel","DISABLECONTROLPANEL","ENABLEFULLSCREENMODE","_syncClientSize","adapter","navigator","gpu","requestAdapter","requestDevice","glslangModule","_gpuCanvasContext","getSwapChainPreferredFormat","configureSwapChain","createMultisampledRenderTargetView","createDepthStencilView","_framebufferResizeCallback","DISCRETEGPU","INTEGRATEDGPU","TURNOFFVSYNC","SIMULATINGFISHCOMEANDGO","defaultWidth","offsetWidth","devicePixelRatio","defaultHeight","setWindowSize","loadTexture","rowsPerImage","level","origin","ext3D","srcBuffer","srcOffset","destOffset","shaderSourceGLSL","shaderType","source","transform","bindGroupLayoutdescriptor","createBindGroupLayout","pipelineLayoutDescriptor","pipelineLayout","programWebGPU","vertexStateDescriptor","enableBlend","vsModule","vertexShaderModule","fsModule","fragmentShaderModule","blendDescriptor","operation","colorStateDescriptor","vertexState","bit","start","command","bindGroupDescriptor","lightUniforms","fogUniforms","lightWorldPositionUniform","reallocResource","preFishCount","curFishCount","buf","cmd","getCurrentTexture","resolveTarget","colorAttachmentCount","renderGUI","showFPS","model","MODELGROUP","FISH","FISHINSTANCEDDRAW","GENERIC","INNER","SEAWEED","OUTSIDE","_preTotalInstance","_curTotalInstance","from","fishPersBuffer","mappedAtCreation","getMappedRange","byteLength","fishPersData","pixel","kSwapchainBackBufferUsage","_totalTime","NUM_FRAMES_TO_AVERAGE","_timeTable","_timeTableCursor","_historyFPS","NUM_HISTORY_DATA","_historyFrameTime","_logFPS","_averageFPS","_averageFrameTime","elapsedTime","renderingTime","testTime","avg","variance","FPS_VALID_THRESHOLD","Matrix","dst","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b00","b01","b02","b03","b10","b11","b12","b13","b20","b21","b22","b23","b30","b31","b32","b33","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","m33","tmp_0","tmp_1","tmp_2","tmp_3","tmp_4","tmp_5","tmp_6","tmp_7","tmp_8","tmp_9","tmp_10","tmp_11","tmp_12","tmp_13","tmp_14","tmp_15","tmp_16","tmp_17","tmp_18","tmp_19","tmp_20","tmp_21","tmp_22","tmp_23","t0","t1","t2","t3","near_","far_","dx","dy","dz","axis","off","sqrt","eye","up","subVector","normalize","cross","_randomSeed","_RANDOM_RANGE","v0","v1","v2","degrees","PI","FISHENUM","g_sceneInfo","namestr","fog","MODELMEDIUMFISHA","MODELMEDIUMFISHB","MODELBIGFISHA","MODELBIGFISHB","MODELMEDIUMFISHAINSTANCEDDRAWS","MODELMEDIUMFISHBINSTANCEDDRAWS","MODELBIGFISHAINSTANCEDDRAWS","MODELBIGFISHBINSTANCEDDRAWS","MODELARCH","MODELCORAL","MODELCORALSTONEA","MODELCORALSTONEB","MODELENVIRONMENTBOX","MODELFLOORBASE_BAKED","MODELGLOBEINNER","MODELROCKA","MODELROCKB","MODELROCKC","MODELRUINCOlOMN","MODELSTONE","MODELSUNKNSHIPBOXES","MODELSUNKNSHIPDECK","MODELSUNKNSHIPHULL","MODELSUNKNSUB","MODELSEAWEEDA","MODELSEAWEEDB","MODELSKYBOX","MODELSUPPORTBEAMS","MODELTREASURECHEST","SMALL","speed","speedRange","radius","radiusRange","tailSpeed","heightOffset","heightRange","MEDIUM","BIG","lasers","laserRot","laserOff","laserScale","g_net_offset","projection","view","worldInverse","viewProjectionInverse","skyView","skyViewProjection","skyViewProjectionInverse","eyePosition","v3t0","v3t1","m4t0","m4t1","m4t2","m4t3","colorMult","_modelEnumMap","_textureMap","_programMap","_fpsTimer","_curFishCount","_preFishCount","eyeClock","fogColor","fogPower","fogMult","fogOffset","_aquariumModels","_fisCountGetter","_fisCountSetter","availableToggleBitset","UPATEANDDRAWFOREACHMODEL","_processOptions","initialize","_calculateFishCount","_getElapsedTime","resourceHelper","getSkyBoxUrls","createTextureWebGPU","initGeneralResources","_setupModelEnumMap","loadResource","_resetFpsTime","num_fish","enable_msaa","disable_dynamic_buffer_offset","integrated_gpu","discrete_gpu","enable_full_screen_mode","print_log","PRINTLOG","buffer_mapping_async","turn_off_vsync","test_time","_testTime","AUTOSTOP","disable_webgpu_validation","enable_alpha_blending","simulating_fish_come_and_go","disable_control_panel","performance","now","shouldQuit","statsBegin","keyBoardQuit","_render","doFlush","statsEnd","terminate","_printAvgFps","_loadModels","_loadPlacement","_loadFishScenario","info","proppath","propPlacementPath","LoadJSON","objects","worldMatrix","matrix","j","modelname","MODELFIRST","enableInstanceddraw","_loadModel","fishBehaviorPath","behaviors","behave","_fishBehavior","imagePath","programPath","modelPath","getModelPath","models","createModel","textures","textureName","arrays","fields","arrayName","vec","createBufferWebGPU","programId","createProgram","compileProgram","numLeft","MAX","numfloat","temp","update","sin","cos","aspect","clientWidth","tan","degToRad","g_fieldOfView","xOff","yOff","frustum","cameraLookAt","inverse4","mulMatrixMatrix4","getAxis","mulScalarVector","addVector","updateWorldlUniforms","resetPseudoRandom","preFrame","_updateGlobalUniforms","_updateAndDrawBackground","_updateAndDrawFishes","updateFPS","_updateBackground","_updateFishes","_drawBackground","_drawFishes","_updateWorldMatrixAndDraw","numFish","prepareForDraw","fishBaseClock","fishRadius","fishRadiusRange","fishSpeed","fishSpeedRange","fishTailSpeed","fishOffset","fishHeight","fishHeightRange","fishXClock","fishYClock","fishZClock","ii","fishClock","pseudoRandom","xRadius","yRadius","zRadius","fishSpeedClock","xClock","yClock","zClock","updateFishPerUniforms","updatePerInstanceUniforms","_updateWorldMatrix","updateAllFishData","transpose4","_updateWorldProjections","runWebGPUAquarium"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\r\n * Alias type for value that can be null\r\n */\r\nexport type Nullable<T> = T | null;\r\n\r\n/**\r\n * Alias type for number that are floats\r\n */\r\nexport type float = number;\r\n\r\n/**\r\n * Alias type for number that are doubles.\r\n */\r\nexport type double = number;\r\n\r\n/**\r\n * Alias type for number that are integer\r\n */\r\nexport type int = number;\r\n\r\n/**\r\n * Alias type for number that are unsigned integer\r\n */\r\nexport type uint32_t = number;\r\nexport type size_t   = number;\r\n\r\n/**\r\n * Alias type for number array or Float32Array\r\n */\r\nexport type FloatArray = number[] | Float32Array;\r\n\r\n/**\r\n * Alias type for primitive types\r\n */\r\nexport type Primitive = undefined | null | boolean | string | number | Function;\r\n\r\n/**\r\n * Type modifier to make all the properties of an object Readonly\r\n */\r\nexport type Immutable<T> = T extends Primitive\r\n  ? T\r\n  : T extends Array<infer U>\r\n  ? ReadonlyArray<U>\r\n  : /* T extends Map<infer K, infer V> ? ReadonlyMap<K, V> : // es2015+ only */\r\n  DeepImmutable<T>;\r\n\r\n/**\r\n * Type modifier to make all the properties of an object Readonly recursively\r\n */\r\nexport type DeepImmutable<T> = T extends Primitive\r\n  ? T\r\n  : T extends Array<infer U>\r\n  ? DeepImmutableArray<U>\r\n  : /* T extends Map<infer K, infer V> ? DeepImmutableMap<K, V> : // es2015+ only */\r\n  DeepImmutableObject<T>;\r\n\r\nexport interface DeepImmutableArray<T> extends ReadonlyArray<DeepImmutable<T>> { }\r\nexport type DeepImmutableObject<T> = { readonly [K in keyof T]: DeepImmutable<T[K]> };\r\n\r\n/**\r\n * Function to merge 2 TypedArrays\r\n */\r\nexport function MergeTypedArrays(a: any, b: any) {\r\n  // Checks for truthy values on both arrays\r\n  if(!a && !b) throw 'Please specify valid arguments for parameters a and b.';  \r\n\r\n  // Checks for truthy values or empty arrays on each argument\r\n  // to avoid the unnecessary construction of a new array and\r\n  // the type comparison\r\n  if(!b || b.length === 0) return a;\r\n  if(!a || a.length === 0) return b;\r\n\r\n  // Make sure that both typed arrays are of the same type\r\n  if(Object.prototype.toString.call(a) !== Object.prototype.toString.call(b))\r\n      throw 'The types of the two arguments passed for parameters a and b do not match.';\r\n\r\n  let c = new a.constructor(a.length + b.length);\r\n  c.set(a);\r\n  c.set(b, a.length);\r\n\r\n  return c;\r\n}\r\n\r\n/**\r\n * Returns an array of the given size filled with element built from the given constructor and the paramters\r\n * @param size the number of element to construct and put in the array\r\n * @param itemBuilder a callback responsible for creating new instance of item. Called once per array entry.\r\n * @returns a new array filled with new objects\r\n */\r\nexport function BuildArray<T>(size: number, itemBuilder: () => T): Array<T> {\r\n  const a: T[] = [];\r\n  for (let i = 0; i < size; ++i) {\r\n      a.push(itemBuilder());\r\n  }\r\n  return a;\r\n}\r\n\r\n/**\r\n * Implementation of assert function.\r\n * @param condition the condition that should be true\r\n * @param message the error message\r\n */\r\nexport function ASSERT(condition: boolean, message: string) {\r\n  if (!condition) {\r\n      message = message || \"Assertion failed\";\r\n      if (typeof Error !== \"undefined\") {\r\n          throw new Error(message);\r\n      }\r\n      throw message; // Fallback\r\n  }\r\n}","import { float, int } from \"./types\";\r\n\r\n/**\r\n * Defines the base class for Behavior of specific backends.\r\n */\r\nexport class Behavior {\r\n\r\n    private _frame: int;\r\n    private _op: string;\r\n    private _count: int;\r\n\r\n    constructor(frame: int, op: string, count: int) {\r\n        this._frame = frame;\r\n        this._op    = op;\r\n        this._count = count;\r\n    }\r\n\r\n    public get frame(): int {\r\n        return this._frame;\r\n    }\r\n\r\n    public set frame(frame: int) {\r\n        this._frame = frame\r\n    }\r\n\r\n    public get op(): string {\r\n        return this._op;\r\n    }\r\n\r\n    public get count(): int {\r\n        return this._count;\r\n    }\r\n\r\n}","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n\n  return css;\n}\n\nfunction colorToString (color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return obj instanceof Function;\n  }\n};\n\nvar INTERPRETATIONS = [\n{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n},\n{\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n},\n{\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n},\n{\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n    h /= 6;\n    if (h < 0) {\n      h += 1;\n    }\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n    this.__state.a = this.__state.a || 1;\n  }\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n      this.__state.space = 'HEX';\n    }\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n  var match = val.match(CSS_VALUE_PIXELS);\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n  return 0;\n}\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n    elem.style.position = 'absolute';\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n    var evt = document.createEvent(className);\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\n          0,\n          clientX,\n          clientY,\n          false, false, false, false, 0, null);\n          break;\n        }\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = { left: 0, top: 0 };\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n    _this2.domElement.appendChild(_this2.__checkbox);\n    _this2.updateDisplay();\n    return _this2;\n  }\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n    });\n    _this2.updateDisplay();\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n    _this2.domElement.appendChild(_this2.__select);\n    return _this2;\n  }\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n    var _this = _this2;\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n  return 0;\n}\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n    var _params = params || {};\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onBlur() {\n      onFinish();\n    }\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n      prevY = e.clientY;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, { min: min, max: max, step: step }));\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n    function onMouseDrag(e) {\n      e.preventDefault();\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n      return false;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.updateDisplay();\n    _this2.__background.appendChild(_this2.__foreground);\n    _this2.domElement.appendChild(_this2.__background);\n    return _this2;\n  }\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n    _this2.domElement.appendChild(_this2.__button);\n    return _this2;\n  }\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n      this.getValue().call(this.object);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n    _this2.__saturation_field.appendChild(valueField);\n    _this2.__selector.appendChild(_this2.__field_knob);\n    _this2.__selector.appendChild(_this2.__saturation_field);\n    _this2.__selector.appendChild(_this2.__hue_field);\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n    _this2.domElement.appendChild(_this2.__input);\n    _this2.domElement.appendChild(_this2.__selector);\n    _this2.updateDisplay();\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n      _this.__color.v = v;\n      _this.__color.s = s;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n      _this.__color.h = h * 360;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    return _this2;\n  }\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n      var _flip = 255 - flip;\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n    try {\n      head.appendChild(injected);\n    } catch (e) {\n    }\n  }\n};\n\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3], step: arguments[4] });\n    }\n    return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n  }\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\nvar styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\ncss.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    return false;\n  }\n}();\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\nvar GUI = function GUI(pars) {\n  var _this = this;\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n  }\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  var titleRow = void 0;\n  Object.defineProperties(this,\n  {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n        setPresetSelectIndex(this);\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n        if (titleRow) {\n          titleRow.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n        this.onResize();\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n  if (Common.isUndefined(params.parent)) {\n    this.closed = params.closed || false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n    var titleRowName = document.createTextNode(params.name);\n    dom.addClass(titleRowName, 'controller-name');\n    titleRow = addRow(_this, titleRowName);\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n  function resetWidth() {\n    var root = _this.getRoot();\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n  if (!params.parent) {\n    resetWidth();\n  }\n};\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype,\n{\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n    var _this = this;\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n    var _this = this;\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n    var newGuiParams = { name: name, parent: this };\n    newGuiParams.autoPlace = this.autoPlace;\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n    delete this.__folders[folder.name];\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n    removeListeners(folder);\n    var _this = this;\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  hide: function hide() {\n    this.domElement.style.display = 'none';\n  },\n  show: function show() {\n    this.domElement.style.display = '';\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n    var _this = this;\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n    this.__listening.push(controller);\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n  gui.onResize();\n  return li;\n}\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller,                                   {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n      return controller;\n    }\n  });\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n      return returned;\n    };\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n    return val;\n  }, controller.setValue);\n}\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n    controllerMap[controller.property] = controller;\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n  var controller = void 0;\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n  augmentController(gui, li, controller);\n  gui.__controllers.push(controller);\n  return controller;\n}\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n  gui.__preset_select.appendChild(opt);\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar color = {\n  Color: Color,\n  math: ColorMath,\n  interpret: interpret\n};\nvar controllers = {\n  Controller: Controller,\n  BooleanController: BooleanController,\n  OptionController: OptionController,\n  StringController: StringController,\n  NumberController: NumberController,\n  NumberControllerBox: NumberControllerBox,\n  NumberControllerSlider: NumberControllerSlider,\n  FunctionController: FunctionController,\n  ColorController: ColorController\n};\nvar dom$1 = { dom: dom };\nvar gui = { GUI: GUI };\nvar GUI$1 = GUI;\nvar index = {\n  color: color,\n  controllers: controllers,\n  dom: dom$1,\n  gui: gui,\n  GUI: GUI$1\n};\n\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\nexport default index;\n//# sourceMappingURL=dat.gui.module.js.map\n","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport { Nullable, int, size_t, uint32_t, MergeTypedArrays } from \"./types\";\r\nimport { ContextWebGPU } from \"./context\";\r\n\r\n/**\r\n * Defines the abstract Buffer Class.\r\n */\r\nexport class Buffer {\r\n\r\n    public dispose(): void { }\r\n\r\n}\r\n\r\n/**\r\n * Defines the buffer wrapper of WebGPU, abstracting the vertex and index buffer binding.\r\n */\r\nexport class BufferWebGPU implements Buffer {\r\n\r\n    private _buf: GPUBuffer;\r\n    private _usage: GPUBufferUsageFlags;\r\n    private _totalComponents: size_t;\r\n    private _stride: size_t = 0;\r\n    private _offset: int = 0;\r\n    private _size: size_t = 0;\r\n\r\n    constructor(context: Nullable<ContextWebGPU>,\r\n                totalComponents: int,\r\n                numComponents: int,\r\n                buffer: Float32Array | Uint16Array,\r\n                isIndex: boolean) {\r\n        this._usage = isIndex ? GPUBufferUsage.INDEX : GPUBufferUsage.VERTEX;\r\n        this._totalComponents = totalComponents\r\n\r\n        if (buffer instanceof Float32Array) {\r\n            const sizeOfFloat: size_t = buffer.BYTES_PER_ELEMENT; // float size => 4 bytes\r\n            this._size = numComponents * sizeOfFloat;\r\n            // Create buffer for vertex buffer. Because float is multiple of 4 bytes, dummy padding isnt' needed.\r\n            const bufferSize: uint32_t = sizeOfFloat * buffer.length;\r\n            this._buf                  = context.createBuffer(bufferSize, this._usage | GPUBufferUsage.COPY_DST);\r\n\r\n            context.setBufferData(this._buf, 0, bufferSize, buffer);\r\n        }\r\n        else if (buffer instanceof Uint16Array) {\r\n            const sizeOfUint16: size_t = buffer.BYTES_PER_ELEMENT; // Uint16 size => 2 bytes\r\n            this._size = numComponents * sizeOfUint16;\r\n            // Create buffer for index buffer. Because unsigned short is multiple of 2 bytes, in order to align\r\n            // with 4 bytes of dawn metal, dummy padding need to be added.\r\n            if (this._totalComponents % 2 !== 0)\r\n            {\r\n                const dummyPadding: Uint16Array = new Uint16Array([0.0]);\r\n                buffer = MergeTypedArrays(buffer, dummyPadding);\r\n            }\r\n\r\n            const bufferSize: uint32_t = sizeOfUint16 * buffer.length;\r\n            this._buf                  = context.createBuffer(bufferSize, this._usage | GPUBufferUsage.COPY_DST);\r\n\r\n            context.setBufferData(this._buf, 0, bufferSize, buffer);\r\n        }\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._buf = null;\r\n    }\r\n\r\n    public get buffer(): GPUBuffer {\r\n        return this._buf;\r\n    }\r\n\r\n    public get totalComponents(): size_t {\r\n        return this._totalComponents;\r\n    }\r\n\r\n    public get stride(): size_t {\r\n        return this._stride;\r\n    }\r\n\r\n    public get offset(): int {\r\n        return this._offset;\r\n    }\r\n\r\n    public get usageBit(): GPUBufferUsageFlags {\r\n        return this._usage;\r\n    }\r\n\r\n    public get dataSize(): int {\r\n        return this._size;\r\n    }\r\n\r\n}","import { ASSERT, Nullable, int, size_t } from \"./types\";\r\nimport { ContextWebGPU } from \"./context\";\r\n\r\n/**\r\n * Defines an abstract RingBuffer Class.\r\n */\r\nexport class RingBuffer {\r\n\r\n    protected _head: size_t = 0;\r\n    protected _tail: size_t = 0;\r\n    protected _size: size_t = 0;\r\n\r\n    constructor(size: size_t) {\r\n        this._tail = size;\r\n        this._size = size;\r\n    }\r\n\r\n    public dispose(): void { }\r\n\r\n    public get size(): size_t {\r\n        return this._size;\r\n    }\r\n\r\n    public get availableSize(): size_t {\r\n        return this._size - this._tail;\r\n    }\r\n\r\n    public reset(size: size_t): boolean {\r\n        return false;\r\n    }\r\n\r\n    public flush() {}\r\n    public destroy() {}\r\n\r\n    /**\r\n     * Allocate size in a RingBuffer, return offset of the buffer.\r\n     */\r\n    public allocate(size: size_t): size_t {\r\n        return 0;\r\n    }\r\n\r\n}\r\n\r\nexport class RingBufferWebGPU extends RingBuffer {\r\n\r\n    private _bufferMappedResultBuffer: GPUBuffer;\r\n    private _pixels: ArrayBuffer;\r\n\r\n    public bufferManager: Nullable<BufferManagerWebGPU> = null;\r\n    \r\n    constructor(bufferManager: Nullable<BufferManagerWebGPU>, size: size_t) {\r\n        super(size);\r\n        this.bufferManager = bufferManager;\r\n\r\n        this.reset(size);\r\n    }\r\n\r\n    public set mappedData(data: [GPUBuffer, ArrayBuffer]) {\r\n        this._bufferMappedResultBuffer = data[0];\r\n        this._pixels = data[1];\r\n    }\r\n\r\n    public push(encoder: GPUCommandEncoder,\r\n                destBuffer: GPUBuffer,\r\n                src_offset: size_t,\r\n                dest_offset: size_t,\r\n                pixels: Float32Array | Uint16Array,\r\n                size: size_t): boolean {\r\n        const writeArray = pixels instanceof Uint16Array ? new Uint16Array(this._pixels) : new Float32Array(this._pixels);\r\n        writeArray.set(pixels);\r\n        \r\n        encoder.copyBufferToBuffer(this._bufferMappedResultBuffer, src_offset, destBuffer, dest_offset,\r\n                                   size);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Reset current buffer and reuse the buffer.\r\n     */\r\n    public reset(size: size_t): boolean {\r\n        if (size > this.size) {\r\n            return false;\r\n        }\r\n\r\n        this._head = 0;\r\n        this._tail = 0;\r\n\r\n        let [resultBuffer, resultData] = this.bufferManager.context.createBufferMapped(size, GPUBufferUsage.MAP_WRITE | GPUBufferUsage.COPY_SRC);\r\n        this._bufferMappedResultBuffer = resultBuffer;\r\n        this._pixels = resultData;\r\n\r\n        return true;\r\n    }\r\n\r\n    public static MapWriteCallback(data: [GPUBuffer, ArrayBuffer], ringBuffer: Nullable<RingBufferWebGPU>): void {\r\n        ASSERT(data !== null, \"Invalid data in MapWriteCallback function.\")\r\n\r\n        ringBuffer.mappedData = data;\r\n        ringBuffer.bufferManager.mappedBufferList.push(ringBuffer);\r\n    }\r\n\r\n    public flush(): void {\r\n        this._head = 0;\r\n        this._tail = 0;\r\n\r\n        this._bufferMappedResultBuffer.unmap();\r\n    }\r\n\r\n    public destroy() {\r\n        this._bufferMappedResultBuffer = null;\r\n    }\r\n\r\n    public reMap() {      \r\n        this._bufferMappedResultBuffer.mapWriteAsync().then((mappedArray) => {\r\n            RingBufferWebGPU.MapWriteCallback([this._bufferMappedResultBuffer, mappedArray], this);\r\n        });\r\n    }\r\n\r\n    public allocate(size: size_t): size_t {\r\n        this._tail += size;\r\n        ASSERT(this._tail < this._size, \"Unable to allocate the requested memory size.\");\r\n\r\n        return this._tail - size;\r\n    }\r\n}\r\n\r\n/**\r\n * Implements a buffer pool to manage buffer allocation and recycle.\r\n */\r\nexport class BufferManager {\r\n\r\n    public static readonly BUFFER_POOL_MAX_SIZE: size_t    = 409600000;\r\n    public static readonly BUFFER_MAX_COUNT: size_t        = 10;\r\n    public static readonly BUFFER_PER_ALLOCATE_SIZE: size_t = BufferManager.BUFFER_POOL_MAX_SIZE / BufferManager.BUFFER_MAX_COUNT;\r\n\r\n    public mappedBufferList: Array<Nullable<RingBuffer>> = new Array<Nullable<RingBuffer>>();\r\n    \r\n    protected _enqueuedBufferList: Array<Nullable<RingBuffer>> = new Array<Nullable<RingBuffer>>();\r\n    protected _bufferPoolSize: size_t;\r\n    protected _usedSize: size_t;\r\n    protected _count: size_t;\r\n\r\n    constructor() {\r\n        this._bufferPoolSize = BufferManager.BUFFER_POOL_MAX_SIZE;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this.destroyBufferPool();\r\n    }\r\n\r\n    public get size(): size_t {\r\n        return this._bufferPoolSize;\r\n    }\r\n\r\n    public resetBuffer(ringBuffer: Nullable<RingBuffer>, size: size_t): boolean {\r\n        const index: int = this._find(ringBuffer);\r\n        \r\n        if (index === -1) {\r\n            return false;\r\n        }\r\n        \r\n        const oldSize: size_t = ringBuffer.size;\r\n\r\n        const result: boolean = ringBuffer.reset(size);\r\n        // If the size is larger than the ring buffer size, reset fails and the ring\r\n        // buffer retains.\r\n        // If the size is equal or smaller than the ring buffer size, reset success\r\n        // and the used size need to be updated.\r\n        if (!result) {\r\n            return false;\r\n        }\r\n        else {\r\n            this._usedSize = this._usedSize - oldSize + size;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public destroyBuffer(ringBuffer: Nullable<RingBuffer>): boolean {\r\n        const index: int = this._find(ringBuffer);\r\n\r\n        if (index === -1) {\r\n            return false;\r\n        }\r\n\r\n        this._usedSize -= ringBuffer.size;\r\n        ringBuffer.destroy();\r\n        this._enqueuedBufferList.splice(index, 1);\r\n\r\n        return true;\r\n    }\r\n\r\n    private _find(ringBuffer: Nullable<RingBuffer>): int {\r\n        if (this._enqueuedBufferList.length > 0) {\r\n            return this._enqueuedBufferList.indexOf(ringBuffer);\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    public destroyBufferPool(): void { }\r\n\r\n    /**\r\n     * Flush copy commands in buffer pool\r\n     */\r\n    public flush(): void {\r\n        for (let buffer of this._enqueuedBufferList) {\r\n            buffer.flush();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Allocate new buffer from buffer pool. \r\n     */\r\n    public allocate(size: size_t, offset: size_t): {buffer: Nullable<RingBuffer>, offset: size_t} {\r\n        return null;\r\n    }\r\n\r\n}\r\n\r\nexport class BufferManagerWebGPU extends BufferManager {\r\n\r\n    public encoder: GPUCommandEncoder;\r\n    public context: Nullable<ContextWebGPU> = null;\r\n    public sync;\r\n\r\n    constructor(context: Nullable<ContextWebGPU>, sync: boolean) {\r\n        super();\r\n        this.context = context;\r\n        this.sync = sync;\r\n\r\n        this.encoder = context.createCommandEncoder();\r\n    }\r\n\r\n    public dispose() {\r\n        this.encoder = null;\r\n    }\r\n\r\n    /**\r\n     * Allocate new buffer from buffer pool. \r\n     */\r\n    public allocate(size: size_t, offset: size_t): {buffer: Nullable<RingBufferWebGPU>, offset: size_t} {\r\n        // If update data by sync method, create new buffer to upload every frame.\r\n        // If updaye data by async method, get new buffer from pool if available. If no available\r\n        // buffer and size is enough in the buffer pool, create a new buffer. If size reach the\r\n        // limit of the buffer pool, force wait for the buffer on mapping.\r\n        // Get the last one and check if the ring buffer is full. If the buffer can hold extra\r\n        // size space, use the last one directly.\r\n        \r\n        let ringBuffer: Nullable<RingBufferWebGPU> = null;\r\n        let cur_offset: size_t               = 0;\r\n        if (this.sync) {\r\n            // Upper limit\r\n            if (this._usedSize + size > this._bufferPoolSize) {\r\n                return {\r\n                    buffer: ringBuffer,\r\n                    offset: offset\r\n                };\r\n            }\r\n\r\n            ringBuffer = new RingBufferWebGPU(this, size);\r\n            this._enqueuedBufferList.push(ringBuffer);\r\n        }\r\n        else {  // Buffer mapping async\r\n            while (this.mappedBufferList.length > 0) {\r\n                ringBuffer = this.mappedBufferList[0] as Nullable<RingBufferWebGPU>;\r\n                if (ringBuffer.availableSize < size) {\r\n                    this.mappedBufferList.shift(),\r\n                    ringBuffer = null;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (ringBuffer == null) {\r\n                if (this._count < BufferManager.BUFFER_MAX_COUNT) {\r\n                    this._usedSize += size;\r\n                    ringBuffer = new RingBufferWebGPU(this, BufferManager.BUFFER_PER_ALLOCATE_SIZE);\r\n                    this.mappedBufferList.push(ringBuffer);\r\n                    this._count++;\r\n                }\r\n                else if (this.mappedBufferList.length + this._enqueuedBufferList.length < this._count) {\r\n                    // Force wait for the buffer remapping\r\n                    while (this.mappedBufferList.length === 0) {\r\n                        this.context.waitABit();\r\n                    }\r\n\r\n                    ringBuffer = this.mappedBufferList[0] as Nullable<RingBufferWebGPU>;\r\n                    if (ringBuffer.availableSize < size) {\r\n                        this.mappedBufferList.shift();\r\n                        ringBuffer = null;\r\n                    }\r\n                }\r\n                else { // Upper limit\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            if (this._enqueuedBufferList.length === 0\r\n                || this._enqueuedBufferList[this._enqueuedBufferList.length-1] != ringBuffer) {\r\n                this._enqueuedBufferList.push(ringBuffer);\r\n            }\r\n\r\n            // allocate size in the ring buffer\r\n            cur_offset = ringBuffer.allocate(size);\r\n            offset = cur_offset;\r\n        }\r\n\r\n        return {\r\n            buffer: ringBuffer,\r\n            offset: offset\r\n        };\r\n    }\r\n\r\n    public flush(): void {\r\n        // The front buffer in MappedBufferList will be remap after submit, pop the buffer from\r\n        // MappedBufferList.\r\n        if (this.mappedBufferList.length > 0\r\n            && this._enqueuedBufferList[this._enqueuedBufferList.length-1] === this.mappedBufferList[0]) {\r\n            this.mappedBufferList.shift(); // Stack pop\r\n        }\r\n\r\n        for (let buffer of this._enqueuedBufferList) {\r\n            buffer.flush();\r\n        }\r\n\r\n        const copy: GPUCommandBuffer = this.encoder.finish();\r\n        this.context.queue.submit([copy]);\r\n\r\n        // Async function\r\n        if (!this.sync) {\r\n            for (let index: size_t = 0; index < this._enqueuedBufferList.length; ++index) {\r\n                const ringBuffer: Nullable<RingBufferWebGPU> = this._enqueuedBufferList[index] as Nullable<RingBufferWebGPU>;\r\n                ringBuffer.reMap();\r\n            }\r\n        }\r\n        else {\r\n            // All buffers are used once in buffer sync mode.\r\n            for (let index: size_t = 0; index < this._enqueuedBufferList.length; ++index) {\r\n                const ringBuffer: Nullable<RingBufferWebGPU> = this._enqueuedBufferList[index] as Nullable<RingBufferWebGPU>;\r\n                ringBuffer.dispose();\r\n            }\r\n            this._usedSize = 0;\r\n        }\r\n\r\n        this._enqueuedBufferList.length = 0;\r\n        this.encoder = this.context.createCommandEncoder();\r\n    }\r\n\r\n    public destroyBufferPool(): void {\r\n        if (!this.sync) {\r\n            return;\r\n        }\r\n\r\n        for (let ringBuffer of this._enqueuedBufferList) {\r\n            ringBuffer.destroy();\r\n        }\r\n        this._enqueuedBufferList.length = 0;\r\n    }\r\n\r\n}","let glslang = undefined;\r\nexport default async function() {\r\n  if (glslang !== undefined) return glslang;\r\n  // @ts-ignore\r\n  const glslangModule = await import(/* webpackIgnore: true */ 'https://unpkg.com/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js');\r\n  glslang = await glslangModule.default();\r\n  return glslang;\r\n}\r\n","import { float, size_t, BuildArray, uint32_t } from \"./types\";\r\n\r\n\r\nexport class FishPer {\r\n\r\n    public static readonly kWorldPosition: size_t = 3;\r\n    public static readonly kNextPosition: size_t = 3;\r\n\r\n    public worldPosition: Array<float>;\r\n    public scale: float;\r\n    public nextPosition: Array<float>;\r\n    public time: float;\r\n\r\n    constructor() {\r\n        this.worldPosition = BuildArray(FishPer.kWorldPosition, () => 0.0)\r\n        this.nextPosition  = BuildArray(FishPer.kNextPosition, () => 0.0)\r\n    }\r\n\r\n    public static toArray(fishPers: Array<FishPer>): Array<float> {\r\n        let arr: Array<float> = [];\r\n        for (let i = 0; i < fishPers.length; ++i) {\r\n            arr = arr.concat(fishPers[i].getAsArray());\r\n        }\r\n        return arr;\r\n    }\r\n\r\n    public getAsArray(): Array<float> {\r\n        return this.worldPosition.concat(this.scale, this.nextPosition, this.time);\r\n    }\r\n\r\n    public static offsetof(attributeName: string): size_t {\r\n        let offset: size_t = 0;\r\n        switch(attributeName) {\r\n            case \"worldPosition\":\r\n                offset = 0;\r\n                break;\r\n            case \"scale\":\r\n                offset = FishPer.kWorldPosition;\r\n                break;\r\n            case \"nextPosition\":\r\n                offset = FishPer.kWorldPosition + 1;\r\n                break;\r\n            case \"time\":\r\n                offset = FishPer.kWorldPosition + 1 + FishPer.kNextPosition;\r\n                break;\r\n        }\r\n        return offset * 4; // sizeof(float) = 4\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.getAsArray());\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return (FishPer.kWorldPosition + 1 + FishPer.kNextPosition + 1) * 4;\r\n    }\r\n}\r\n\r\nexport class FishPerWithPadding {\r\n\r\n    public static readonly kWorldPosition: size_t = 3;\r\n    public static readonly kNextPosition: size_t = 3;\r\n    public static readonly kPadding: size_t = 56;\r\n\r\n    public worldPosition: Array<float>;\r\n    public scale: float;\r\n    public nextPosition: Array<float>;\r\n    public time: float;\r\n    public padding: Array<float>;\r\n\r\n    constructor() {\r\n        this.worldPosition = BuildArray(FishPerWithPadding.kWorldPosition, () => 0.0)\r\n        this.nextPosition  = BuildArray(FishPerWithPadding.kNextPosition, () => 0.0)\r\n        this.padding  = BuildArray(FishPerWithPadding.kPadding, () => 0.0)\r\n    }\r\n\r\n    public getAsArray(): Array<float> {\r\n        return this.worldPosition.concat(this.scale, this.nextPosition, this.time, this.padding);\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.getAsArray());\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return (FishPer.kWorldPosition + 1 + FishPer.kNextPosition + 1 + FishPerWithPadding.kPadding) * 4;\r\n    }\r\n}\r\n\r\n/**\r\n * Defines the fish vertex uniforms of the fish model of WebGPU.\r\n */\r\nexport class FishVertexUniforms {\r\n\r\n    public static readonly kUniforms: size_t = 3;\r\n\r\n    // Uniforms array: [fishLength, fishWaveLength, fishBendAmount]\r\n    public uniforms: Array<float>;\r\n\r\n    constructor() {\r\n        this.uniforms = BuildArray(FishVertexUniforms.kUniforms, () => 0.0);\r\n    }\r\n\r\n    public get fishLength(): float {\r\n        return this.uniforms[0];\r\n    }\r\n\r\n    public set fishLength(value: float) {\r\n        this.uniforms[0] = value;\r\n    }\r\n\r\n    public get fishWaveLength(): float {\r\n        return this.uniforms[1];\r\n    }\r\n\r\n    public set fishWaveLength(value: float) {\r\n        this.uniforms[1] = value;\r\n    }\r\n\r\n    public get fishBendAmount(): float {\r\n        return this.uniforms[2];\r\n    }\r\n\r\n    public set fishBendAmount(value: float) {\r\n        this.uniforms[2] = value;\r\n    }\r\n\r\n    public get data() {\r\n        return new Float32Array(this.uniforms);\r\n    }\r\n\r\n    public static get byteSize() {\r\n        return FishVertexUniforms.kUniforms * 4;\r\n    }\r\n}\r\n\r\nexport class FogUniforms {\r\n\r\n    public static readonly kUniforms: size_t = 8;\r\n\r\n    // Uniforms array: [fogPower, fogMult, fogOffset, padding, fogColor[4]]\r\n    public uniforms: Array<float>;\r\n\r\n    constructor() {\r\n        this.uniforms = BuildArray(FogUniforms.kUniforms, () => 0.0);\r\n    }\r\n\r\n    public get fogPower(): float {\r\n        return this.uniforms[0];\r\n    }\r\n\r\n    public set fogPower(value: float) {\r\n        this.uniforms[0] = value;\r\n    }\r\n\r\n    public get fogMult(): float {\r\n        return this.uniforms[1];\r\n    }\r\n\r\n    public set fogMult(value: float) {\r\n        this.uniforms[1] = value;\r\n    }\r\n\r\n    public get fogOffset(): float {\r\n        return this.uniforms[2];\r\n    }\r\n\r\n    public set fogOffset(value: float) {\r\n        this.uniforms[2] = value;\r\n    }\r\n\r\n    public get padding(): float {\r\n        return this.uniforms[3];\r\n    }\r\n\r\n    public set padding(value: float) {\r\n        this.uniforms[3] = value;\r\n    }\r\n\r\n    public get fogColor(): Array<float> {\r\n        return this.uniforms.slice(4);\r\n    }\r\n\r\n    public set fogColor(value: Array<float>) {\r\n        this.uniforms[4] = value[0];\r\n        this.uniforms[5] = value[1];\r\n        this.uniforms[6] = value[2];\r\n        this.uniforms[7] = value[3];\r\n    }\r\n\r\n    public get data() {\r\n        return new Float32Array(this.uniforms);\r\n    }\r\n\r\n    public static get byteSize() {\r\n        return FogUniforms.kUniforms * 4;\r\n    }\r\n}\r\n\r\n/**\r\n * Defines the inner uniforms.\r\n */\r\nexport class InnerUniforms {\r\n\r\n    public static readonly kUniforms: size_t = 4;\r\n\r\n    // Uniforms array: [eta, tankColorFudge, refractionFudge, padding]\r\n    public uniforms: Array<float>;\r\n\r\n    constructor() {\r\n        this.uniforms = BuildArray(InnerUniforms.kUniforms, () => 0.0);\r\n    }\r\n\r\n    public get eta(): float {\r\n        return this.uniforms[0];\r\n    }\r\n\r\n    public set eta(value: float) {\r\n        this.uniforms[0] = value;\r\n    }\r\n\r\n    public get tankColorFudge(): float {\r\n        return this.uniforms[1];\r\n    }\r\n\r\n    public set tankColorFudge(value: float) {\r\n        this.uniforms[1] = value;\r\n    }\r\n\r\n    public get refractionFudge(): float {\r\n        return this.uniforms[2];\r\n    }\r\n\r\n    public set refractionFudge(value: float) {\r\n        this.uniforms[2] = value;\r\n    }\r\n\r\n    public get padding(): float {\r\n        return this.uniforms[3];\r\n    }\r\n\r\n    public set padding(value: float) {\r\n        this.uniforms[3] = value;\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.uniforms);\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return InnerUniforms.kUniforms * 4;\r\n    }\r\n}\r\n\r\n/**\r\n * Defines the light factor uniforms.\r\n */\r\nexport class LightFactorUniforms {\r\n\r\n    public static readonly kUniforms: size_t = 2;\r\n\r\n    // Uniforms array: [shininess, specularFactor]\r\n    public uniforms: Array<float>;\r\n\r\n    constructor() {\r\n        this.uniforms = BuildArray(LightFactorUniforms.kUniforms, () => 0.0);\r\n    }\r\n\r\n    public get shininess(): float {\r\n        return this.uniforms[0];\r\n    }\r\n\r\n    public set shininess(value: float) {\r\n        this.uniforms[0] = value;\r\n    }\r\n\r\n    public get specularFactor(): float {\r\n        return this.uniforms[1];\r\n    }\r\n\r\n    public set specularFactor(value: float) {\r\n        this.uniforms[1] = value;\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.uniforms);\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return LightFactorUniforms.kUniforms * 4;\r\n    }\r\n}\r\n\r\nexport class LightUniforms {\r\n\r\n    public static readonly kLightColor: size_t = 4;\r\n    public static readonly kSpecular: size_t = 4;\r\n    public static readonly kAmbient: size_t = 4;\r\n\r\n    public lightColor: Array<float>;\r\n    public specular: Array<float>;\r\n    public ambient: Array<float>;\r\n\r\n    constructor() {\r\n        this.lightColor = BuildArray(LightUniforms.kLightColor, () => 0.0);\r\n        this.specular = BuildArray(LightUniforms.kSpecular, () => 0.0);\r\n        this.ambient = BuildArray(LightUniforms.kAmbient, () => 0.0);\r\n    }\r\n\r\n    public getAsArray(): Array<float> {\r\n        return this.lightColor.concat(this.specular, this.ambient);\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.getAsArray());\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return (LightUniforms.kLightColor + LightUniforms.kSpecular + LightUniforms.kAmbient) * 4;\r\n    }\r\n}\r\n\r\nexport class LightWorldPositionUniform {\r\n\r\n    public static readonly kLightWorldPos: size_t = 3;\r\n    public static readonly kViewProjection: size_t = 16;\r\n    public static readonly kViewInverse: size_t = 16;\r\n\r\n    public lightWorldPos: Array<float>;\r\n    public padding: float;\r\n    public viewProjection: Array<float>;\r\n    public viewInverse: Array<float>;\r\n\r\n    constructor() {\r\n        this.lightWorldPos = BuildArray(LightWorldPositionUniform.kLightWorldPos, () => 0.0);\r\n        this.padding = 0;\r\n        this.viewProjection  = BuildArray(LightWorldPositionUniform.kViewProjection, () => 0.0);\r\n        this.viewInverse  = BuildArray(LightWorldPositionUniform.kViewInverse, () => 0.0);\r\n    }\r\n\r\n    public getAsArray(): Array<float> {\r\n        return this.lightWorldPos.concat(this.padding, this.viewProjection, this.viewInverse);\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.getAsArray());\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return (LightWorldPositionUniform.kLightWorldPos + 1 + LightWorldPositionUniform.kViewProjection + LightWorldPositionUniform.kViewInverse) * 4;\r\n    }\r\n}\r\n\r\nexport class SeaweedPer {\r\n\r\n    // Uniforms array: [time]\r\n    public uniforms: Array<float>;\r\n\r\n    constructor() {\r\n        this.uniforms = BuildArray(\r\n            20, () => 0.0\r\n        );\r\n    }\r\n\r\n    public get time(): Array<float> {\r\n        return this.uniforms;\r\n    }\r\n\r\n    public set time(value: Array<float>) {\r\n        this.uniforms = value;\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.uniforms);\r\n    }\r\n\r\n    public get byteSize(): size_t {\r\n        return this.uniforms.length * 4;\r\n    }\r\n}\r\n\r\nexport class WorldUniforms {\r\n\r\n    public static readonly kWorld: size_t = 16;\r\n    public static readonly kWorldInverseTranspose: size_t = 16;\r\n    public static readonly kWorldViewProjection: size_t = 16;\r\n\r\n    public world: Array<float>;\r\n    public worldInverseTranspose: Array<float>;\r\n    public worldViewProjection: Array<float>;\r\n\r\n    constructor() {\r\n        this.world = BuildArray(WorldUniforms.kWorld, () => 0.0);\r\n        this.worldInverseTranspose = BuildArray(WorldUniforms.kWorldInverseTranspose, () => 0.0);\r\n        this.worldViewProjection = BuildArray(WorldUniforms.kWorldViewProjection, () => 0.0);\r\n    }\r\n\r\n    public getAsArray(): Array<float> {\r\n        return this.world.concat(this.worldInverseTranspose, this.worldViewProjection);\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        return new Float32Array(this.getAsArray());\r\n    }\r\n\r\n    public static get byteSize(): size_t {\r\n        return (WorldUniforms.kWorld + WorldUniforms.kWorldInverseTranspose + WorldUniforms.kWorldViewProjection) * 4;\r\n    }\r\n    \r\n    public clone(): WorldUniforms {\r\n        const clone: WorldUniforms = new WorldUniforms();\r\n        clone.world = this.world.slice();\r\n        clone.worldInverseTranspose = this.worldInverseTranspose.slice();\r\n        clone.worldViewProjection = this.worldViewProjection.slice();\r\n        return clone;\r\n    }\r\n\r\n}\r\n\r\nexport class WorldUniformPer {\r\n\r\n    // Uniforms array: [worldUniforms..]\r\n    public worldUniforms: Array<WorldUniforms>;\r\n\r\n    constructor() {\r\n        this.worldUniforms = BuildArray(\r\n            20, () => new WorldUniforms()\r\n        );\r\n    }\r\n\r\n    public get data(): Float32Array {\r\n        let arr: Array<float> = [];\r\n        for (let i: size_t = 0; i < this.worldUniforms.length; ++i) {\r\n            arr = arr.concat(this.worldUniforms[i].getAsArray());\r\n        }\r\n        return new Float32Array(arr);\r\n    }\r\n\r\n    public get byteSize(): size_t {\r\n        return WorldUniforms.byteSize * this.worldUniforms.length;\r\n    }\r\n}","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport { BuildArray, int, size_t, uint32_t } from \"./types\";\r\n\r\nexport class ComboRenderPassDescriptor implements GPURenderPassDescriptor {\r\n\r\n    public static readonly kMaxColorAttachments: size_t = 4;\r\n\r\n    public colorAttachments: Array<GPURenderPassColorAttachmentDescriptor>;\r\n    public depthStencilAttachment?: GPURenderPassDepthStencilAttachmentDescriptor;\r\n\r\n    public cColorAttachments: Array<GPURenderPassColorAttachmentDescriptor>;\r\n    public cDepthStencilAttachmentInfo?: GPURenderPassDepthStencilAttachmentDescriptor;\r\n\r\n    public _colorAttachmentCount: uint32_t = 0;\r\n\r\n    constructor(colorAttachmentInfo: Array<GPUTextureView>, depthStencil?: GPUTextureView) {\r\n        this.cColorAttachments = BuildArray(\r\n            ComboRenderPassDescriptor.kMaxColorAttachments,\r\n            () => <GPURenderPassColorAttachmentDescriptor>{}\r\n        );\r\n\r\n        for (let i: uint32_t = 0; i < ComboRenderPassDescriptor.kMaxColorAttachments; ++i) {\r\n            this.cColorAttachments[i].attachment = undefined;\r\n            this.cColorAttachments[i].storeOp = \"store\";\r\n            this.cColorAttachments[i].loadValue = <GPUColorDict>{\r\n                r: 0.0,\r\n                g: 0.0,\r\n                b: 0.0,\r\n                a: 0.0\r\n            };\r\n        }\r\n\r\n        this.cDepthStencilAttachmentInfo = <GPURenderPassDepthStencilAttachmentDescriptor> {\r\n            depthLoadValue: 1.0,\r\n            depthStoreOp: \"store\",\r\n            stencilLoadValue: 0,\r\n            stencilStoreOp: \"store\"\r\n        }\r\n\r\n        this._colorAttachmentCount = colorAttachmentInfo.length;\r\n        let colorAttachmentIndex: uint32_t = 0;\r\n        for (let colorAttachment of colorAttachmentInfo) {\r\n            if (colorAttachment) {\r\n                this.cColorAttachments[colorAttachmentIndex].attachment = colorAttachment;\r\n            }\r\n            ++colorAttachmentIndex;\r\n        }\r\n        this.colorAttachments = this.cColorAttachments\r\n\r\n        if (depthStencil) {\r\n            this.cDepthStencilAttachmentInfo.attachment = depthStencil;\r\n            this.depthStencilAttachment = this.cDepthStencilAttachmentInfo;\r\n        }\r\n        else {\r\n            this.depthStencilAttachment = undefined;\r\n        }\r\n    }\r\n\r\n    public set colorAttachmentCount(value: uint32_t) {\r\n        this._colorAttachmentCount = value;\r\n        this.colorAttachments = this.cColorAttachments.slice(0, this._colorAttachmentCount);\r\n    }\r\n\r\n}\r\n\r\nexport class ComboRenderPipelineDescriptor implements GPUPipelineDescriptorBase, GPURenderPipelineDescriptor {\r\n\r\n    public static readonly kMaxColorAttachments: size_t = 4;\r\n\r\n    public label?: string;\r\n    public layout?: GPUPipelineLayout;\r\n\r\n    public vertexStage: GPUProgrammableStageDescriptor;\r\n    public fragmentStage?: GPUProgrammableStageDescriptor;\r\n\r\n    public primitiveTopology: GPUPrimitiveTopology;\r\n    public rasterizationState?: GPURasterizationStateDescriptor;\r\n    public colorStates: Iterable<GPUColorStateDescriptor>;\r\n    public depthStencilState?: GPUDepthStencilStateDescriptor;\r\n    public vertexState?: GPUVertexStateDescriptor;\r\n\r\n    public sampleCount?: number;\r\n    public sampleMask?: number;\r\n    public alphaToCoverageEnabled?: boolean;\r\n\r\n    public cColorStates: Array<GPUColorStateDescriptor>;\r\n    public cDepthStencilState?: GPUDepthStencilStateDescriptor;\r\n    public cRasterizationState?: GPURasterizationStateDescriptor;\r\n\r\n    private _colorStateCount: uint32_t = 0;\r\n\r\n    constructor(device: GPUDevice) {\r\n        const descriptor = this;\r\n\r\n        descriptor.primitiveTopology = \"triangle-list\";\r\n        descriptor.sampleCount = 1;\r\n\r\n        // Set defaults for the vertex stage descriptor.\r\n        descriptor.vertexStage = <GPUProgrammableStageDescriptor> {\r\n            entryPoint: \"main\"\r\n        };\r\n\r\n        // Set defaults for the fragment stage desriptor.\r\n        descriptor.fragmentStage = <GPUProgrammableStageDescriptor> {\r\n            entryPoint: \"main\"\r\n        };\r\n\r\n        // Set defaults for the rasterization state descriptor.\r\n        this.cRasterizationState = <GPURasterizationStateDescriptor> {\r\n            frontFace: \"ccw\",\r\n            cullMode: \"none\",\r\n            depthBias: 0,\r\n            depthBiasSlopeScale: 0.0,\r\n            depthBiasClamp: 0.0\r\n        };\r\n        descriptor.rasterizationState = this.cRasterizationState;\r\n\r\n        // Set defaults for the color state descriptors.\r\n        const blend: GPUBlendDescriptor = {\r\n            srcFactor: \"src-alpha\",\r\n            dstFactor: \"one-minus-src-alpha\"\r\n        };\r\n        this.cColorStates = BuildArray(\r\n            ComboRenderPipelineDescriptor.kMaxColorAttachments,\r\n            () => <GPUColorStateDescriptor> {\r\n                format: \"rgba8unorm\",\r\n                alphaBlend: blend,\r\n                colorBlend: blend,\r\n                writeMask: GPUColorWrite.ALL\r\n            }\r\n        );\r\n        descriptor.colorStateCount = 1;\r\n        \r\n        // Set defaults for the depth stencil state descriptors.\r\n        const stencilFace: GPUStencilStateFaceDescriptor = {\r\n            compare: \"always\",\r\n            failOp: \"keep\",\r\n            depthFailOp: \"keep\",\r\n            passOp: \"keep\"\r\n        };\r\n\r\n        this.cDepthStencilState = <GPUDepthStencilStateDescriptor> {\r\n            format: \"depth24plus-stencil8\",\r\n            depthWriteEnabled: false,\r\n            depthCompare: \"always\",\r\n            stencilBack: stencilFace,\r\n            stencilFront: stencilFace,\r\n            stencilReadMask: 0xff,\r\n            stencilWriteMask: 0xff\r\n        };\r\n        descriptor.depthStencilState = undefined;\r\n    }\r\n\r\n    public set colorStateCount(value: uint32_t) {\r\n        this._colorStateCount = value;\r\n        this.colorStates = this.cColorStates.slice(0, this._colorStateCount);\r\n    }\r\n\r\n}\r\n\r\nexport class ComboVertexStateDescriptor implements GPUVertexStateDescriptor {\r\n\r\n    public static readonly kMaxVertexAttributes: size_t = 16;\r\n    public static readonly kMaxVertexBuffers: size_t    = 16;\r\n\r\n    public cVertexBuffers: Array<GPUVertexBufferLayoutDescriptor>;\r\n    public cAttributes: Array<GPUVertexAttributeDescriptor>;\r\n\r\n    public indexFormat?: GPUIndexFormat;\r\n    public vertexBuffers?: Iterable<GPUVertexBufferLayoutDescriptor>;\r\n\r\n    private _vertexBufferCount: size_t = 0;\r\n\r\n    public constructor() {\r\n        const descriptor = this;\r\n\r\n        this.cVertexBuffers = BuildArray<GPUVertexBufferLayoutDescriptor>(\r\n            ComboVertexStateDescriptor.kMaxVertexBuffers, () => <GPUVertexBufferLayoutDescriptor>{}\r\n        );\r\n\r\n        this.cAttributes = BuildArray<GPUVertexAttributeDescriptor>(\r\n            ComboVertexStateDescriptor.kMaxVertexAttributes, () => <GPUVertexAttributeDescriptor>{}\r\n        );\r\n\r\n        descriptor.indexFormat = \"uint32\";\r\n        descriptor._vertexBufferCount = 0;\r\n\r\n        // Fill the default values for vertexBuffers and vertexAttributes in buffers.\r\n        for (let i: uint32_t = 0; i < this.cAttributes.length; ++i) {\r\n            this.cAttributes[i] = <GPUVertexAttributeDescriptor> {\r\n                shaderLocation: 0,\r\n                offset: 0,\r\n                format: 'float'\r\n            };\r\n        }\r\n        for (let i = 0; i < this.cVertexBuffers.length; ++i) {\r\n            this.cVertexBuffers[i].arrayStride = 0;\r\n            this.cVertexBuffers[i].stepMode = \"vertex\";\r\n            this.cVertexBuffers[i].attributes = [];\r\n        }\r\n        // cVertexBuffers[i].attributes points to somewhere in cAttributes.\r\n        // cVertexBuffers[0].attributes points to &cAttributes[0] by default. Assuming\r\n        // cVertexBuffers[0] has two attributes, then cVertexBuffers[1].attributes should point to\r\n        // &cAttributes[2]. Likewise, if cVertexBuffers[1] has 3 attributes, then\r\n        // cVertexBuffers[2].attributes should point to &cAttributes[5].\r\n        this.cVertexBuffers[0].attributes = this.cAttributes;\r\n        descriptor.vertexBuffers = this.cVertexBuffers;\r\n    }\r\n\r\n    public set vertexBufferCount(value: size_t) {\r\n        this._vertexBufferCount = value;\r\n        this.vertexBuffers = this.cVertexBuffers.slice(0, this._vertexBufferCount);\r\n    }\r\n\r\n}\r\n","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport { Nullable, int, float, FloatArray, uint32_t, MergeTypedArrays, size_t, BuildArray } from \"./types\";\r\nimport { MODELNAME, MODELGROUP, TOGGLE, Aquarium, Fish, fishTable } from \"./aquarium\";\r\nimport { Buffer, BufferWebGPU } from \"./buffer\"\r\nimport { Context, ContextWebGPU } from \"./context\"\r\nimport { Program, ProgramWebGPU } from \"./program\";\r\nimport { Texture, TextureWebGPU } from \"./texture\";\r\nimport { FishPer, FishVertexUniforms, InnerUniforms, LightFactorUniforms, SeaweedPer, WorldUniformPer, WorldUniforms } from \"./uniforms\"\r\nimport { ComboVertexStateDescriptor } from \"./utils\"\r\n\r\n\r\n/**\r\n * Defines the base Class Model for all of the models.\r\n * Contains programs, textures and buffers info of models.\r\n * Apply program for its model. Update uniforms, textures and buffers for each frame.\r\n */\r\nexport class Model {\r\n\r\n    public worldmatrices: Array<FloatArray> = new Array<FloatArray>();\r\n    public textureMap: Record<string, Nullable<Texture>> = {};\r\n    public bufferMap: Record<string, Nullable<Buffer>> = {};\r\n\r\n    protected _program: Nullable<Program> = null;\r\n    protected _blend: boolean;\r\n    protected _name: MODELNAME;\r\n\r\n    constructor(type?: MODELGROUP, name?: MODELNAME, blend?: boolean) {\r\n        this._blend = blend || false;\r\n        this._name = name || MODELNAME.MODELMAX;\r\n    }\r\n\r\n    public dispose(): void {\r\n        for (let k in this.bufferMap) {\r\n            if (this.bufferMap[k] !== null) {\r\n                delete this.bufferMap[k];\r\n            }\r\n        }\r\n        this.bufferMap = {};\r\n    }\r\n\r\n    public set program(program: Nullable<Program>) {\r\n        this._program = program;\r\n    }\r\n\r\n    public prepareForDraw(): void { }\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void { }\r\n    public draw(): void { }\r\n    public init(): void { }\r\n}\r\n\r\n/**\r\n * Defines the fish model. Updates fish specific uniforms.\r\n */\r\nexport class FishModel extends Model {\r\n\r\n    protected _preInstance: int = 0;\r\n    protected _curInstance: int = 0;\r\n    protected _fishPerOffset: int = 0;\r\n\r\n    protected _aquarium: Nullable<Aquarium> = null;\r\n\r\n    constructor(type: MODELGROUP, name: MODELNAME, blend: boolean, aquarium: Aquarium) {\r\n        super(type, name, blend);\r\n        this._aquarium = aquarium;\r\n    }\r\n\r\n    public updateFishPerUniforms(x: float, y: float, z: float,\r\n                                 nextX: float, nextY: float, nextZ: float,\r\n                                 scale: float, time: float, index: int): void { }\r\n    \r\n    \r\n    public prepareForDraw(): void {\r\n        this._fishPerOffset = 0;\r\n        for (let i = 0; i < this._name - MODELNAME.MODELSMALLFISHA; ++i) {\r\n            const fishInfo: Fish = fishTable[i];\r\n            this._fishPerOffset += this._aquarium.fishCount[fishInfo.modelName - MODELNAME.MODELSMALLFISHA];\r\n        }\r\n\r\n        const fishInfo: Fish = fishTable[this._name - MODELNAME.MODELSMALLFISHA];\r\n        this._curInstance    = this._aquarium.fishCount[fishInfo.modelName - MODELNAME.MODELSMALLFISHA];\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Defines the seaweed model.\r\n */\r\nexport class SeaweedModel extends Model {\r\n\r\n    constructor(type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(type, name, blend);\r\n    }\r\n\r\n    public updateSeaweedModelTime(time: float) { }\r\n\r\n}\r\n\r\n/**\r\n * Defines the generic model of WebGPU.\r\n */\r\nexport class GenericModelWebGPU extends Model {\r\n\r\n    public diffuseTexture: Nullable<TextureWebGPU>    = null;\r\n    public normalTexture: Nullable<TextureWebGPU>     = null;\r\n    public reflectionTexture: Nullable<TextureWebGPU> = null;\r\n    public skyboxTexture: Nullable<TextureWebGPU>     = null;\r\n\r\n    public positionBuffer: Nullable<BufferWebGPU> = null;\r\n    public normalBuffer: Nullable<BufferWebGPU>   = null;\r\n    public texCoordBuffer: Nullable<BufferWebGPU> = null;\r\n    public tangentBuffer: Nullable<BufferWebGPU>  = null;\r\n    public biNormalBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    public indicesBuffer: Nullable<BufferWebGPU>  = null;\r\n\r\n    public lightFactorUniforms: Nullable<LightFactorUniforms> = new LightFactorUniforms();\r\n    public worldUniformPer: Nullable<WorldUniformPer> = new WorldUniformPer();\r\n\r\n    protected _vertexStateDescriptor: Nullable<ComboVertexStateDescriptor> = null;\r\n    protected _pipeline: GPURenderPipeline;\r\n\r\n    protected _groupLayoutModel:GPUBindGroupLayout;\r\n    protected _groupLayoutPer: GPUBindGroupLayout;\r\n    protected _pipelineLayout: GPUPipelineLayout;\r\n\r\n    protected _bindGroupModel: GPUBindGroup;\r\n    protected _bindGroupPer: GPUBindGroup;\r\n\r\n    protected _lightFactorBuffer: GPUBuffer;\r\n    protected _worldBuffer: GPUBuffer;\r\n\r\n    protected _contextWebGPU: Nullable<ContextWebGPU> = null;\r\n    protected _programWebGPU: Nullable<ProgramWebGPU> = null;\r\n\r\n    protected _instance: int = 0;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(type, name, blend);\r\n\r\n        this._contextWebGPU = context as Nullable<ContextWebGPU>;\r\n        this._vertexStateDescriptor = new ComboVertexStateDescriptor();\r\n\r\n        this.lightFactorUniforms.shininess      = 50.0;\r\n        this.lightFactorUniforms.specularFactor = 1.0;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._pipeline          = null;\r\n        this._groupLayoutModel  = null;\r\n        this._groupLayoutPer    = null;\r\n        this._pipelineLayout    = null;\r\n        this._bindGroupModel    = null;\r\n        this._bindGroupPer      = null;\r\n        this._lightFactorBuffer = null;\r\n        this._worldBuffer       = null;\r\n    }\r\n\r\n    public init(): void {\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n\r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.tangentBuffer  = this.bufferMap[\"tangent\"] as BufferWebGPU;\r\n        this.biNormalBuffer = this.bufferMap[\"binormal\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n\r\n        // Generic models use reflection, normal or diffuse shaders, of which groupLayouts are\r\n        // different in texture binding.  MODELGLOBEBASE use diffuse shader though it contains\r\n        // normal and reflection textures.\r\n        if (this.normalTexture && this._name !== MODELNAME.MODELGLOBEBASE) {\r\n            this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n            this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n            \r\n            this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n            this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n            \r\n            this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n            this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n            this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n            \r\n            this._vertexStateDescriptor.cVertexBuffers[3].arrayStride = this.tangentBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[3].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[3].shaderLocation = 3;\r\n            this._vertexStateDescriptor.cAttributes[3].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[3].attributes  = [this._vertexStateDescriptor.cAttributes[3]];\r\n            \r\n            this._vertexStateDescriptor.cVertexBuffers[4].arrayStride = this.biNormalBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[4].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[4].shaderLocation = 4;\r\n            this._vertexStateDescriptor.cAttributes[4].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[4].attributes  = [this._vertexStateDescriptor.cAttributes[4]];\r\n            \r\n            this._vertexStateDescriptor.vertexBufferCount             = 5;\r\n            this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n        }\r\n        else {\r\n            this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n            this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n\r\n            this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n            this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n            this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n\r\n            this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n            this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n            this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n            this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n            this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n\r\n            this._vertexStateDescriptor.vertexBufferCount             = 3;\r\n            this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n        }\r\n\r\n        if (this.skyboxTexture && this.reflectionTexture && this._name !== MODELNAME.MODELGLOBEBASE) {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"cube\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else if (this.normalTexture && this._name != MODELNAME.MODELGLOBEBASE) {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._groupLayoutPer = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n\r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._groupLayoutPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(\r\n            this._pipelineLayout,\r\n            this._programWebGPU,\r\n            this._vertexStateDescriptor,\r\n            this._blend\r\n        );\r\n\r\n        this._lightFactorBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.lightFactorUniforms.data,\r\n                                                     LightFactorUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._worldBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.worldUniformPer.data,\r\n                                                     this.worldUniformPer.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n\r\n        // Generic models use reflection, normal or diffuse shaders, of which grouplayouts are\r\n        // different in texture binding. MODELGLOBEBASE use diffuse shader though it contains\r\n        // normal and reflection textures.\r\n        if (this.skyboxTexture && this.reflectionTexture && this._name !== MODELNAME.MODELGLOBEBASE) {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: this.reflectionTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.skyboxTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            resource: this.normalTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            resource: this.reflectionTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            resource: this.skyboxTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else if (this.normalTexture && this._name !== MODELNAME.MODELGLOBEBASE) {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: this.diffuseTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.normalTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: this.diffuseTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.diffuseTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._bindGroupPer = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutPer,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._worldBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._contextWebGPU.setBufferData(this._lightFactorBuffer, 0, LightFactorUniforms.byteSize,\r\n                                          this.lightFactorUniforms.data);\r\n    }\r\n\r\n    public prepareForDraw(): void {\r\n        this._contextWebGPU.updateBufferData(this._worldBuffer, this.worldUniformPer.data, this.worldUniformPer.byteSize);\r\n    }\r\n\r\n    public draw(): void {\r\n        const pass = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setBindGroup(3, this._bindGroupPer);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        // diffuseShader doesn't have to input tangent buffer or binormal buffer.\r\n        if (this.tangentBuffer && this.biNormalBuffer && this._name !== MODELNAME.MODELGLOBEBASE)\r\n        {\r\n            pass.setVertexBuffer(3, this.tangentBuffer.buffer);\r\n            pass.setVertexBuffer(4, this.biNormalBuffer.buffer);\r\n        }\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        pass.drawIndexed(this.indicesBuffer.totalComponents, this._instance, 0, 0, 0);\r\n        this._instance = 0;\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void {\r\n        this.worldUniformPer.worldUniforms[this._instance] = worldUniforms.clone();\r\n\r\n        ++this._instance;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Defines the outside model of WebGPU.\r\n */\r\nexport class OutsideModelWebGPU extends GenericModelWebGPU {\r\n\r\n    private _viewBuffer: GPUBuffer;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(context, aquarium, type, name, blend);\r\n\r\n        this.lightFactorUniforms.shininess      = 50.0;\r\n        this.lightFactorUniforms.specularFactor = 1.0;\r\n    }\r\n\r\n    public dispose(): void {\r\n        super.dispose();\r\n        this._viewBuffer = null;\r\n    }\r\n\r\n    public init(): void {\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n\r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.tangentBuffer  = this.bufferMap[\"tangent\"] as BufferWebGPU;\r\n        this.biNormalBuffer = this.bufferMap[\"binormal\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n    \r\n        this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n        this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n        this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n        this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n        this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[3].arrayStride = this.tangentBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[3].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[3].shaderLocation = 3;\r\n        this._vertexStateDescriptor.cAttributes[3].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[3].attributes  = [this._vertexStateDescriptor.cAttributes[3]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[4].arrayStride = this.biNormalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[4].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[4].shaderLocation = 4;\r\n        this._vertexStateDescriptor.cAttributes[4].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[4].attributes  = [this._vertexStateDescriptor.cAttributes[4]];\r\n        \r\n        this._vertexStateDescriptor.vertexBufferCount             = 5;\r\n        this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n\r\n        this._groupLayoutPer = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n\r\n        // Outside models use diffuse shaders.\r\n        this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"uniform-buffer\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampler\"\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\"\r\n                    }\r\n                ]\r\n            }      \r\n        );\r\n        \r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._groupLayoutPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(\r\n            this._pipelineLayout,\r\n            this._programWebGPU,\r\n            this._vertexStateDescriptor,\r\n            this._blend\r\n        );\r\n\r\n        this._lightFactorBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.lightFactorUniforms.data,\r\n                                                     LightFactorUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._viewBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.worldUniformPer.data,\r\n                                                     this._contextWebGPU.calcConstantBufferByteSize(WorldUniforms.byteSize) * 20,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutModel,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._lightFactorBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        resource: this.diffuseTexture.sampler\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        resource: this.diffuseTexture.textureView\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._bindGroupPer = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutPer,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._viewBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._contextWebGPU.setBufferData(this._lightFactorBuffer, 0, LightFactorUniforms.byteSize,\r\n                                          this.lightFactorUniforms.data);\r\n    }\r\n\r\n    public prepareForDraw(): void { }\r\n\r\n    public draw(): void {\r\n        const pass: GPURenderPassEncoder = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setBindGroup(3, this._bindGroupPer);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        // diffuseShader doesn't have to input tangent buffer or binormal buffer.\r\n        if (this.tangentBuffer && this.biNormalBuffer) {\r\n            pass.setVertexBuffer(3, this.tangentBuffer.buffer);\r\n            pass.setVertexBuffer(4, this.biNormalBuffer.buffer);\r\n        }\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        pass.drawIndexed(this.indicesBuffer.totalComponents, 1, 0, 0, 0);\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void {\r\n        this.worldUniformPer.worldUniforms[0] = worldUniforms.clone();\r\n\r\n        this._contextWebGPU.updateBufferData(this._viewBuffer, worldUniforms.data,\r\n                                             this._contextWebGPU.calcConstantBufferByteSize(WorldUniforms.byteSize));\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Defines the inner model of WebGPU.\r\n */\r\nexport class InnerModelWebGPU extends GenericModelWebGPU {\r\n\r\n    public innerUniforms: Nullable<InnerUniforms> = new InnerUniforms();\r\n\r\n    private _innerBuffer: GPUBuffer;\r\n    private _viewBuffer: GPUBuffer;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(context, aquarium, type, name, blend);\r\n\r\n        this.innerUniforms.eta             = 1.0;\r\n        this.innerUniforms.tankColorFudge  = 0.796;\r\n        this.innerUniforms.refractionFudge = 3.0;\r\n    }\r\n\r\n    public dispose(): void {\r\n        super.dispose();\r\n        this._innerBuffer = null;\r\n        this._viewBuffer = null;\r\n    }\r\n\r\n    public init(): void {\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n\r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.tangentBuffer  = this.bufferMap[\"tangent\"] as BufferWebGPU;\r\n        this.biNormalBuffer = this.bufferMap[\"binormal\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n\r\n        this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n        this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n        this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n        this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n        this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[3].arrayStride = this.tangentBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[3].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[3].shaderLocation = 3;\r\n        this._vertexStateDescriptor.cAttributes[3].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[3].attributes  = [this._vertexStateDescriptor.cAttributes[3]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[4].arrayStride = this.biNormalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[4].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[4].shaderLocation = 4;\r\n        this._vertexStateDescriptor.cAttributes[4].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[4].attributes  = [this._vertexStateDescriptor.cAttributes[4]];\r\n        \r\n        this._vertexStateDescriptor.vertexBufferCount             = 5;\r\n        this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n\r\n        this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"uniform-buffer\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampler\"\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampler\"\r\n                    },\r\n                    {\r\n                        binding: 3,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\",\r\n                        hasDynamicOffset: false,\r\n                        multisampled: false,\r\n                        viewDimension: \"2d\",\r\n                        textureComponentType: \"float\"\r\n                    },\r\n                    {\r\n                        binding: 4,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\",\r\n                        hasDynamicOffset: false,\r\n                        multisampled: false,\r\n                        viewDimension:\"2d\",\r\n                        textureComponentType: \"float\"\r\n                    },\r\n                    {\r\n                        binding: 5,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\",\r\n                        hasDynamicOffset: false,\r\n                        multisampled: false,\r\n                        viewDimension:\"2d\",\r\n                        textureComponentType: \"float\"\r\n                    },\r\n                    {\r\n                        binding: 6,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\",\r\n                        hasDynamicOffset: false,\r\n                        multisampled: false,\r\n                        viewDimension: \"cube\",\r\n                        textureComponentType: \"float\"\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._groupLayoutPer = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n\r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._groupLayoutPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(\r\n            this._pipelineLayout,\r\n            this._programWebGPU,\r\n            this._vertexStateDescriptor,\r\n            this._blend\r\n        );\r\n\r\n        this._innerBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.innerUniforms.data,\r\n                                                     InnerUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._viewBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.worldUniformPer.data,\r\n                                                     this._contextWebGPU.calcConstantBufferByteSize(this.worldUniformPer.byteSize),\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutModel,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._innerBuffer,\r\n                            offset: 0,\r\n                            size: InnerUniforms.byteSize\r\n                        }\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        resource: this.reflectionTexture.sampler\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        resource: this.skyboxTexture.sampler\r\n                    },\r\n                    {\r\n                        binding: 3,\r\n                        resource: this.diffuseTexture.textureView\r\n                    },\r\n                    {\r\n                        binding: 4,\r\n                        resource: this.normalTexture.textureView\r\n                    },\r\n                    {\r\n                        binding: 5,\r\n                        resource: this.reflectionTexture.textureView\r\n                    },\r\n                    {\r\n                        binding: 6,\r\n                        resource: this.skyboxTexture.textureView\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._bindGroupPer = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutPer,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._viewBuffer,\r\n                            offset: 0,\r\n                            size: this._contextWebGPU.calcConstantBufferByteSize(WorldUniforms.byteSize)\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._contextWebGPU.setBufferData(this._innerBuffer, 0, InnerUniforms.byteSize,\r\n                                          this.innerUniforms.data);\r\n    }\r\n\r\n    public prepareForDraw(): void {}\r\n\r\n    public draw(): void {\r\n        const pass: GPURenderPassEncoder = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setBindGroup(3, this._bindGroupPer);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        pass.setVertexBuffer(3, this.tangentBuffer.buffer);\r\n        pass.setVertexBuffer(4, this.biNormalBuffer.buffer);\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        pass.drawIndexed(this.indicesBuffer.totalComponents, 1, 0, 0, 0);\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void {\r\n        this.worldUniformPer.worldUniforms[0] = worldUniforms.clone();\r\n\r\n        this._contextWebGPU.updateBufferData(this._viewBuffer, this.worldUniformPer.worldUniforms[0].data,\r\n                                             this._contextWebGPU.calcConstantBufferByteSize(WorldUniforms.byteSize));\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Defines the fish model of WebGPU.\r\n */\r\nexport class FishModelWebGPU extends FishModel {\r\n\r\n    public fishVertexUniforms: Nullable<FishVertexUniforms> = new FishVertexUniforms();\r\n    public lightFactorUniforms: Nullable<LightFactorUniforms> = new LightFactorUniforms();\r\n\r\n    public diffuseTexture: Nullable<TextureWebGPU> = null;\r\n    public normalTexture: Nullable<TextureWebGPU> = null;\r\n    public reflectionTexture: Nullable<TextureWebGPU> = null;\r\n    public skyboxTexture: Nullable<TextureWebGPU> = null;\r\n\r\n    public positionBuffer: Nullable<BufferWebGPU> = null;\r\n    public normalBuffer: Nullable<BufferWebGPU> = null;\r\n    public texCoordBuffer: Nullable<BufferWebGPU> = null;\r\n    public tangentBuffer: Nullable<BufferWebGPU> = null;\r\n    public biNormalBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    public indicesBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    private _vertexStateDescriptor: Nullable<ComboVertexStateDescriptor> = null;\r\n    private _pipeline: GPURenderPipeline;\r\n\r\n    private _groupLayoutModel: GPUBindGroupLayout;\r\n    private _pipelineLayout: GPUPipelineLayout;\r\n\r\n    private _bindGroupModel: GPUBindGroup;\r\n\r\n    private _fishVertexBuffer: GPUBuffer;\r\n    private _lightFactorBuffer: GPUBuffer;\r\n\r\n    private _programWebGPU: ProgramWebGPU;\r\n    private _contextWebGPU: ContextWebGPU;\r\n\r\n    private _enableDynamicBufferOffset: boolean;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(type, name, blend, aquarium);\r\n\r\n        this._contextWebGPU = context as Nullable<ContextWebGPU>;\r\n        this._vertexStateDescriptor = new ComboVertexStateDescriptor();\r\n\r\n        this._enableDynamicBufferOffset = aquarium.toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET];\r\n\r\n        this.lightFactorUniforms.shininess      = 5.0;\r\n        this.lightFactorUniforms.specularFactor = 0.3;\r\n\r\n        const fishInfo: Fish                   = fishTable[name - MODELNAME.MODELSMALLFISHA];\r\n        this.fishVertexUniforms.fishLength     = fishInfo.fishLength;\r\n        this.fishVertexUniforms.fishBendAmount = fishInfo.fishBendAmount;\r\n        this.fishVertexUniforms.fishWaveLength = fishInfo.fishWaveLength;\r\n\r\n        this._curInstance = this._aquarium.fishCount[fishInfo.modelName - MODELNAME.MODELSMALLFISHA];\r\n        this._preInstance = this._curInstance;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._pipeline          = null;\r\n        this._groupLayoutModel  = null;\r\n        this._pipelineLayout    = null;\r\n        this._bindGroupModel    = null;\r\n        this._fishVertexBuffer  = null;\r\n        this._lightFactorBuffer = null;\r\n    }\r\n\r\n    public init(): void {\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n        \r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.tangentBuffer  = this.bufferMap[\"tangent\"] as BufferWebGPU;\r\n        this.biNormalBuffer = this.bufferMap[\"binormal\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n\r\n        this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n        this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n        this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n        this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n        this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[3].arrayStride = this.tangentBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[3].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[3].shaderLocation = 3;\r\n        this._vertexStateDescriptor.cAttributes[3].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[3].attributes  = [this._vertexStateDescriptor.cAttributes[3]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[4].arrayStride = this.biNormalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[4].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[4].shaderLocation = 4;\r\n        this._vertexStateDescriptor.cAttributes[4].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[4].attributes  = [this._vertexStateDescriptor.cAttributes[4]];\r\n        \r\n        this._vertexStateDescriptor.vertexBufferCount             = 5;\r\n        this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n\r\n        if (this.skyboxTexture && this.reflectionTexture) {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.VERTEX,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 7,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"cube\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.VERTEX,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"2d\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._contextWebGPU.groupLayoutFishPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(this._pipelineLayout, this._programWebGPU,\r\n                                                                  this._vertexStateDescriptor, this._blend);\r\n\r\n        this._fishVertexBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.fishVertexUniforms.data, FishVertexUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n        this._lightFactorBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.lightFactorUniforms.data, LightFactorUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        // Fish models includes small, medium and big. Some of them contains reflection and skybox\r\n        // texture, but some doesn't.\r\n        if (this.skyboxTexture && this.reflectionTexture) {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._fishVertexBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.reflectionTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.skyboxTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            resource: this.normalTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            resource: this.reflectionTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 7,\r\n                            resource: this.skyboxTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        } else {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._fishVertexBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.diffuseTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            resource: this.normalTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._contextWebGPU.setBufferData(this._lightFactorBuffer, 0, LightFactorUniforms.byteSize,\r\n                                          this.lightFactorUniforms.data);\r\n        this._contextWebGPU.setBufferData(this._fishVertexBuffer, 0, FishVertexUniforms.byteSize,\r\n                                          this.fishVertexUniforms.data);\r\n    }\r\n\r\n    public draw(): void {\r\n        if (this._curInstance == 0) {\r\n            return;\r\n        }\r\n\r\n        const pass = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        pass.setVertexBuffer(3, this.tangentBuffer.buffer);\r\n        pass.setVertexBuffer(4, this.biNormalBuffer.buffer);\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        \r\n        if (this._enableDynamicBufferOffset) {\r\n            for (let i: uint32_t = 0; i < this._curInstance; ++i) {\r\n                const offset: uint32_t = 256 * (i + this._fishPerOffset);\r\n                pass.setBindGroup(3, this._contextWebGPU.bindGroupFishPers[0], [offset]);\r\n                pass.drawIndexed(this.indicesBuffer.totalComponents, 1, 0, 0, 0);\r\n            }\r\n        }\r\n        else {\r\n            for (let i: uint32_t = 0; i < this._curInstance; ++i) {\r\n                pass.setBindGroup(3, this._contextWebGPU.bindGroupFishPers[i + this._fishPerOffset]);\r\n                pass.drawIndexed(this.indicesBuffer.totalComponents, 1, 0, 0, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void { }\r\n\r\n    public updateFishPerUniforms(x: float, y: float, z: float,\r\n                                 nextX: float, nextY: float, nextZ: float,\r\n                                 scale: float, time: float, index: int): void {\r\n        index += this._fishPerOffset;\r\n        this._contextWebGPU.fishPers[index].worldPosition[0] = x;\r\n        this._contextWebGPU.fishPers[index].worldPosition[1] = y;\r\n        this._contextWebGPU.fishPers[index].worldPosition[2] = z;\r\n        this._contextWebGPU.fishPers[index].nextPosition[0]  = nextX;\r\n        this._contextWebGPU.fishPers[index].nextPosition[1]  = nextY;\r\n        this._contextWebGPU.fishPers[index].nextPosition[2]  = nextZ;\r\n        this._contextWebGPU.fishPers[index].scale            = scale;\r\n        this._contextWebGPU.fishPers[index].time             = time;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Defines the fish instanced draw model of WebGPU.\r\n */\r\nexport class FishModelInstancedDrawWebGPU extends FishModel {\r\n\r\n    public fishVertexUniforms: Nullable<FishVertexUniforms> = new FishVertexUniforms();\r\n    public lightFactorUniforms: Nullable<LightFactorUniforms> = new LightFactorUniforms();\r\n    public fishPers: Array<FishPer> = new Array<FishPer>();\r\n\r\n    public diffuseTexture: Nullable<TextureWebGPU> = null;\r\n    public normalTexture: Nullable<TextureWebGPU> = null;\r\n    public reflectionTexture: Nullable<TextureWebGPU> = null;\r\n    public skyboxTexture: Nullable<TextureWebGPU> = null;\r\n\r\n    public positionBuffer: Nullable<BufferWebGPU> = null;\r\n    public normalBuffer: Nullable<BufferWebGPU> = null;\r\n    public texCoordBuffer: Nullable<BufferWebGPU> = null;\r\n    public tangentBuffer: Nullable<BufferWebGPU> = null;\r\n    public biNormalBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    public indicesBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    private _vertexStateDescriptor: Nullable<ComboVertexStateDescriptor> = null;\r\n    private _pipeline: GPURenderPipeline;\r\n\r\n    private _groupLayoutModel: GPUBindGroupLayout;\r\n    private _groupLayoutPer: GPUBindGroupLayout;\r\n    private _pipelineLayout: GPUPipelineLayout;\r\n\r\n    private _bindGroupModel: GPUBindGroup;\r\n    private _bindGroupPer: GPUBindGroup;\r\n\r\n    private _fishVertexBuffer: GPUBuffer;\r\n    private _lightFactorBuffer: GPUBuffer;\r\n\r\n    private _fishPersBuffer: GPUBuffer;\r\n\r\n    private _instance: int;\r\n\r\n    private _programWebGPU: Nullable<ProgramWebGPU> = null;\r\n    private _contextWebGPU: Nullable<ContextWebGPU> = null;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(type, name, blend, aquarium);\r\n        this._instance = 0;\r\n\r\n        this._contextWebGPU = context as Nullable<ContextWebGPU>;\r\n        this._vertexStateDescriptor = new ComboVertexStateDescriptor();\r\n\r\n        this.lightFactorUniforms.shininess      = 5.0;\r\n        this.lightFactorUniforms.specularFactor = 0.3;\r\n\r\n        const fishInfo: Fish                   = fishTable[name - MODELNAME.MODELSMALLFISHAINSTANCEDDRAWS];\r\n        this.fishVertexUniforms.fishLength     = fishInfo.fishLength;\r\n        this.fishVertexUniforms.fishBendAmount = fishInfo.fishBendAmount;\r\n        this.fishVertexUniforms.fishWaveLength = fishInfo.fishWaveLength;\r\n\r\n        this._instance = aquarium.fishCount[fishInfo.modelName - MODELNAME.MODELSMALLFISHA];\r\n        this.fishPers = BuildArray(this._instance, () => new FishPer());\r\n    }\r\n\r\n    public init(): void {\r\n        if (this._instance == 0) {\r\n            return;\r\n        }\r\n\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n\r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.tangentBuffer  = this.bufferMap[\"tangent\"] as BufferWebGPU;\r\n        this.biNormalBuffer = this.bufferMap[\"binormal\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n\r\n        this._fishPersBuffer =\r\n            this._contextWebGPU.createBuffer(FishPer.byteSize * this._instance,\r\n                                             GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST);\r\n\r\n        this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n        this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n        this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n        this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n        this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[3].arrayStride = this.tangentBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[3].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[3].shaderLocation = 3;\r\n        this._vertexStateDescriptor.cAttributes[3].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[3].attributes  = [this._vertexStateDescriptor.cAttributes[3]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[4].arrayStride = this.biNormalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[4].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[4].shaderLocation = 4;\r\n        this._vertexStateDescriptor.cAttributes[4].offset         = FishPer.offsetof(\"worldPosition\");\r\n        this._vertexStateDescriptor.cVertexBuffers[4].attributes  = [this._vertexStateDescriptor.cAttributes[4]];\r\n\r\n        this._vertexStateDescriptor.cVertexBuffers[5].arrayStride = FishPer.byteSize;\r\n        this._vertexStateDescriptor.cAttributes[5].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[5].shaderLocation = 5;\r\n        this._vertexStateDescriptor.cAttributes[5].offset         = 0; // FishPer.offsetof(\"worldPosition\");\r\n    \r\n        this._vertexStateDescriptor.cAttributes[6].format         = \"float\";\r\n        this._vertexStateDescriptor.cAttributes[6].shaderLocation = 6;\r\n        this._vertexStateDescriptor.cAttributes[6].offset         = FishPer.offsetof(\"scale\");\r\n    \r\n        this._vertexStateDescriptor.cAttributes[7].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[7].shaderLocation = 7;\r\n        this._vertexStateDescriptor.cAttributes[7].offset         = FishPer.offsetof(\"nextPosition\");\r\n    \r\n        this._vertexStateDescriptor.cAttributes[8].format         = \"float\";\r\n        this._vertexStateDescriptor.cAttributes[8].shaderLocation = 8;\r\n        this._vertexStateDescriptor.cAttributes[8].offset         = FishPer.offsetof(\"time\");\r\n    \r\n        this._vertexStateDescriptor.cVertexBuffers[5].attributes  = this._vertexStateDescriptor.cAttributes.slice(5, 9);\r\n        this._vertexStateDescriptor.cVertexBuffers[5].stepMode    = \"instance\";\r\n\r\n        this._vertexStateDescriptor.vertexBufferCount             = 6;\r\n        this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n\r\n        if (this.skyboxTexture && this.reflectionTexture) {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.VERTEX,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 7,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension: \"cube\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n                <GPUBindGroupLayoutDescriptor> {\r\n                    entries: <GPUBindGroupLayoutEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            visibility: GPUShaderStage.VERTEX,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"uniform-buffer\"\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampler\"\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            visibility: GPUShaderStage.FRAGMENT,\r\n                            type: \"sampled-texture\",\r\n                            hasDynamicOffset: false,\r\n                            multisampled: false,\r\n                            viewDimension:\"2d\",\r\n                            textureComponentType: \"float\"\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._groupLayoutPer = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n\r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._groupLayoutPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(\r\n            this._pipelineLayout,\r\n            this._programWebGPU,\r\n            this._vertexStateDescriptor,\r\n            this._blend\r\n        );\r\n\r\n        this._fishVertexBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.fishVertexUniforms.data, FishVertexUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n        this._lightFactorBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.lightFactorUniforms.data, LightFactorUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        // Fish models includes small, medium and big. Some of them contains reflection and skybox\r\n        // texture, but some doesn't.\r\n        if (this.skyboxTexture && this.reflectionTexture) {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._fishVertexBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.reflectionTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.skyboxTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 5,\r\n                            resource: this.normalTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 6,\r\n                            resource: this.reflectionTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 7,\r\n                            resource: this.skyboxTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        } else {\r\n            this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this._groupLayoutModel,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._fishVertexBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this._lightFactorBuffer,\r\n                                offset: 0,\r\n                            }\r\n                        },\r\n                        {\r\n                            binding: 2,\r\n                            resource: this.diffuseTexture.sampler\r\n                        },\r\n                        {\r\n                            binding: 3,\r\n                            resource: this.diffuseTexture.textureView\r\n                        },\r\n                        {\r\n                            binding: 4,\r\n                            resource: this.normalTexture.textureView\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n\r\n        this._contextWebGPU.setBufferData(this._lightFactorBuffer, 0, LightFactorUniforms.byteSize,\r\n                                          this.lightFactorUniforms.data);\r\n        this._contextWebGPU.setBufferData(this._fishVertexBuffer, 0, FishVertexUniforms.byteSize,\r\n                                          this.fishVertexUniforms.data);\r\n    }\r\n\r\n    public prepareForDraw(): void { }\r\n\r\n    public draw(): void {\r\n        if (this._instance == 0) {\r\n            return;\r\n        }\r\n\r\n        this._contextWebGPU.setBufferData(this._fishPersBuffer, 0, FishPer.byteSize * this._instance,\r\n                                          new Float32Array(FishPer.toArray(this.fishPers)));\r\n\r\n        const pass = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        pass.setVertexBuffer(3, this.tangentBuffer.buffer);\r\n        pass.setVertexBuffer(4, this.biNormalBuffer.buffer);\r\n        pass.setVertexBuffer(5, this._fishPersBuffer);\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        pass.drawIndexed(this.indicesBuffer.totalComponents, this._instance, 0, 0, 0);\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void { }\r\n\r\n    public updateFishPerUniforms(x: float, y: float, z: float,\r\n                                 nextX: float, nextY: float, nextZ: float,\r\n                                 scale: float, time: float, index: int): void {\r\n        this.fishPers[index].worldPosition[0] = x;\r\n        this.fishPers[index].worldPosition[1] = y;\r\n        this.fishPers[index].worldPosition[2] = z;\r\n        this.fishPers[index].nextPosition[0]  = nextX;\r\n        this.fishPers[index].nextPosition[1]  = nextY;\r\n        this.fishPers[index].nextPosition[2]  = nextZ;\r\n        this.fishPers[index].scale            = scale;\r\n        this.fishPers[index].time             = time;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._pipeline          = null;\r\n        this._groupLayoutModel  = null;\r\n        this._groupLayoutPer    = null;\r\n        this._pipelineLayout    = null;\r\n        this._bindGroupModel    = null;\r\n        this._bindGroupPer      = null;\r\n        this._fishVertexBuffer  = null;\r\n        this._lightFactorBuffer = null;\r\n        this._fishPersBuffer    = null;\r\n        this.fishPers.length    = 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Defines the seaweed model of WebGPU.\r\n */\r\nexport class SeaweedModelWebGPU extends SeaweedModel {\r\n\r\n    public diffuseTexture: Nullable<TextureWebGPU> = null;\r\n    public normalTexture: Nullable<TextureWebGPU> = null;\r\n    public reflectionTexture: Nullable<TextureWebGPU> = null;\r\n    public skyboxTexture: Nullable<TextureWebGPU> = null;\r\n\r\n    public positionBuffer: Nullable<BufferWebGPU> = null;\r\n    public normalBuffer: Nullable<BufferWebGPU> = null;\r\n    public texCoordBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    public indicesBuffer: Nullable<BufferWebGPU> = null;\r\n\r\n    public lightFactorUniforms: Nullable<LightFactorUniforms> = new LightFactorUniforms();\r\n    public seaweedPer: Nullable<SeaweedPer> = new SeaweedPer();\r\n    public worldUniformPer: Nullable<WorldUniformPer> = new WorldUniformPer();\r\n\r\n    private _vertexStateDescriptor: Nullable<ComboVertexStateDescriptor> = null;\r\n    private _pipeline: GPURenderPipeline;\r\n\r\n    private _groupLayoutModel: GPUBindGroupLayout;\r\n    private _groupLayoutPer: GPUBindGroupLayout;\r\n    private _pipelineLayout: GPUPipelineLayout;\r\n\r\n    private _bindGroupModel: GPUBindGroup;\r\n    private _bindGroupPer: GPUBindGroup;\r\n\r\n    private _lightFactorBuffer: GPUBuffer;\r\n    private _timeBuffer: GPUBuffer;\r\n    private _viewBuffer: GPUBuffer;\r\n\r\n    private _contextWebGPU: Nullable<ContextWebGPU> = null;\r\n    private _programWebGPU: Nullable<ProgramWebGPU> = null;\r\n    private _aquarium: Nullable<Aquarium> = null;\r\n\r\n    private _instance: int;\r\n\r\n    constructor(context: Nullable<Context>, aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean) {\r\n        super(type, name, blend);\r\n        this._instance = 0;\r\n\r\n        this._contextWebGPU = context as Nullable<ContextWebGPU>;\r\n        this._aquarium      = aquarium;\r\n\r\n        this._vertexStateDescriptor = new ComboVertexStateDescriptor();\r\n\r\n        this.lightFactorUniforms.shininess      = 50.0;\r\n        this.lightFactorUniforms.specularFactor = 1.0;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._pipeline          = null;\r\n        this._groupLayoutModel  = null;\r\n        this._groupLayoutPer    = null;\r\n        this._pipelineLayout    = null;\r\n        this._bindGroupModel    = null;\r\n        this._bindGroupPer      = null;\r\n        this._lightFactorBuffer = null;\r\n        this._viewBuffer        = null;\r\n        this._timeBuffer        = null;\r\n    }\r\n\r\n    public init(): void {\r\n        this._programWebGPU = this._program as Nullable<ProgramWebGPU>;\r\n\r\n        this.diffuseTexture    = this.textureMap[\"diffuse\"] as TextureWebGPU;\r\n        this.normalTexture     = this.textureMap[\"normalMap\"] as TextureWebGPU;\r\n        this.reflectionTexture = this.textureMap[\"reflectionMap\"] as TextureWebGPU;\r\n        this.skyboxTexture     = this.textureMap[\"skybox\"] as TextureWebGPU;\r\n\r\n        this.positionBuffer = this.bufferMap[\"position\"] as BufferWebGPU;\r\n        this.normalBuffer   = this.bufferMap[\"normal\"] as BufferWebGPU;\r\n        this.texCoordBuffer = this.bufferMap[\"texCoord\"] as BufferWebGPU;\r\n        this.indicesBuffer  = this.bufferMap[\"indices\"] as BufferWebGPU;\r\n\r\n        this._vertexStateDescriptor.cVertexBuffers[0].arrayStride = this.positionBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[0].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[0].shaderLocation = 0;\r\n        this._vertexStateDescriptor.cAttributes[0].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[0].attributes  = [this._vertexStateDescriptor.cAttributes[0]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[1].arrayStride = this.normalBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[1].format         = \"float3\";\r\n        this._vertexStateDescriptor.cAttributes[1].shaderLocation = 1;\r\n        this._vertexStateDescriptor.cAttributes[1].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[1].attributes  = [this._vertexStateDescriptor.cAttributes[1]];\r\n        \r\n        this._vertexStateDescriptor.cVertexBuffers[2].arrayStride = this.texCoordBuffer.dataSize;\r\n        this._vertexStateDescriptor.cAttributes[2].format         = \"float2\";\r\n        this._vertexStateDescriptor.cAttributes[2].shaderLocation = 2;\r\n        this._vertexStateDescriptor.cAttributes[2].offset         = 0;\r\n        this._vertexStateDescriptor.cVertexBuffers[2].attributes  = [this._vertexStateDescriptor.cAttributes[2]];\r\n          \r\n        this._vertexStateDescriptor.vertexBufferCount             = 3;\r\n        this._vertexStateDescriptor.indexFormat                   = \"uint16\";\r\n\r\n        this._groupLayoutModel = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"uniform-buffer\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampler\"\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\",\r\n                        hasDynamicOffset: false,\r\n                        multisampled: false,\r\n                        viewDimension:\"2d\",\r\n                        textureComponentType: \"float\"\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._groupLayoutPer = this._contextWebGPU.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n\r\n        this._pipelineLayout = this._contextWebGPU.makeBasicPipelineLayout(\r\n            <GPUPipelineLayoutDescriptor> {\r\n                bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                    this._contextWebGPU.groupLayoutGeneral,\r\n                    this._contextWebGPU.groupLayoutWorld,\r\n                    this._groupLayoutModel,\r\n                    this._groupLayoutPer,\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._pipeline = this._contextWebGPU.createRenderPipeline(\r\n            this._pipelineLayout,\r\n            this._programWebGPU,\r\n            this._vertexStateDescriptor,\r\n            this._blend\r\n        );\r\n\r\n        this._lightFactorBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.lightFactorUniforms.data,\r\n                                                     LightFactorUniforms.byteSize,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._timeBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.seaweedPer.data,\r\n                                                     this._contextWebGPU.calcConstantBufferByteSize(this.seaweedPer.byteSize) * 4,\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._viewBuffer =\r\n            this._contextWebGPU.createBufferFromData(this.worldUniformPer.data,\r\n                                                     this._contextWebGPU.calcConstantBufferByteSize(this.worldUniformPer.byteSize),\r\n                                                     GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this._bindGroupModel = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutModel,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._lightFactorBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        resource: this.diffuseTexture.sampler\r\n                    },\r\n                    {\r\n                        binding: 2,\r\n                        resource: this.diffuseTexture.textureView\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._bindGroupPer = this._contextWebGPU.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this._groupLayoutPer,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._viewBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._timeBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._contextWebGPU.setBufferData(this._lightFactorBuffer, 0, LightFactorUniforms.byteSize,\r\n                                          this.lightFactorUniforms.data);\r\n    }\r\n\r\n    public prepareForDraw(): void {\r\n        this._contextWebGPU.updateBufferData(this._viewBuffer, this.worldUniformPer.data,\r\n            this._contextWebGPU.calcConstantBufferByteSize(this.worldUniformPer.byteSize));\r\n        this._contextWebGPU.updateBufferData(this._timeBuffer, this.seaweedPer.data,\r\n            this._contextWebGPU.calcConstantBufferByteSize(this.seaweedPer.byteSize));\r\n    }\r\n\r\n    public draw(): void {\r\n        const pass = this._contextWebGPU.renderPass;\r\n        pass.setPipeline(this._pipeline);\r\n        pass.setBindGroup(0, this._contextWebGPU.bindGroupGeneral);\r\n        pass.setBindGroup(1, this._contextWebGPU.bindGroupWorld);\r\n        pass.setBindGroup(2, this._bindGroupModel);\r\n        pass.setBindGroup(3, this._bindGroupPer);\r\n        pass.setVertexBuffer(0, this.positionBuffer.buffer);\r\n        pass.setVertexBuffer(1, this.normalBuffer.buffer);\r\n        pass.setVertexBuffer(2, this.texCoordBuffer.buffer);\r\n        pass.setIndexBuffer(this.indicesBuffer.buffer, 0);\r\n        pass.drawIndexed(this.indicesBuffer.totalComponents, this._instance, 0, 0, 0);\r\n        this._instance = 0;\r\n    }\r\n\r\n    public updatePerInstanceUniforms(worldUniforms: WorldUniforms): void {\r\n        this.worldUniformPer.worldUniforms[this._instance] = worldUniforms.clone();\r\n        this.seaweedPer.time[this._instance]               = this._aquarium.g.mclock + this._instance;\r\n\r\n        this._instance++;\r\n    }\r\n\r\n    public updateSeaweedModelTime(time: float): void { }\r\n\r\n}","\r\n/**\r\n * A Module with various io functions.\r\n */\r\nexport class IO {\r\n\r\n    /**\r\n     * Loads text from an external file. This function is synchronous.\r\n     * @param {string} url The url of the external file.\r\n     * @return {string} the loaded text if the request is synchronous.\r\n     */\r\n    public static LoadTextFileSynchronous(url: string): string {\r\n        const error: string = 'LoadTextFileSynchronous failed to load url \"' + url + '\"';\r\n        let xhr: XMLHttpRequest = null;\r\n        if (window.XMLHttpRequest) {\r\n            xhr = new XMLHttpRequest();\r\n            if (xhr.overrideMimeType) {\r\n                xhr.overrideMimeType('text/plain');\r\n            }\r\n        } else {\r\n            throw 'XMLHttpRequest is disabled';\r\n        }\r\n        xhr.open('GET', url, false);\r\n        xhr.send(null);\r\n        if (xhr.readyState != 4) {\r\n            throw error;\r\n        }\r\n        return xhr.responseText;\r\n    }\r\n\r\n    /**\r\n     * Loads text from an external file. This function is asynchronous.\r\n     * @param {string} url The url of the external file.\r\n     * @param {function(string, *): void} callback A callback passed the loaded\r\n     *     string and an exception which will be null on success.\r\n     */\r\n    public static LoadTextFile(url: string, callback: (result: string, errorMsg: string) => void): void {\r\n        const error: string = 'LoadTextFile failed to load url \"' + url + '\"';\r\n        let xhr: XMLHttpRequest = null;\r\n        if (window.XMLHttpRequest) {\r\n            xhr = new XMLHttpRequest();\r\n            if (xhr.overrideMimeType) {\r\n                xhr.overrideMimeType('text/plain; charset=utf-8');\r\n            } \r\n        } else {\r\n            throw 'XMLHttpRequest is disabled';\r\n        }\r\n        xhr.open('GET', url, true);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4) {\r\n                let text = '';\r\n                // HTTP reports success with a 200 status. The file protocol reports\r\n                // success with zero. HTTP does not use zero as a status code (they\r\n                // start at 100).\r\n                // https://developer.mozilla.org/En/Using_XMLHttpRequest\r\n                let success = xhr.status == 200 || xhr.status == 0;\r\n                if (success) {\r\n                    text = xhr.responseText;\r\n                }\r\n                callback(text, success ? null : 'could not load: ' + url);\r\n            }\r\n        };\r\n        xhr.send(null);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from an external file. This function is asynchronous.\r\n     * @param {string} url The url of the external file.\r\n     * @param {function(string, *): void} callback A callback passed the loaded\r\n     *     ArrayBuffer and an exception which will be null on success.\r\n     */\r\n    public static LoadArrayBuffer(url: string, callback: (result: ArrayBuffer, errorMsg: string) => void): void {\r\n        const error: string = 'LoadArrayBuffer failed to load url \"' + url + '\"';\r\n        let xhr: XMLHttpRequest = null;\r\n        if (window.XMLHttpRequest) {\r\n            xhr = new XMLHttpRequest();\r\n        } else {\r\n            throw 'XMLHttpRequest is disabled';\r\n        }\r\n        xhr.open('GET', url, true);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4) {\r\n                let arrayBuffer: ArrayBuffer = undefined;\r\n                let success = xhr.status == 200 || xhr.status == 0;\r\n                if (success) {\r\n                    arrayBuffer = xhr.response;\r\n                }\r\n                callback(arrayBuffer, success ? null : 'could not load: ' + url);\r\n            }\r\n        };\r\n        if (xhr.responseType === undefined) {\r\n            throw 'no support for binary files';\r\n        }\r\n        xhr.responseType = \"arraybuffer\";\r\n        xhr.send(null);\r\n    }\r\n\r\n    /**\r\n     * Loads JSON from an external file. This function is asynchronous.\r\n     * @param {string} url The url of the external file.\r\n     * @param {function(jsonObject, *): void} callback A callback passed the loaded\r\n     *     json and an exception which will be null on success.\r\n     */\r\n    public static LoadJSON(url: string, callback: (result: any, errorMsg: string) => void): void {\r\n        const error: string = 'LoadJSON failed to load url \"' + url + '\"';\r\n        let xhr: XMLHttpRequest = null;\r\n        if (window.XMLHttpRequest) {\r\n            xhr = new XMLHttpRequest();\r\n            if (xhr.overrideMimeType) {\r\n                xhr.overrideMimeType('text/plain; charset=utf-8');\r\n            } \r\n        } else {\r\n            throw 'XMLHttpRequest is disabled';\r\n        }\r\n        xhr.open('GET', url, true);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4) {\r\n                let json: JSON = undefined;\r\n                let success = xhr.status == 200 || xhr.status == 0;\r\n                if (success) {\r\n                    try {\r\n                        json = JSON.parse(xhr.responseText);\r\n                    } catch (e) {\r\n                        success = false;\r\n                    }\r\n                }\r\n                callback(json, success ? null : 'could not load: ' + url);\r\n            }\r\n        };\r\n        xhr.send(null);\r\n    }\r\n\r\n}\r\n","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport { Nullable } from \"./types\";\r\nimport { ContextWebGPU, SingleShaderStage } from \"./context\";\r\nimport { IO } from \"./io\";\r\n\r\n/**\r\n * Define base class for Programs of specific backends.\r\n */\r\nexport class Program {\r\n\r\n    protected _vertexShaderCodePath: string;\r\n    protected _fragmentShaderCodePath: string;\r\n\r\n    protected _vertexShaderCode: string;\r\n    protected _fragmentShaderCode: string;\r\n\r\n    constructor(vertexShaderCodePath?: string, fragmentShaderCodePath?: string) {\r\n        if (vertexShaderCodePath) {\r\n            this._vertexShaderCodePath = vertexShaderCodePath;\r\n        }\r\n\r\n        if (fragmentShaderCodePath) {\r\n            this._fragmentShaderCodePath = fragmentShaderCodePath;\r\n        }\r\n    }\r\n\r\n    public get vertexShaderCode(): string {\r\n        return this._vertexShaderCode;\r\n    }\r\n\r\n    public set vertexShaderCode(value: string) {\r\n        this._vertexShaderCode = value;\r\n    }\r\n\r\n    public get fragmentShaderCode(): string {\r\n        return this._fragmentShaderCode;\r\n    }\r\n\r\n    public set fragmentShaderCode(value: string) {\r\n        this._fragmentShaderCode = value;\r\n    }\r\n\r\n    public dispose(): void { }\r\n    public setProgram(): void {}\r\n    public async compileProgram(enableAlphaBlending?: boolean, alpha?: string): Promise<void> { }\r\n\r\n    protected async loadProgram(): Promise<boolean> {\r\n        const promises = new Array<Promise<any>>();\r\n\r\n        // Shader loading helper function\r\n        const loadshader = (shaderPath: string, stage: SingleShaderStage) => {\r\n            promises.push(new Promise((resolve, reject) => {\r\n                IO.LoadTextFile(shaderPath, (result: string, exception: string) => {\r\n                    if (exception) {\r\n                        console.error(\"Unable to load shader: \" + exception);\r\n                        reject(exception);\r\n                    }\r\n                    switch(stage) {\r\n                        case SingleShaderStage.Vertex:\r\n                            this._vertexShaderCode = result;\r\n                            resolve();\r\n                            break;\r\n                        case SingleShaderStage.Fragment:\r\n                            this._fragmentShaderCode = result;\r\n                            resolve();\r\n                            break;\r\n                        default:\r\n                            reject(\"Unsupported stage: \" + stage);\r\n                    }\r\n                });\r\n            }));\r\n        };\r\n\r\n        // Vertex and Fragment shader loading promise\r\n        loadshader(this._vertexShaderCodePath, SingleShaderStage.Vertex);\r\n        loadshader(this._fragmentShaderCodePath, SingleShaderStage.Fragment);\r\n\r\n        return Promise.all(promises)\r\n                .then(() => {return true;})\r\n                .catch(() => {\r\n                    console.error(\"Unable to load program.\");\r\n                    return false;\r\n                });\r\n    }\r\n}\r\n\r\n/**\r\n * Defines the Program wrapper of WebGPU.\r\n */\r\nexport class ProgramWebGPU extends Program {\r\n\r\n    public _vertexShaderModule: GPUShaderModule;\r\n    public _fragmentShaderModule: GPUShaderModule;\r\n\r\n    private _context: Nullable<ContextWebGPU> = null;\r\n\r\n    constructor(context: Nullable<ContextWebGPU>, vertexShaderCodePath?: string, fragmentShaderCodePath?: string) {\r\n        super(vertexShaderCodePath, fragmentShaderCodePath);\r\n        this._context = context;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._vertexShaderModule = null;\r\n        this._fragmentShaderModule = null;\r\n\r\n        super.dispose();\r\n    }\r\n\r\n    public async compileProgram(enableBlending?: boolean, alpha?: string): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            this.loadProgram().then((success: boolean) => {\r\n                if (success) {\r\n                    this._fragmentShaderCode = this._fragmentShaderCode.replace(/^.*?\\/\\/ #noReflection$/gm, \"\");\r\n                    this._fragmentShaderCode = this._fragmentShaderCode.replace(/^.*?\\/\\/ #noNormalMap$/gm, \"\");\r\n    \r\n                    if (enableBlending) {\r\n                        this._fragmentShaderCode = this._fragmentShaderCode.replace(/diffuseColor.a/gm, alpha);\r\n                    }\r\n    \r\n                    this._vertexShaderModule = this._context.createShaderModule(SingleShaderStage.Vertex, this._vertexShaderCode);\r\n                    this._fragmentShaderModule = this._context.createShaderModule(SingleShaderStage.Fragment, this._fragmentShaderCode);\r\n                    resolve();\r\n                }\r\n                else {\r\n                    console.error(\"Unable to compile shader code.\");\r\n                    reject();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public get vertexShaderModule(): Nullable<GPUShaderModule> {\r\n        return this._vertexShaderModule;\r\n    }\r\n\r\n    public get fragmentShaderModule(): Nullable<GPUShaderModule> {\r\n        return this._fragmentShaderModule;\r\n    }\r\n\r\n}","import { size_t } from \"./types\";\r\n\r\nconst slash: string          = \"/\";\r\nconst shaderFolder: string   = \"../shaders\";\r\nconst resourceFolder: string = \"../assets\";\r\nconst skyBoxUrls: string[]   = [\r\n    \"GlobeOuter_EM_positive_x.jpg\", \"GlobeOuter_EM_negative_x.jpg\",\r\n    \"GlobeOuter_EM_positive_y.jpg\", \"GlobeOuter_EM_negative_y.jpg\",\r\n    \"GlobeOuter_EM_positive_z.jpg\", \"GlobeOuter_EM_negative_z.jpg\"\r\n];\r\n\r\nexport class ResourceHelper {\r\n\r\n    private _path: string;\r\n    private _imagePath: string;\r\n    private _programPath: string;\r\n    private _propPlacementPath: string;\r\n    private _fishBehaviorPath: string;\r\n\r\n    constructor(path) {\r\n        this._path = path;\r\n        this._imagePath = this._path + resourceFolder + slash;\r\n        this._programPath = this._path + shaderFolder + slash ;\r\n        this._propPlacementPath = this._path + resourceFolder + slash + \"PropPlacement.js\";\r\n        this._fishBehaviorPath = this._path + \"FishBehavior.json\";\r\n    }\r\n\r\n    public get imagePath(): string {\r\n        return this._imagePath;\r\n    }\r\n\r\n    public get programPath(): string {\r\n        return this._programPath;\r\n    }\r\n\r\n    public get propPlacementPath(): string {\r\n        return this._propPlacementPath;\r\n    }\r\n\r\n    public get fishBehaviorPath(): string {\r\n        return this._fishBehaviorPath;\r\n    }\r\n\r\n    public getSkyBoxUrls(): string[] {\r\n        let skyUrls: string[] = [];\r\n        for (let i: size_t = 0; i < skyBoxUrls.length; ++i) {\r\n            const url = this._path + resourceFolder + slash + skyBoxUrls[i];\r\n            skyUrls.push(url);\r\n        }\r\n        return skyUrls\r\n    }\r\n\r\n    public getModelPath(modelName: string): string {\r\n        return this._imagePath + modelName + \".js\";\r\n    }\r\n\r\n}","export default async function() {\r\n  // @ts-ignore\r\n  const statsjsModule = await import(/* webpackIgnore: true */ 'https://cdnjs.cloudflare.com/ajax/libs/stats.js/r17/Stats.min.js');\r\n  const statsjs = await statsjsModule.default();\r\n  return statsjs;\r\n}\r\n","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport { Nullable, int, uint32_t, size_t, BuildArray } from \"./types\";\r\nimport { ContextWebGPU } from \"./context\";\r\nimport { ProgramWebGPU } from \"./program\";\r\n\r\n/**\r\n * Defines an abstract Texture for Aquarium.\r\n */\r\nexport class Texture {\r\n\r\n    protected _urls: string[];\r\n    protected _width: int = 0;\r\n    protected _height: int = 0;\r\n    protected _flip: boolean;\r\n    protected _name: string;\r\n\r\n    constructor(name: string, urls: string | string[], flip: boolean) {\r\n        this._name = name;\r\n        this._urls = Array.isArray(urls) ? urls : [urls];\r\n        this._flip = flip;\r\n    }\r\n\r\n    public dispose(): void { }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public static imageFlipY(image: HTMLImageElement): void {\r\n        const imageCanvas = document.createElement('canvas');\r\n        imageCanvas.width = image.width;\r\n        imageCanvas.height = image.height;\r\n\r\n        const imageCanvasContext = imageCanvas.getContext('2d');\r\n        imageCanvasContext.translate(0, image.height);\r\n        imageCanvasContext.scale(1, -1);\r\n        imageCanvasContext.drawImage(image, 0, 0, image.width, image.height);\r\n        image.src = imageCanvas.toDataURL();\r\n    }\r\n\r\n    public static async loadImage(urls: Array<string>, flipY: boolean): Promise<Array<HTMLImageElement>> {\r\n        return new Promise(async (resolve, reject) => {\r\n            let images: Array<HTMLImageElement> = [];\r\n            for (let i: size_t = 0; i < urls.length; ++i) {\r\n                const img: HTMLImageElement = new Image();\r\n                try {\r\n                    img.src = urls[i];\r\n                    await img.decode();\r\n                    if (flipY) {\r\n                        Texture.imageFlipY(img);\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Unable to load image from url: \" + urls[i]);\r\n                    reject(images);\r\n                }\r\n                images.push(img);\r\n            }\r\n            resolve(images);\r\n        });\r\n    }\r\n\r\n    protected resizeImage(img: HTMLImageElement, width: uint32_t, height: uint32_t): ImageData {\r\n        const imageCanvas: HTMLCanvasElement = document.createElement('canvas');\r\n        imageCanvas.width = img.width;\r\n        imageCanvas.height = img.height;\r\n\r\n        const imageCanvasContext: CanvasRenderingContext2D = imageCanvas.getContext('2d');\r\n        imageCanvasContext.drawImage(img, 0, 0, width, height);\r\n        const imageData: ImageData = imageCanvasContext.getImageData(0, 0, width, height);\r\n        return imageData;\r\n    }\r\n\r\n    protected isPowerOf2(value: int): boolean {\r\n        return (value & (value - 1)) == 0;\r\n    }\r\n\r\n    /**\r\n     * Free image data after upload to gpu. \r\n     */\r\n    protected destroyImageData(pixelVec: Float32Array[] | Uint16Array[] | Array<Uint8ClampedArray>): void {\r\n        pixelVec.length = 0;\r\n    }\r\n\r\n    public loadTexture(): void {}\r\n\r\n    public getImagePixels(image: HTMLImageElement): Uint8ClampedArray {\r\n        const imageCanvas = document.createElement('canvas');\r\n        imageCanvas.width = image.width;\r\n        imageCanvas.height = image.height;\r\n\r\n        const imageCanvasContext = imageCanvas.getContext('2d');\r\n        if (this._flip) {\r\n            imageCanvasContext.translate(0, image.height);\r\n            imageCanvasContext.scale(1, -1);\r\n        }\r\n        imageCanvasContext.drawImage(image, 0, 0, image.width, image.height);\r\n        const imageData: ImageData = imageCanvasContext.getImageData(0, 0, image.width, image.height);\r\n\r\n        let data: Uint8ClampedArray = null;\r\n\r\n        const bytesPerRow = Math.ceil(image.width * 4 / image.width) * image.width;\r\n        if (bytesPerRow == image.width * 4) {\r\n            data = imageData.data;\r\n        } else {\r\n            data = new Uint8ClampedArray(bytesPerRow * image.height);\r\n            let imagePixelIndex = 0;\r\n            for (let y = 0; y < image.height; ++y) {\r\n                for (let x = 0; x < image.width; ++x) {\r\n                    let i = x * 4 + y * bytesPerRow;\r\n                    data[i] = imageData.data[imagePixelIndex];\r\n                    data[i + 1] = imageData.data[imagePixelIndex + 1];\r\n                    data[i + 2] = imageData.data[imagePixelIndex + 2];\r\n                    data[i + 3] = imageData.data[imagePixelIndex + 3];\r\n                    imagePixelIndex += 4;\r\n                }\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n}\r\n\r\nexport class TextureWebGPU extends Texture {\r\n\r\n    private _textureDimension: GPUTextureDimension; // texture 2D or CubeMap\r\n    private _textureViewDimension: GPUTextureViewDimension;\r\n    private _texture: GPUTexture;\r\n    private _sampler: GPUSampler;\r\n    private _format: GPUTextureFormat;\r\n    private _textureView: GPUTextureView;\r\n    private _images: Array<HTMLImageElement>;\r\n    private _pixelVec: Array<Uint8ClampedArray>;\r\n    private _resizedVec: Array<Uint8ClampedArray>;\r\n    private _context: Nullable<ContextWebGPU> = null;\r\n    private _gpuTextureHelper: WebGPUTextureHelper = null\r\n\r\n    constructor(context: Nullable<ContextWebGPU>, name: string, urls: string | string[]) {\r\n        super(name, Array.isArray(urls) ? urls : [urls], Array.isArray(urls) ? false : true)\r\n        this._textureDimension = \"2d\";\r\n        this._textureViewDimension = Array.isArray(urls) ? \"cube\" : \"2d\";\r\n        this._format = \"rgba8unorm\"\r\n        this._context = context\r\n        this._gpuTextureHelper = new WebGPUTextureHelper(context)\r\n    }\r\n\r\n    public dispose(): void {\r\n        this.destroyImageData(this._pixelVec);\r\n        this.destroyImageData(this._resizedVec);\r\n        this._textureView = null;\r\n        this._texture     = null;\r\n        this._sampler     = null;\r\n    }\r\n    \r\n    public get textureDimension(): GPUTextureDimension {\r\n        return this._textureDimension;\r\n    }\r\n\r\n    public get textureViewDimension(): GPUTextureViewDimension {\r\n        return this._textureViewDimension;\r\n    }\r\n\r\n    public get textureId(): GPUTexture {\r\n        return this._texture;\r\n    }\r\n\r\n    public get sampler(): GPUSampler {\r\n        return this._sampler;\r\n    }\r\n\r\n    public get textureView(): GPUTextureView {\r\n        return this._textureView;\r\n    }\r\n\r\n    private _onImageLoaded(): void {\r\n        if (this._images.length > 0) {\r\n            this._width = this._images[0].width;\r\n            this._height = this._images[0].height;\r\n            this._pixelVec = BuildArray(this._images.length, () => null);\r\n        }\r\n    }\r\n\r\n    public async loadTexture(): Promise<void> {\r\n        return Promise.resolve().then(async () => {\r\n            const kPadding: int = 256;\r\n            this._images = await Texture.loadImage(this._urls, this._flip);\r\n            this._onImageLoaded();\r\n            \r\n            if (this._textureViewDimension === \"cube\") {\r\n                const descriptor: GPUTextureDescriptor = {\r\n                    dimension: this._textureDimension,\r\n                    size: <GPUExtent3DDict> {\r\n                        width: this._width,\r\n                        height: this._height,\r\n                        depth: 6 // arrayLayerCount is deprecated\r\n                    },\r\n                    sampleCount: 1,\r\n                    format: this._format,\r\n                    mipLevelCount: 1,\r\n                    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.SAMPLED\r\n                };\r\n                this._texture = this._context.createTexture(descriptor);\r\n                \r\n                for (let i: uint32_t = 0; i < 6; ++i) {\r\n                    let [resultBuffer, resultData] = this._context.createBufferMapped(\r\n                        this._width * this._height * 4,\r\n                        GPUBufferUsage.COPY_SRC | GPUBufferUsage.MAP_WRITE\r\n                    );\r\n                    this._pixelVec[i] = this.getImagePixels(this._images[i]);\r\n                    new Uint8Array(resultData).set(this._pixelVec[i]);\r\n                    resultBuffer.unmap();\r\n\r\n                    const bufferCopyView: GPUBufferCopyView = this._context.createBufferCopyView(resultBuffer, 0, this._width * 4, this._height);\r\n                    const textureCopyView: GPUTextureCopyView = this._context.createTextureCopyView(\r\n                        this._texture, 0,\r\n                        <GPUOrigin3DDict> {\r\n                            x: 0,\r\n                            y: 0,\r\n                            z: i\r\n                        }\r\n                    );\r\n                    const copySize: GPUExtent3DDict = {\r\n                        width: this._width,\r\n                        height: this._height,\r\n                        depth: 1\r\n                    };\r\n                    this._context.commandBuffers.push(\r\n                        this._context.copyBufferToTexture(bufferCopyView, textureCopyView, copySize)\r\n                    );\r\n                }\r\n\r\n                const viewDescriptor: GPUTextureViewDescriptor = {\r\n                    dimension: \"cube\",\r\n                    format: this._format,\r\n                    baseMipLevel: 0,\r\n                    mipLevelCount: 1,\r\n                    baseArrayLayer: 0,\r\n                    arrayLayerCount: 6\r\n                }\r\n        \r\n                this._textureView = this._texture.createView(viewDescriptor);\r\n        \r\n                let samplerDesc: GPUSamplerDescriptor = {\r\n                    addressModeU: \"clamp-to-edge\",\r\n                    addressModeV: \"clamp-to-edge\",\r\n                    addressModeW: \"clamp-to-edge\",\r\n                    minFilter: \"linear\",\r\n                    magFilter: \"linear\",\r\n                    mipmapFilter: \"nearest\"\r\n                };\r\n        \r\n                this._sampler = this._context.createSampler(samplerDesc);\r\n            }\r\n            else { // \"2d\"\r\n                this._texture = await this._gpuTextureHelper.generateMipmappedTexture(this._images[0]);\r\n                this._width = this._gpuTextureHelper.imageBitmapSize.width;\r\n                this._height = this._gpuTextureHelper.imageBitmapSize.height;\r\n                \r\n                const viewDescriptor: GPUTextureViewDescriptor = {\r\n                    dimension: \"2d\",\r\n                    format: this._format,\r\n                    baseMipLevel: 0,\r\n                    mipLevelCount: Math.trunc(Math.floor(Math.log2(Math.min(this._width, this._height)))) + 1,\r\n                    baseArrayLayer: 0,\r\n                    arrayLayerCount: 1\r\n                }\r\n        \r\n                this._textureView = this._texture.createView(viewDescriptor);\r\n        \r\n                let samplerDesc: GPUSamplerDescriptor = {\r\n                    addressModeU: \"clamp-to-edge\",\r\n                    addressModeV: \"clamp-to-edge\",\r\n                    addressModeW: \"clamp-to-edge\",\r\n                    minFilter: \"linear\",\r\n                    magFilter: \"linear\",\r\n                    mipmapFilter: (this.isPowerOf2(this._width) && this.isPowerOf2(this._height)) ? \"linear\" : \"nearest\"\r\n                };\r\n        \r\n                this._sampler = this._context.createSampler(samplerDesc);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Class containing helper functions for creating textures.\r\n * @see https://github.com/toji/webgpu-test\r\n */\r\nexport class WebGPUTextureHelper {\r\n\r\n    private _context: Nullable<ContextWebGPU> = null;\r\n    private _device: GPUDevice = null;\r\n\r\n    public mipmapSampler: GPUSampler;\r\n    public mipmapBindGroupLayout: GPUBindGroupLayout;\r\n    public mipmapPipeline: GPURenderPipeline;\r\n    public imageBitmapSize: GPUExtent3DDict;\r\n\r\n    constructor(context: Nullable<ContextWebGPU>) {\r\n        this._context = context\r\n        this._device = this._context.device;\r\n  \r\n        const mipmapVertexShaderSource = `#version 450\r\n            const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\r\n            const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\r\n            layout(location = 0) out vec2 vTex;\r\n            void main() {\r\n            vTex = tex[gl_VertexIndex];\r\n            gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\r\n            }\r\n        `;\r\n  \r\n        const mipmapFragmentShaderSource = `#version 450\r\n            layout(set = 0, binding = 0) uniform sampler imgSampler;\r\n            layout(set = 0, binding = 1) uniform texture2D img;\r\n            layout(location = 0) in vec2 vTex;\r\n            layout(location = 0) out vec4 outColor;\r\n            void main() {\r\n            outColor = texture(sampler2D(img, imgSampler), vTex);\r\n            }\r\n        `;\r\n  \r\n        this.mipmapSampler = this._context.createSampler(\r\n            <GPUSamplerDescriptor> {\r\n                minFilter: 'linear'\r\n            }\r\n        );\r\n\r\n        this.mipmapBindGroupLayout = this._context.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampler\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"sampled-texture\"\r\n                    },\r\n                ]\r\n            }\r\n        );\r\n  \r\n        this.mipmapPipeline = this._device.createRenderPipeline(<GPURenderPipelineDescriptor> {\r\n            layout: this._device.createPipelineLayout(\r\n                <GPUPipelineLayoutDescriptor> {\r\n                    bindGroupLayouts: <GPUBindGroupLayout[]> [\r\n                        this.mipmapBindGroupLayout\r\n                    ]\r\n                }\r\n            ),\r\n            vertexStage: <GPUProgrammableStageDescriptor> {\r\n                module: this._device.createShaderModule(\r\n                    <GPUShaderModuleDescriptor> {\r\n                        code: this._context.glslang.compileGLSL(mipmapVertexShaderSource, 'vertex')\r\n                    }\r\n                ),\r\n                entryPoint: 'main'\r\n            },\r\n            fragmentStage: <GPUProgrammableStageDescriptor> {\r\n                module: this._device.createShaderModule(\r\n                    <GPUShaderModuleDescriptor> {\r\n                        code: this._context.glslang.compileGLSL(mipmapFragmentShaderSource, 'fragment')\r\n                    }\r\n                ),\r\n                entryPoint: 'main'\r\n            },\r\n            primitiveTopology: 'triangle-strip',\r\n            colorStates: <GPUColorStateDescriptor[]> [\r\n                <GPUColorStateDescriptor> {\r\n                    format: 'rgba8unorm',\r\n                }\r\n            ]\r\n        });\r\n    }\r\n  \r\n    async generateMipmappedTexture(image: HTMLImageElement): Promise<GPUTexture> {\r\n        return new Promise(async (resolve, reject) => {\r\n            let imageBitmap: ImageBitmap = await createImageBitmap(image,  0,  0, image.width, image.height);\r\n\r\n            this.imageBitmapSize = <GPUExtent3DDict> {\r\n                width: imageBitmap.width,\r\n                height: imageBitmap.height,\r\n                depth: 1,\r\n            }\r\n\r\n            const textureSize: GPUExtent3DDict = <GPUExtent3DDict> {\r\n                width: imageBitmap.width,\r\n                height: imageBitmap.height,\r\n                depth: 1,\r\n            }\r\n            const mipLevelCount: uint32_t = Math.floor(Math.log2(Math.max(imageBitmap.width, imageBitmap.height))) + 1;\r\n        \r\n            // Populate the top level of the srcTexture with the imageBitmap.\r\n            const srcTexture: GPUTexture = this._device.createTexture(<GPUTextureDescriptor> {\r\n                size: textureSize,\r\n                format: 'rgba8unorm',\r\n                usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.SAMPLED | GPUTextureUsage.OUTPUT_ATTACHMENT,\r\n                mipLevelCount\r\n            });\r\n            this._device.defaultQueue.copyImageBitmapToTexture({ imageBitmap }, { texture: srcTexture }, textureSize);\r\n        \r\n            // BUG: The fact that we have to create a second texture here is due to a bug in Chrome that doesn't allow you to\r\n            // use a single texture as both a sampler and a output attachement at the same time. If we could do that this code\r\n            // would use half as much GPU allocations and no copyTextureToTexture calls.\r\n            const mipmappedTexture: GPUTexture = this._device.createTexture(<GPUTextureDescriptor> {\r\n                size: textureSize,\r\n                format: 'rgba8unorm',\r\n                usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.SAMPLED | GPUTextureUsage.OUTPUT_ATTACHMENT,\r\n                mipLevelCount\r\n            });\r\n        \r\n            const commandEncoder: GPUCommandEncoder = this._device.createCommandEncoder({});\r\n        \r\n            // BUG: Chrome currently says that if any level of a texture is incomplete the entire thing gets wiped to black when\r\n            // you attempt to sample from it. This is despite the fact that below we're using texture views restricted\r\n            // exclusively to the known populated mip levels. As a result in order for this code to work properly we first have\r\n            // to clear EVERY level of the mip chain (except the first, which was populated with copyImageBitmapToTexture)\r\n            // before we can render with it.\r\n            for (let i: uint32_t = 1; i < mipLevelCount; ++i) {\r\n                const passEncoder: GPURenderPassEncoder = commandEncoder.beginRenderPass(<GPURenderPassDescriptor> {\r\n                    colorAttachments: [\r\n                        <GPURenderPassColorAttachmentDescriptor> {\r\n                            attachment: srcTexture.createView(<GPUTextureViewDescriptor> {\r\n                                baseMipLevel: i,\r\n                                mipLevelCount: 1\r\n                            }),\r\n                            loadValue: { r: 1.0, g: 0.0, b: 0.0, a: 0.0 },\r\n                        }\r\n                    ],\r\n                });\r\n                passEncoder.endPass();\r\n            }\r\n        \r\n            for (let i = 0; i < mipLevelCount; ++i) {\r\n                const bindGroup: GPUBindGroup = this._device.createBindGroup(<GPUBindGroupDescriptor> {\r\n                    layout: this.mipmapBindGroupLayout,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: this.mipmapSampler,\r\n                        },\r\n                        {\r\n                            binding: 1,\r\n                            resource: srcTexture.createView(<GPUTextureViewDescriptor> {\r\n                                baseMipLevel: Math.max(0, i-1),\r\n                                mipLevelCount: 1\r\n                            }),\r\n                        }\r\n                    ],\r\n                });\r\n        \r\n                const passEncoder: GPURenderPassEncoder = commandEncoder.beginRenderPass(\r\n                    <GPURenderPassDescriptor> {\r\n                        colorAttachments: <GPURenderPassColorAttachmentDescriptor[]> [\r\n                            {\r\n                                attachment: mipmappedTexture.createView(\r\n                                    <GPUTextureViewDescriptor> {\r\n                                        baseMipLevel: i,\r\n                                        mipLevelCount: 1\r\n                                    }\r\n                                ),\r\n                                loadValue: 'load',\r\n                            }\r\n                        ],\r\n                    }\r\n                );\r\n                passEncoder.setPipeline(this.mipmapPipeline);\r\n                passEncoder.setBindGroup(0, bindGroup);\r\n                passEncoder.draw(4, 1, 0, 0);\r\n                passEncoder.endPass();\r\n        \r\n                commandEncoder.copyTextureToTexture(\r\n                    {\r\n                        texture: mipmappedTexture,\r\n                        mipLevel: i\r\n                    },\r\n                    {\r\n                        texture: srcTexture,\r\n                        mipLevel: i\r\n                    },\r\n                    textureSize\r\n                );\r\n        \r\n                textureSize.width = Math.ceil(textureSize.width / 2);\r\n                textureSize.height = Math.ceil(textureSize.height / 2);\r\n            }\r\n            this._device.defaultQueue.submit([commandEncoder.finish()]);\r\n        \r\n            srcTexture.destroy();\r\n        \r\n            resolve(mipmappedTexture);\r\n        });\r\n    }\r\n    \r\n  }","/// <reference path=\"../node_modules/@webgpu/types/dist/index.d.ts\" />\r\n\r\nimport * as dat from 'dat.gui';\r\nimport { ASSERT, BuildArray, Nullable, float, int, uint32_t, size_t } from \"./types\";\r\nimport { Aquarium, TOGGLE, MODELGROUP, MODELNAME } from \"./aquarium\";\r\nimport { Buffer, BufferWebGPU } from \"./buffer\";\r\nimport { BufferManagerWebGPU, RingBufferWebGPU } from \"./bufferManager\";\r\nimport { FPSTimer } from \"./fpsTimer\";\r\nimport glslangModule from './glslang';\r\nimport { Model, FishModelWebGPU, FishModelInstancedDrawWebGPU, GenericModelWebGPU,\r\n         InnerModelWebGPU, OutsideModelWebGPU, SeaweedModelWebGPU } from \"./model\";\r\nimport { Program, ProgramWebGPU } from \"./program\";\r\nimport { ResourceHelper } from \"./resourceHelper\";\r\nimport statsjsModule from './stats-js';\r\nimport { Texture, TextureWebGPU } from \"./texture\";\r\nimport { FishPerWithPadding, FogUniforms, LightUniforms, LightWorldPositionUniform } from \"./uniforms\";\r\nimport { ComboRenderPassDescriptor, ComboRenderPipelineDescriptor, ComboVertexStateDescriptor } from \"./utils\";\r\n\r\nexport enum SingleShaderStage { Vertex, Fragment, Compute };\r\n\r\n/**\r\n * Defines the accessing to graphics API of a graphics backend.\r\n */\r\nexport class Context {\r\n\r\n    protected _clientWidth: int;\r\n    protected _clientHeight: int;\r\n    protected _preTotalInstance: int;\r\n    protected _curTotalInstance: int;\r\n\r\n    protected _resourceHelper: Nullable<ResourceHelper> = null;\r\n\r\n    protected _availableToggleBitset: Array<boolean>;\r\n    protected _disableControlPanel: boolean;\r\n\r\n    protected _showOptionWindow: boolean = true;\r\n    protected _gui: dat.GUI;\r\n    protected _guiSettings: any;\r\n    protected _statsFPS: any;\r\n    protected _statsFrameTime: any;\r\n    protected _statsIntialized = false;\r\n\r\n    constructor() {\r\n        this._availableToggleBitset = BuildArray(TOGGLE.TOGGLEMAX, () => false);\r\n    }\r\n\r\n    public get clientWidth(): int {\r\n        return this._clientWidth;\r\n    }\r\n\r\n    public get clientHeight(): int {\r\n        return this._clientHeight;\r\n    }\r\n\r\n    public get availableToggleBitset(): Array<boolean> {\r\n        return this._availableToggleBitset;\r\n    }\r\n\r\n    public get resourceHelper(): Nullable<ResourceHelper> {\r\n        return this._resourceHelper;\r\n    }\r\n\r\n    public statsBegin(): void {\r\n        this._statsFPS.begin();\r\n        this._statsFrameTime.begin();\r\n    }\r\n\r\n    public statsEnd(): void {\r\n        this._statsFPS.end();\r\n        this._statsFrameTime.end();\r\n    }\r\n\r\n    public initialize(toggleBitset: Array<boolean>, canvas: HTMLCanvasElement): Promise<boolean> {\r\n        return Promise.resolve().then(() => {\r\n            return false;\r\n        });\r\n    }\r\n\r\n    public createTextureWebGPU(name: string, urls: string | string[]): Promise<Nullable<Texture>> {\r\n        return Promise.resolve().then(() => {\r\n            return null;\r\n        });\r\n    }\r\n\r\n    public shouldQuit(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public keyBoardQuit(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public createBufferWebGPU(numComponents: int, buffer: Float32Array | Uint16Array, isIndex: boolean): Nullable<Buffer> {\r\n        return null;\r\n    }\r\n\r\n    public createProgram(vsId: string, fsId: string): Nullable<Program> {\r\n        return null;\r\n    }\r\n\r\n    public doFlush(toggleBitset: Array<boolean>): void {}\r\n    public terminate(): void {}\r\n    public flush(): void {}\r\n    public preFrame(): void {}\r\n    public updateFPS(fpsTimer: FPSTimer, fisCountGetter: () => int, fisCountSetter: (fishCount: int) => void, toggleBitset: Array<boolean>): void {}\r\n    \r\n    public showFPS(canvas?: HTMLCanvasElement): void {\r\n        if (!this._statsIntialized && canvas && this._statsFPS && this._statsFrameTime) {\r\n            // FPS\r\n            this._statsFPS.showPanel(0); // Panel 0 = fps\r\n            this._statsFPS.domElement.style.cssText = 'position:absolute;top:10px;left:10px;';\r\n            canvas.parentNode.appendChild(this._statsFPS.domElement);\r\n            // Frame Time\r\n            this._statsFrameTime.showPanel(1); // Panel 1 = ms\r\n            this._statsFrameTime.domElement.style.cssText = 'position:absolute;top:10px;left:91px;';\r\n            canvas.parentNode.appendChild(this._statsFrameTime.domElement);\r\n\r\n            this._statsIntialized = true;\r\n        }\r\n    }\r\n\r\n    public reallocResource(preTotalInstance: int, curTotalInstance: int, enableDynamicBufferOffset: boolean): void {}\r\n    public updateAllFishData(): void {}\r\n    public beginRenderPass(): void {}\r\n\r\n    public createModel(aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean): Nullable<Model> {\r\n        return null;\r\n    };\r\n\r\n    public initGeneralResources(aquarium: Nullable<Aquarium>): void {}\r\n    public updateWorldlUniforms(aquarium: Nullable<Aquarium>): void {}\r\n\r\n    protected renderGUI(canvas: HTMLCanvasElement, fpsTimer: FPSTimer, fisCountGetter: () => int, fisCountSetter: (fishCount: int) => void, toggleBitset: Array<boolean>): void {\r\n        if (!this._gui) {\r\n            this._gui = new dat.GUI({ autoPlace: false});\r\n            // Settings\r\n            this._guiSettings = {\r\n                Resolution: String(this._clientWidth + \"x\" + this.clientHeight),\r\n                MSAAx4: Boolean(toggleBitset[TOGGLE.ENABLEMSAAx4] ? true : false),\r\n                ALPHABLENDING: Boolean(toggleBitset[TOGGLE.ENABLEALPHABLENDING] ? true : false),\r\n                DBO: Boolean(toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET] ? true : false),\r\n                INSTANCEDDRAWS: Boolean(toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS] ? true : false),\r\n                RENDERPASS: Boolean(toggleBitset[TOGGLE.DISABLED3D12RENDERPASS] ? false : true),\r\n                VALIDATION: Boolean(toggleBitset[TOGGLE.DISABLEWEBGPUVALIDATION] ? false : true),\r\n                BUFFERMAPPINGASNC: Boolean(toggleBitset[TOGGLE.BUFFERMAPPINGASYNC] ? true : false)\r\n            };\r\n            if (this._showOptionWindow) {\r\n                this._guiSettings[\"NumberOfFish\"] = Number(fisCountGetter());\r\n            }\r\n            let counter: uint32_t = 0;\r\n            for (let prop in this._guiSettings) {\r\n                const propStr = String(prop);                \r\n                if (propStr === \"NumberOfFish\") {\r\n                    const curfishCount = fisCountGetter();\r\n                    let fishSelection: Array<int> = [1, 10000, 20000, 30000, 50000, 100000];\r\n                    if (!fishSelection.includes(curfishCount)) {\r\n                        fishSelection.push(curfishCount)\r\n                        fishSelection.sort();\r\n                    }\r\n                    var fishCountMap = {};\r\n                    for (let i: int=0; i<fishSelection.length; ++i) {\r\n                        const fishSelectionItem: int = fishSelection[i];\r\n                        fishCountMap[fishSelectionItem] = fishSelectionItem;\r\n                    }\r\n                    const property = this._gui.add(this._guiSettings, 'NumberOfFish', fishCountMap);\r\n                    property.name(\"Number of Fish\");\r\n                    property.onFinishChange(function(value) {\r\n                        fisCountSetter(value);\r\n                    });\r\n                }\r\n                else {\r\n                    const property = this._gui.add(this._guiSettings, String(prop))\r\n                    const value: String | Boolean = this._guiSettings[prop];\r\n                    if (typeof value === 'string' || value instanceof String) {\r\n                        property.name(String(prop) + \": \" + String(value));\r\n                    }\r\n                    else if (typeof value === 'boolean' || value instanceof Boolean) {\r\n                        property.name(String(prop) + \": \" + String(Boolean(value) ? \"ON\" : \"OFF\"));\r\n                    }\r\n                    property.domElement.style.pointerEvents = \"none\";\r\n                    // Navigate through the DOM & add class to the 'span' element\r\n                    this._gui.__ul.childNodes[counter++].childNodes[0].childNodes[0].classList += ' full_width';\r\n                }\r\n            }\r\n            //  Add to canvas\r\n            this._gui.domElement.style.position = 'absolute';\r\n            this._gui.domElement.style.top = '10px';\r\n            this._gui.domElement.style.right = '10px';\r\n            canvas.parentNode.appendChild(this._gui.domElement);\r\n        }\r\n    }\r\n\r\n    protected setWindowSize(windowWidth: int, windowHeight: int): void {\r\n        if (windowWidth !== 0) {\r\n            this._clientWidth = windowWidth;\r\n        }\r\n        if (windowHeight !== 0) {\r\n            this._clientHeight = windowHeight;\r\n        }\r\n    }\r\n\r\n    protected _initAvailableToggleBitset(): void { }\r\n\r\n}\r\n\r\nexport class ContextWebGPU extends Context {\r\n  \r\n    public commandBuffers: Array<GPUCommandBuffer>;\r\n    public queue: GPUQueue;\r\n\r\n    public groupLayoutGeneral: GPUBindGroupLayout;\r\n    public bindGroupGeneral: GPUBindGroup;\r\n    public groupLayoutWorld: GPUBindGroupLayout;\r\n    public bindGroupWorld: GPUBindGroup;\r\n\r\n    public groupLayoutFishPer: GPUBindGroupLayout;\r\n    public fishPersBuffer: GPUBuffer;\r\n    public bindGroupFishPers: Array<GPUBindGroup>;\r\n\r\n    public fishPers: Array<FishPerWithPadding>;\r\n\r\n    public adapter: GPUAdapter; // The backend adapter\r\n    public device: GPUDevice;\r\n    private _hasWebGPUValidationErrors: boolean = false;\r\n    \r\n    private static readonly kSwapchainBackBufferUsage: GPUTextureUsageFlags =\r\n        GPUTextureUsage.OUTPUT_ATTACHMENT | GPUTextureUsage.COPY_SRC;\r\n\r\n    private _glslang: any;\r\n    private _isSwapchainOutOfDate = false;\r\n    private _canvas: HTMLCanvasElement;\r\n    private _gpuCanvasContext: GPUCanvasContext;\r\n\r\n    private _swapChain: GPUSwapChain;\r\n    private _commandEncoder: GPUCommandEncoder;\r\n    private _renderPass: GPURenderPassEncoder;\r\n    private _renderPassDescriptor: Nullable<ComboRenderPassDescriptor> = null;\r\n\r\n    private _backbufferView: GPUTextureView;\r\n    private _sceneRenderTargetView: GPUTextureView;\r\n    private _sceneDepthStencilView: GPUTextureView;\r\n    private _pipeline: GPURenderPipeline;\r\n    private _bindGroup: GPUBindGroup;\r\n    private _preferredSwapChainFormat: GPUTextureFormat = \"rgba8unorm\";\r\n\r\n    private _lightWorldPositionBuffer: GPUBuffer;\r\n    private _lightBuffer: GPUBuffer;\r\n    private _fogBuffer: GPUBuffer;\r\n\r\n    private _enableMSAA: boolean = false;\r\n    private _enableDynamicBufferOffset: boolean = false;\r\n    private _enableFullScreenMode: boolean = false;\r\n\r\n    private _bufferManager: Nullable<BufferManagerWebGPU> = null;\r\n\r\n    constructor() {\r\n        super();\r\n        this.commandBuffers = new Array<GPUCommandBuffer>();\r\n        this.bindGroupFishPers = new Array<GPUBindGroup>();\r\n        this.fishPers = new Array<FishPerWithPadding>();\r\n        this._resourceHelper = new ResourceHelper(document.location.toString());\r\n        this._initAvailableToggleBitset();\r\n    }\r\n\r\n    public get glslang(): any {\r\n        return this._glslang;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._sceneRenderTargetView    = null;\r\n        this._sceneDepthStencilView    = null;\r\n        this._backbufferView           = null;\r\n        this._pipeline                 = null;\r\n        this._bindGroup                = null;\r\n        this._lightWorldPositionBuffer = null;\r\n        this._lightBuffer              = null;\r\n        this._fogBuffer                = null;\r\n        this._commandEncoder           = null;\r\n        this.commandBuffers.length     = 0\r\n        this._renderPass               = null;\r\n        this._renderPassDescriptor     = null;\r\n        this.groupLayoutGeneral        = null;\r\n        this.bindGroupGeneral          = null;\r\n        this.groupLayoutWorld          = null;\r\n        this.bindGroupWorld            = null;\r\n    \r\n        this.groupLayoutFishPer        = null;\r\n        this._destroyFishResource();\r\n    \r\n        this._swapChain                = null;\r\n        this.queue                     = null;\r\n        this.device                    = null;\r\n    }\r\n\r\n    public async initialize(toggleBitset: Array<boolean>, canvas: HTMLCanvasElement): Promise<boolean> {\r\n        this._canvas = canvas;\r\n        \r\n        this._enableMSAA = toggleBitset[TOGGLE.ENABLEMSAAx4];\r\n        this._disableControlPanel = toggleBitset[TOGGLE.DISABLECONTROLPANEL];\r\n        this._enableFullScreenMode = toggleBitset[TOGGLE.ENABLEFULLSCREENMODE];\r\n\r\n        // Set client width and height\r\n        this._syncClientSize();\r\n        \r\n        return new Promise<boolean>(async (resolve, reject) => {\r\n            try {\r\n                // Physical Device Adapter\r\n                this.adapter = await navigator.gpu.requestAdapter();\r\n    \r\n                // Logical Device\r\n                this.device = await this.adapter.requestDevice();\r\n                if (!toggleBitset[TOGGLE.DISABLEWEBGPUVALIDATION]) {\r\n                    if (typeof this.device.addEventListener === 'function') {\r\n                        this.device.addEventListener('uncapturederror', (event) => {\r\n                            this._hasWebGPUValidationErrors = true;\r\n                            console.error(event);\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // GLSL to SPIR-V converter\r\n                this._glslang = await glslangModule();\r\n    \r\n                // Queue\r\n                this.queue = this.device.defaultQueue;\r\n\r\n                // Canvas context\r\n                this._gpuCanvasContext = canvas.getContext('gpupresent') as any;\r\n\r\n                // Swap chain\r\n                this._preferredSwapChainFormat = await this._gpuCanvasContext.getSwapChainPreferredFormat(this.device);\r\n                this._swapChain = this._gpuCanvasContext.configureSwapChain(\r\n                    <GPUSwapChainDescriptor> {\r\n                        device: this.device,\r\n                        format: this._preferredSwapChainFormat\r\n                    }\r\n                );\r\n\r\n                // When MSAA is enabled, we create an intermediate multisampled texture to render the scene to.\r\n                if (this._enableMSAA) {\r\n                    this._sceneRenderTargetView = this.createMultisampledRenderTargetView();\r\n                }\r\n\r\n                this._sceneDepthStencilView = this.createDepthStencilView();\r\n\r\n                // Recreate swapchain when window is resized\r\n                window.addEventListener('resize', this._framebufferResizeCallback);\r\n            \r\n                // Create the buffer manager\r\n                this._bufferManager = new BufferManagerWebGPU(this, !toggleBitset[TOGGLE.BUFFERMAPPINGASYNC]);\r\n            \r\n                // JavaScript Performance Monitor\r\n                this._statsFPS = await statsjsModule();\r\n                this._statsFrameTime = await statsjsModule();\r\n            } catch (e) {\r\n                reject(\"Unable initialize the WebGPU context \" + e)\r\n                return false;\r\n            }\r\n    \r\n            resolve(true);\r\n        });\r\n    }\r\n\r\n    protected _initAvailableToggleBitset(): void {\r\n        this._availableToggleBitset[TOGGLE.ENABLEMSAAx4]              = true;\r\n        this._availableToggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]      = false; // Not yet finished\r\n        this._availableToggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET] = false; // Not supported ?\r\n        this._availableToggleBitset[TOGGLE.DISCRETEGPU]               = true;\r\n        this._availableToggleBitset[TOGGLE.INTEGRATEDGPU]             = true;\r\n        this._availableToggleBitset[TOGGLE.ENABLEFULLSCREENMODE]      = true;\r\n        this._availableToggleBitset[TOGGLE.BUFFERMAPPINGASYNC]        = false; // Not yet finished\r\n        this._availableToggleBitset[TOGGLE.TURNOFFVSYNC]              = true;\r\n        this._availableToggleBitset[TOGGLE.DISABLED3D12RENDERPASS]    = true;\r\n        this._availableToggleBitset[TOGGLE.DISABLEWEBGPUVALIDATION]   = true;\r\n        this._availableToggleBitset[TOGGLE.SIMULATINGFISHCOMEANDGO]   = true;\r\n    }\r\n\r\n    private _syncClientSize(): void {\r\n        const defaultWidth = this._canvas.offsetWidth * window.devicePixelRatio;\r\n        const defaultHeight = this._canvas.offsetHeight * window.devicePixelRatio;\r\n        // Extend canvas size\r\n        if (this._enableFullScreenMode) {\r\n            this._canvas.width = window.innerWidth || defaultWidth;\r\n            this._canvas.height = window.innerHeight || defaultHeight;\r\n        }\r\n        else {\r\n            this._canvas.width = defaultWidth;\r\n            this._canvas.height = defaultHeight;\r\n        }\r\n        this.setWindowSize(this._canvas.width, this._canvas.height);\r\n    }\r\n\r\n    private _framebufferResizeCallback(): void {\r\n        this._isSwapchainOutOfDate = true;\r\n    }\r\n\r\n    public createTextureWebGPU(name: string, urls: string | string[]): Promise<Nullable<Texture>> {\r\n        return Promise.resolve().then(async () => {\r\n            const texture: Texture = new TextureWebGPU(this, name, urls);\r\n            await texture.loadTexture();\r\n            return texture;\r\n        });\r\n    }\r\n\r\n    public shouldQuit(): boolean {\r\n        return this._hasWebGPUValidationErrors;\r\n    }\r\n\r\n    public createTexture(descriptor: GPUTextureDescriptor): GPUTexture {\r\n        return this.device.createTexture(descriptor);\r\n    }\r\n\r\n    public createSampler(descriptor: GPUSamplerDescriptor): GPUSampler {\r\n        return this.device.createSampler(descriptor);\r\n    }\r\n\r\n    public createBufferFromData(pixels: Float32Array | Uint16Array, size: size_t, usage: GPUBufferUsageFlags): GPUBuffer {\r\n        const buffer: GPUBuffer = this.createBuffer(size, usage | GPUBufferUsage.COPY_DST);\r\n\r\n        this.setBufferData(buffer, 0, size, pixels);\r\n        return buffer;\r\n    }\r\n\r\n    public createBufferCopyView(buffer: GPUBuffer, offset: uint32_t, bytesPerRow: uint32_t, rowsPerImage: uint32_t): GPUBufferCopyView {\r\n        const bufferCopyView: GPUBufferCopyView = {\r\n            buffer: buffer,\r\n            offset: offset,\r\n            bytesPerRow: bytesPerRow,\r\n            rowsPerImage: rowsPerImage\r\n        };\r\n\r\n        return bufferCopyView;\r\n    }\r\n\r\n    public createTextureCopyView(texture: GPUTexture, level: uint32_t, origin: GPUOrigin3D): GPUTextureCopyView {\r\n        const textureCopyView: GPUTextureCopyView = {\r\n            texture: texture,\r\n            mipLevel: level,\r\n            origin: origin\r\n        };\r\n\r\n        return textureCopyView;\r\n    }\r\n\r\n    public copyBufferToTexture(bufferCopyView: GPUBufferCopyView, textureCopyView: GPUTextureCopyView, ext3D: GPUExtent3D): GPUCommandBuffer {\r\n        const encoder: GPUCommandEncoder = this.device.createCommandEncoder();\r\n        encoder.copyBufferToTexture(bufferCopyView, textureCopyView, ext3D);\r\n        const copy: GPUCommandBuffer = encoder.finish();\r\n\r\n        return copy;\r\n    }\r\n\r\n    public copyBufferToBuffer(srcBuffer: GPUBuffer, srcOffset: size_t, destBuffer: GPUBuffer, destOffset: size_t, size: size_t): GPUCommandBuffer {\r\n        const encoder: GPUCommandEncoder = this.device.createCommandEncoder();\r\n        encoder.copyBufferToBuffer(srcBuffer, srcOffset, destBuffer, destOffset, size);\r\n        const copy: GPUCommandBuffer = encoder.finish();\r\n\r\n        return copy;\r\n    }\r\n\r\n    public createShaderModule(stage: SingleShaderStage, shaderSourceGLSL: string): GPUShaderModule {\r\n        const shaderType: string = (stage == SingleShaderStage.Vertex) ? \"vertex\" :\r\n                                   (stage == SingleShaderStage.Fragment) ? \"fragment\" : \"compute\";\r\n        const shaderModule: GPUShaderModule = this.device.createShaderModule(\r\n            <GPUShaderModuleDescriptor> {\r\n                code: this._glslang.compileGLSL(shaderSourceGLSL, shaderType),\r\n                // @ts-ignore\r\n                source: shaderSourceGLSL,\r\n                transform: source => this._glslang.compileGLSL(source, shaderType),\r\n            }\r\n        );\r\n        return shaderModule;\r\n    }\r\n\r\n    public makeBindGroupLayout(bindGroupLayoutdescriptor: GPUBindGroupLayoutDescriptor): GPUBindGroupLayout {\r\n        return this.device.createBindGroupLayout(bindGroupLayoutdescriptor);\r\n    }\r\n\r\n    public makeBasicPipelineLayout(pipelineLayoutDescriptor: GPUPipelineLayoutDescriptor): GPUPipelineLayout {\r\n        return this.device.createPipelineLayout(pipelineLayoutDescriptor);\r\n    }\r\n\r\n    public createRenderPipeline(pipelineLayout: GPUPipelineLayout, programWebGPU: ProgramWebGPU,\r\n                                vertexStateDescriptor: Nullable<ComboVertexStateDescriptor>,\r\n                                enableBlend: boolean): GPURenderPipeline {\r\n        const vsModule: Nullable<GPUShaderModule> = programWebGPU.vertexShaderModule;\r\n        const fsModule: Nullable<GPUShaderModule> = programWebGPU.fragmentShaderModule\r\n    \r\n        const blendDescriptor: GPUBlendDescriptor = {\r\n            operation: \"add\",\r\n            srcFactor: enableBlend ? \"src-alpha\" : \"one\",\r\n            dstFactor: enableBlend ? \"one-minus-src-alpha\" : \"zero\"\r\n        };\r\n\r\n        const colorStateDescriptor: GPUColorStateDescriptor = {\r\n            format: this._preferredSwapChainFormat,\r\n            colorBlend: blendDescriptor,\r\n            alphaBlend: blendDescriptor,\r\n            writeMask: GPUColorWrite.ALL\r\n        };\r\n\r\n        const rasterizationState: GPURasterizationStateDescriptor = {\r\n            frontFace: \"ccw\",\r\n            cullMode: \"back\",\r\n            depthBias: 0,\r\n            depthBiasSlopeScale: 0.0,\r\n            depthBiasClamp: 0.0\r\n        };\r\n\r\n        // test\r\n        const descriptor: ComboRenderPipelineDescriptor = new ComboRenderPipelineDescriptor(this.device);\r\n        descriptor.layout                               = pipelineLayout;\r\n        descriptor.vertexStage.module                   = vsModule;\r\n        descriptor.fragmentStage.module                 = fsModule;\r\n        descriptor.vertexState                          = vertexStateDescriptor;\r\n        descriptor.depthStencilState                    = descriptor.cDepthStencilState;\r\n        descriptor.cDepthStencilState.format            = \"depth24plus-stencil8\";\r\n        descriptor.colorStates[0]                       = colorStateDescriptor;\r\n        descriptor.colorStates[0].format                = this._preferredSwapChainFormat;\r\n        descriptor.cDepthStencilState.depthWriteEnabled = true;\r\n        descriptor.cDepthStencilState.depthCompare      = \"less\";\r\n        descriptor.primitiveTopology                    = \"triangle-list\"\r\n        descriptor.sampleCount                          = this._enableMSAA ? 4 : 1;\r\n        descriptor.rasterizationState                   = rasterizationState;\r\n        \r\n        const pipeline: GPURenderPipeline = this.device.createRenderPipeline(descriptor);\r\n\r\n        return pipeline;\r\n    }\r\n\r\n    public createMultisampledRenderTargetView(): GPUTextureView {\r\n        const descriptor: GPUTextureDescriptor = {\r\n            dimension: \"2d\",\r\n            size: <GPUExtent3DDict> {\r\n                width: this._clientWidth,\r\n                height: this._clientHeight,\r\n                depth: 1\r\n            },\r\n            sampleCount: 4,\r\n            format: this._preferredSwapChainFormat,\r\n            mipLevelCount: 1,\r\n            usage: GPUTextureUsage.OUTPUT_ATTACHMENT\r\n        };\r\n        const multisampledRenderTargetView = this.device.createTexture(descriptor);\r\n        return multisampledRenderTargetView.createView();\r\n    }\r\n\r\n    public createDepthStencilView(): GPUTextureView {\r\n        const descriptor: GPUTextureDescriptor = {\r\n            dimension: \"2d\",\r\n            size: <GPUExtent3DDict> {\r\n                width: this._clientWidth,\r\n                height: this._clientHeight,\r\n                depth: 1\r\n            },\r\n            sampleCount: this._enableMSAA ? 4 : 1,\r\n            format: \"depth24plus-stencil8\",\r\n            mipLevelCount: 1,\r\n            usage: GPUTextureUsage.OUTPUT_ATTACHMENT | GPUTextureUsage.COPY_DST\r\n        };\r\n        const depthStencilTexture = this.device.createTexture(descriptor);\r\n        return depthStencilTexture.createView();\r\n    }\r\n\r\n    public createBuffer(size: uint32_t, bit: GPUBufferUsageFlags): GPUBuffer {\r\n        const descriptor: GPUBufferDescriptor = {\r\n            size: size,\r\n            usage: bit\r\n        }\r\n\r\n        return this.device.createBuffer(descriptor);\r\n    }\r\n\r\n    public setBufferData(buffer: GPUBuffer, start: uint32_t, size: uint32_t, pixels: Float32Array | Uint16Array): void {\r\n        let [resultBuffer, resultData] = this.createBufferMapped(size, GPUBufferUsage.MAP_WRITE | GPUBufferUsage.COPY_SRC);\r\n    \r\n        const writeArray = pixels instanceof Uint16Array ? new Uint16Array(resultData) : new Float32Array(resultData);\r\n        writeArray.set(pixels);\r\n        resultBuffer.unmap();\r\n        \r\n        const command: GPUCommandBuffer = this.copyBufferToBuffer(resultBuffer, 0, buffer, 0, size);\r\n        this.commandBuffers.push(command);\r\n    }\r\n\r\n    public makeBindGroup(bindGroupDescriptor: GPUBindGroupDescriptor): GPUBindGroup {\r\n        return this.device.createBindGroup(bindGroupDescriptor);\r\n    }\r\n\r\n    public initGeneralResources(aquarium: Nullable<Aquarium>): void {\r\n        // Initialize general uniform buffers\r\n        this.groupLayoutGeneral = this.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"uniform-buffer\"\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        visibility: GPUShaderStage.FRAGMENT,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._lightBuffer = this.createBufferFromData(aquarium.lightUniforms.data, LightUniforms.byteSize,\r\n                                                      GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n        this._fogBuffer = this.createBufferFromData(aquarium.fogUniforms.data, FogUniforms.byteSize,\r\n                                                    GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this.bindGroupGeneral = this.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this.groupLayoutGeneral,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._lightBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    },\r\n                    {\r\n                        binding: 1,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._fogBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this.setBufferData(this._lightBuffer, 0, LightUniforms.byteSize, aquarium.lightUniforms.data);\r\n        this.setBufferData(this._fogBuffer, 0, FogUniforms.byteSize, aquarium.fogUniforms.data);\r\n\r\n        // Initialize world uniform buffers\r\n        this.groupLayoutWorld = this.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\"\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this._lightWorldPositionBuffer = this.createBufferFromData(\r\n            aquarium.lightWorldPositionUniform.data,\r\n            this.calcConstantBufferByteSize(LightWorldPositionUniform.byteSize),\r\n            GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        this.bindGroupWorld = this.makeBindGroup(\r\n            <GPUBindGroupDescriptor> {\r\n                layout: this.groupLayoutWorld,\r\n                entries: <GPUBindGroupEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        resource: <GPUBufferBinding> {\r\n                            buffer: this._lightWorldPositionBuffer,\r\n                            offset: 0,\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        const enableDynamicBufferOffset: boolean = aquarium.toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET];\r\n        this.groupLayoutFishPer = this.makeBindGroupLayout(\r\n            <GPUBindGroupLayoutDescriptor> {\r\n                entries: <GPUBindGroupLayoutEntry[]> [\r\n                    {\r\n                        binding: 0,\r\n                        visibility: GPUShaderStage.VERTEX,\r\n                        type: \"uniform-buffer\",\r\n                        hasDynamicOffset: enableDynamicBufferOffset ? true : undefined,\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n\r\n        this.reallocResource(aquarium.preFishCount, aquarium.curFishCount, enableDynamicBufferOffset);\r\n    }\r\n\r\n    public updateWorldlUniforms(aquarium: Nullable<Aquarium>) {\r\n        this.updateBufferData(this._lightWorldPositionBuffer, aquarium.lightWorldPositionUniform.data,\r\n                              this.calcConstantBufferByteSize(LightWorldPositionUniform.byteSize));\r\n    }\r\n\r\n    public createBufferWebGPU(numComponents: int, buf: Float32Array | Uint16Array, isIndex: boolean): Nullable<Buffer> {\r\n        const buffer: Buffer = new BufferWebGPU(this, buf.length, numComponents, buf, isIndex);\r\n\r\n        return buffer;\r\n    }\r\n\r\n    public createProgram(vsId: string, fsId: string): Nullable<Program> {\r\n        const program: ProgramWebGPU = new ProgramWebGPU(this, vsId, fsId);\r\n\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     * Submit commands of the frame.\r\n     */\r\n    public doFlush(toggleBitset: Array<boolean>): void {\r\n        this._renderPass.endPass();\r\n\r\n        this._bufferManager.flush();\r\n\r\n        const cmd: GPUCommandBuffer = this._commandEncoder.finish();\r\n        this.commandBuffers.push(cmd);\r\n\r\n        this.flush();\r\n    }\r\n\r\n    public flush(): void {\r\n        this.queue.submit(this.commandBuffers);\r\n        this.commandBuffers.length = 0\r\n    }\r\n\r\n    public preFrame(): void {\r\n\r\n        if (this._isSwapchainOutOfDate) {\r\n            this._syncClientSize();\r\n            if (this._enableMSAA) {\r\n                this._sceneRenderTargetView = this.createMultisampledRenderTargetView();\r\n            }\r\n            this._sceneDepthStencilView = this.createDepthStencilView();\r\n            this._isSwapchainOutOfDate = false;\r\n        }\r\n\r\n        this._commandEncoder = this.device.createCommandEncoder();\r\n        this._backbufferView = this._swapChain.getCurrentTexture().createView();\r\n\r\n        if (this._enableMSAA) {\r\n            // If MSAA is enabled, we render to a multisampled texture and then resolve to the backbuffer\r\n            this._renderPassDescriptor = new ComboRenderPassDescriptor([this._sceneRenderTargetView], this._sceneDepthStencilView);\r\n            this._renderPassDescriptor.cColorAttachments[0].resolveTarget = this._backbufferView;\r\n            this._renderPassDescriptor.cColorAttachments[0].storeOp       = \"clear\";\r\n            this._renderPassDescriptor.cColorAttachments[0].loadValue     = <GPUColorDict> {r: 0.0, g: 0.8, b: 1.0, a: 0.0};\r\n            this._renderPassDescriptor.colorAttachmentCount               = 1;\r\n        }\r\n        else {\r\n            // When MSAA is off, we render directly to the backbuffer\r\n            this._renderPassDescriptor = new ComboRenderPassDescriptor([this._backbufferView], this._sceneDepthStencilView);\r\n            this._renderPassDescriptor.cColorAttachments[0].storeOp   = \"store\";\r\n            this._renderPassDescriptor.cColorAttachments[0].loadValue = <GPUColorDict> {r: 0.0, g: 0.8, b: 1.0, a: 0.0};\r\n            this._renderPassDescriptor.colorAttachmentCount           = 1;\r\n        }\r\n\r\n        this._renderPass = this._commandEncoder.beginRenderPass(this._renderPassDescriptor);\r\n    }\r\n\r\n    public updateFPS(fpsTimer: FPSTimer, fisCountGetter: () => int, fisCountSetter: (fishCount: int) => void, toggleBitset: Array<boolean>): void {\r\n        if (this._disableControlPanel) {\r\n            return;\r\n        }\r\n        \r\n        this.renderGUI(this._canvas, fpsTimer, fisCountGetter, fisCountSetter, toggleBitset);\r\n    }\r\n\r\n    public showFPS(canvas?: HTMLCanvasElement): void {\r\n        if (this._disableControlPanel) {\r\n            return;\r\n        }\r\n\r\n        super.showFPS(this._canvas);\r\n    }\r\n\r\n    public createModel(aquarium: Nullable<Aquarium>, type: MODELGROUP, name: MODELNAME, blend: boolean): Nullable<Model> {\r\n        let model: Nullable<Model> = null;\r\n        switch(type) {\r\n            case MODELGROUP.FISH:\r\n                model = new FishModelWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            case MODELGROUP.FISHINSTANCEDDRAW:\r\n                model = new FishModelInstancedDrawWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            case MODELGROUP.GENERIC:\r\n                model = new GenericModelWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            case MODELGROUP.INNER:\r\n                model = new InnerModelWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            case MODELGROUP.SEAWEED:\r\n                model = new SeaweedModelWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            case MODELGROUP.OUTSIDE:\r\n                model = new OutsideModelWebGPU(this, aquarium, type, name, blend);\r\n                break;\r\n            default:\r\n                model = null;\r\n                console.error(`Can not create model type: ${type}`);\r\n        }\r\n\r\n        return model;\r\n    }\r\n\r\n    public reallocResource(preTotalInstance: int, curTotalInstance: int, enableDynamicBufferOffset: boolean): void {\r\n        this._preTotalInstance          = preTotalInstance;\r\n        this._curTotalInstance          = curTotalInstance;\r\n        this._enableDynamicBufferOffset = enableDynamicBufferOffset;\r\n\r\n        if (curTotalInstance === 0) {\r\n            return;\r\n        }\r\n\r\n        // If current fish number > pre fish number, allocate a new bigger buffer.\r\n        // If current fish number <= prefish number, do not allocate a new one.\r\n        if (preTotalInstance >= curTotalInstance) {\r\n            return;\r\n        }\r\n\r\n        this._destroyFishResource();\r\n\r\n        this.fishPers = BuildArray(curTotalInstance, () => new FishPerWithPadding());\r\n\r\n        if (enableDynamicBufferOffset) {\r\n            this.bindGroupFishPers = Array.from<GPUBindGroup>([null]);\r\n        }\r\n        else {\r\n            this.bindGroupFishPers = BuildArray(curTotalInstance, () => null);\r\n        }\r\n\r\n        const size: size_t  = this.calcConstantBufferByteSize(FishPerWithPadding.byteSize * curTotalInstance);\r\n        this.fishPersBuffer = this.createBuffer(size, GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM);\r\n\r\n        if (enableDynamicBufferOffset) {\r\n            this.bindGroupFishPers[0] = this.makeBindGroup(\r\n                <GPUBindGroupDescriptor> {\r\n                    layout: this.groupLayoutFishPer,\r\n                    entries: <GPUBindGroupEntry[]> [\r\n                        {\r\n                            binding: 0,\r\n                            resource: <GPUBufferBinding> {\r\n                                buffer: this.fishPersBuffer,\r\n                                offset: 0\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            for (let i: int = 0; i < curTotalInstance; ++i) {\r\n                this.bindGroupFishPers[i] = this.makeBindGroup(\r\n                    <GPUBindGroupDescriptor> {\r\n                        layout: this.groupLayoutFishPer,\r\n                        entries: <GPUBindGroupEntry[]> [\r\n                            {\r\n                                binding: 0,\r\n                                resource: <GPUBufferBinding> {\r\n                                    buffer: this.fishPersBuffer,\r\n                                    offset: this.calcConstantBufferByteSize(FishPerWithPadding.byteSize * i)\r\n                                }\r\n                            }\r\n                        ]\r\n                    }\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    public createBufferMapped(size: uint32_t, usage: GPUBufferUsageFlags): [GPUBuffer, ArrayBuffer] {\r\n         const buffer = this.device.createBuffer(<GPUBufferDescriptor> {\r\n            mappedAtCreation: true,\r\n            size: size,\r\n            usage: usage,\r\n        });\r\n\r\n        const result: [GPUBuffer, ArrayBuffer] = [buffer, buffer.getMappedRange()];\r\n        ASSERT(result[1].byteLength === size, \"Invalid buffer size.\");\r\n        return result;\r\n    }\r\n\r\n    public get renderPass(): GPURenderPassEncoder {\r\n        return this._renderPass;\r\n    }\r\n\r\n    public waitABit(): void {\r\n\r\n    }\r\n\r\n    public createCommandEncoder(): GPUCommandEncoder {\r\n        return this.device.createCommandEncoder();\r\n    }\r\n\r\n    public updateAllFishData(): void {\r\n        const size: size_t = this.calcConstantBufferByteSize(FishPerWithPadding.byteSize * this._curTotalInstance);\r\n        let fishPersData: Array<float> = [];\r\n        for (let i: size_t = 0; i < this._curTotalInstance; ++i) {\r\n            fishPersData = fishPersData.concat(this.fishPers[i].getAsArray());\r\n        }\r\n        this.updateBufferData(this.fishPersBuffer, new Float32Array(fishPersData), size);\r\n    }\r\n\r\n    public updateBufferData(buffer: GPUBuffer, pixel: Float32Array | Uint16Array, size: size_t): void {\r\n        let offset: size_t = 0;\r\n        const result = this._bufferManager.allocate(size, offset);\r\n        \r\n        const ringBuffer: Nullable<RingBufferWebGPU> = result.buffer;\r\n        offset                                       = result.offset;\r\n\r\n        if (ringBuffer === null) {\r\n            console.error(\"Memory upper limit.\");\r\n            return;\r\n        }\r\n\r\n        ringBuffer.push(this._bufferManager.encoder, buffer, offset, 0, pixel, size);\r\n    }\r\n\r\n    private _destroyFishResource(): void {\r\n        this.fishPersBuffer = null;\r\n\r\n        if (this.fishPers.length > 0) {\r\n            this.fishPers.length = 0;\r\n        }\r\n        if (this._enableDynamicBufferOffset) {\r\n            if (this.bindGroupFishPers !== null) {\r\n                if (this.bindGroupFishPers[0] !== null) {\r\n                    this.bindGroupFishPers[0] = null;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this.bindGroupFishPers !== null) {\r\n                for (let i: int = 0; i < this._preTotalInstance; i++) {\r\n                    if (this.bindGroupFishPers[i] !== null) {\r\n                        this.bindGroupFishPers[i] = null;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.bindGroupFishPers.length = 0;\r\n\r\n        this._bufferManager.destroyBufferPool();\r\n    }\r\n\r\n    public calcConstantBufferByteSize(byteSize: size_t): size_t {\r\n        return (byteSize + 255) & ~255;\r\n    }\r\n\r\n}","import { BuildArray, int, double, float, size_t } from \"./types\";\r\n\r\n/**\r\n * Defines the fps timer.\r\n */\r\nexport class FPSTimer {\r\n\r\n    public static readonly NUM_HISTORY_DATA: int      = 100;\r\n    public static readonly NUM_FRAMES_TO_AVERAGE: int = 128;\r\n    public static readonly FPS_VALID_THRESHOLD: int   = 5;\r\n\r\n    private _totalTime: double;\r\n    private _timeTable: double[];\r\n    private _timeTableCursor: int;\r\n\r\n    private _historyFPS: float[];\r\n    private _historyFrameTime: float[];\r\n    private _logFPS: float[];\r\n\r\n    private _averageFPS: double;\r\n    private _averageFrameTime: double;\r\n\r\n    constructor() {\r\n        this._totalTime = FPSTimer.NUM_FRAMES_TO_AVERAGE * 1.0;\r\n        this._timeTable = BuildArray(FPSTimer.NUM_FRAMES_TO_AVERAGE, () => 1.0);;\r\n        this._timeTableCursor = 0;\r\n        this._historyFPS = BuildArray(FPSTimer.NUM_HISTORY_DATA, () => 1.0);\r\n        this._historyFrameTime = BuildArray(FPSTimer.NUM_HISTORY_DATA, () => 100.0);\r\n        this._logFPS = [];\r\n        this._averageFPS = 0.0;\r\n        this._averageFrameTime = 0.0;\r\n    }\r\n\r\n    public get averageFPS(): double {\r\n        return this._averageFPS;\r\n    }\r\n\r\n    public get historyFPS(): float[] {\r\n        return this._historyFPS;\r\n    }\r\n\r\n    public get averageFrameTime(): float {\r\n        return this._averageFrameTime;\r\n    }\r\n\r\n    public get historyFrameTime(): float[] {\r\n        return this._historyFrameTime;\r\n    }\r\n\r\n    public update(elapsedTime: double, renderingTime: double, testTime: int): void {\r\n        this._totalTime += elapsedTime - this._timeTable[this._timeTableCursor];\r\n        this._timeTable[this._timeTableCursor] = elapsedTime;\r\n\r\n        this._timeTableCursor++;\r\n        if (this._timeTableCursor === FPSTimer.NUM_FRAMES_TO_AVERAGE) {\r\n            this._timeTableCursor = 0;\r\n        }\r\n\r\n        this._averageFPS = Math.floor((1.0 / (this._totalTime / (FPSTimer.NUM_FRAMES_TO_AVERAGE * 1.0))) + 0.5);\r\n\r\n        for (let i: int = 0; i < FPSTimer.NUM_HISTORY_DATA; ++i) {\r\n            this._historyFPS[i]       = this._historyFPS[i + 1];\r\n            this._historyFrameTime[i] = this._historyFrameTime[i + 1];\r\n        }\r\n        this._historyFPS[FPSTimer.NUM_HISTORY_DATA - 1]       = this._averageFPS;\r\n        this._historyFrameTime[FPSTimer.NUM_HISTORY_DATA - 1] = 1000.0 / this._averageFPS;\r\n\r\n        this._averageFrameTime = this._historyFrameTime[FPSTimer.NUM_HISTORY_DATA - 1];\r\n\r\n        if (testTime - renderingTime > 5 && testTime - renderingTime < 25) {\r\n            this._logFPS.push(this._averageFPS);\r\n        }\r\n    }\r\n\r\n    public variance(): int {\r\n        let avg: float = 0.0;\r\n\r\n        for (let i: size_t = 0; i < this._logFPS.length; ++i) {\r\n            avg += this._logFPS[i];\r\n        }\r\n        avg /= this._logFPS.length;\r\n\r\n        let variance: float = 0.0;\r\n        for (let i: size_t = 0; i < this._logFPS.length; i++) {\r\n            variance += Math.pow(this._logFPS[i] - avg, 2);\r\n        }\r\n        variance /= this._logFPS.length;\r\n\r\n        if (variance < FPSTimer.FPS_VALID_THRESHOLD) {\r\n            return Math.ceil(avg);\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n}","import { DeepImmutable, FloatArray, float, int, size_t } from \"./types\";\r\n\r\n/**\r\n * @fileoverview This class contains functions to perform matrix calculations including\r\n * multiply, addition, substraction, transpose, inverse, translation, etc.\r\n */\r\nexport class Matrix {\r\n\r\n    /**\r\n     * A constant for the pseudoRandom function.\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    private static _RANDOM_RANGE: size_t = 4294967296;\r\n\r\n    /**\r\n     * A random seed for the pseudoRandom function.\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    private static _randomSeed: size_t = 0;\r\n\r\n    /**\r\n     * Multiplies two 4-by-4 matrices; assumes that the given matrices are 4-by-4;\r\n     * assumes matrix entries are accessed in [row][column] fashion.\r\n     * @param {!FloatArray} dst The matrix product of a and b destination.\r\n     * @param {!FloatArray} a The matrix on the left.\r\n     * @param {!FloatArray} b The matrix on the right.\r\n     */\r\n    public static mulMatrixMatrix4(dst: FloatArray, a: DeepImmutable<FloatArray>, b: DeepImmutable<FloatArray>): void {\r\n        const a00 = a[0];\r\n        const a01 = a[1];\r\n        const a02 = a[2];\r\n        const a03 = a[3];\r\n        const a10 = a[4 + 0];\r\n        const a11 = a[4 + 1];\r\n        const a12 = a[4 + 2];\r\n        const a13 = a[4 + 3];\r\n        const a20 = a[8 + 0];\r\n        const a21 = a[8 + 1];\r\n        const a22 = a[8 + 2];\r\n        const a23 = a[8 + 3];\r\n        const a30 = a[12 + 0];\r\n        const a31 = a[12 + 1];\r\n        const a32 = a[12 + 2];\r\n        const a33 = a[12 + 3];\r\n        const b00 = b[0];\r\n        const b01 = b[1];\r\n        const b02 = b[2];\r\n        const b03 = b[3];\r\n        const b10 = b[4 + 0];\r\n        const b11 = b[4 + 1];\r\n        const b12 = b[4 + 2];\r\n        const b13 = b[4 + 3];\r\n        const b20 = b[8 + 0];\r\n        const b21 = b[8 + 1];\r\n        const b22 = b[8 + 2];\r\n        const b23 = b[8 + 3];\r\n        const b30 = b[12 + 0];\r\n        const b31 = b[12 + 1];\r\n        const b32 = b[12 + 2];\r\n        const b33 = b[12 + 3];\r\n        dst[0]    = a00 * b00 + a01 * b10 + a02 * b20 + a03 * b30;\r\n        dst[1]    = a00 * b01 + a01 * b11 + a02 * b21 + a03 * b31;\r\n        dst[2]    = a00 * b02 + a01 * b12 + a02 * b22 + a03 * b32;\r\n        dst[3]    = a00 * b03 + a01 * b13 + a02 * b23 + a03 * b33;\r\n        dst[4]    = a10 * b00 + a11 * b10 + a12 * b20 + a13 * b30;\r\n        dst[5]    = a10 * b01 + a11 * b11 + a12 * b21 + a13 * b31;\r\n        dst[6]    = a10 * b02 + a11 * b12 + a12 * b22 + a13 * b32;\r\n        dst[7]    = a10 * b03 + a11 * b13 + a12 * b23 + a13 * b33;\r\n        dst[8]    = a20 * b00 + a21 * b10 + a22 * b20 + a23 * b30;\r\n        dst[9]    = a20 * b01 + a21 * b11 + a22 * b21 + a23 * b31;\r\n        dst[10]   = a20 * b02 + a21 * b12 + a22 * b22 + a23 * b32;\r\n        dst[11]   = a20 * b03 + a21 * b13 + a22 * b23 + a23 * b33;\r\n        dst[12]   = a30 * b00 + a31 * b10 + a32 * b20 + a33 * b30;\r\n        dst[13]   = a30 * b01 + a31 * b11 + a32 * b21 + a33 * b31;\r\n        dst[14]   = a30 * b02 + a31 * b12 + a32 * b22 + a33 * b32;\r\n        dst[15]   = a30 * b03 + a31 * b13 + a32 * b23 + a33 * b33;\r\n    }\r\n\r\n    /**\r\n     * Computes the inverse of a 4-by-4 matrix.\r\n     * @param {!FloatArray} dst The inverse of m destination.\r\n     * @param {!FloatArray} m The matrix.\r\n     */\r\n    public static inverse4(dst: FloatArray, m: DeepImmutable<FloatArray>): void {\r\n        const m00    = m[0 * 4 + 0];\r\n        const m01    = m[0 * 4 + 1];\r\n        const m02    = m[0 * 4 + 2];\r\n        const m03    = m[0 * 4 + 3];\r\n        const m10    = m[1 * 4 + 0];\r\n        const m11    = m[1 * 4 + 1];\r\n        const m12    = m[1 * 4 + 2];\r\n        const m13    = m[1 * 4 + 3];\r\n        const m20    = m[2 * 4 + 0];\r\n        const m21    = m[2 * 4 + 1];\r\n        const m22    = m[2 * 4 + 2];\r\n        const m23    = m[2 * 4 + 3];\r\n        const m30    = m[3 * 4 + 0];\r\n        const m31    = m[3 * 4 + 1];\r\n        const m32    = m[3 * 4 + 2];\r\n        const m33    = m[3 * 4 + 3];\r\n        const tmp_0  = m22 * m33;\r\n        const tmp_1  = m32 * m23;\r\n        const tmp_2  = m12 * m33;\r\n        const tmp_3  = m32 * m13;\r\n        const tmp_4  = m12 * m23;\r\n        const tmp_5  = m22 * m13;\r\n        const tmp_6  = m02 * m33;\r\n        const tmp_7  = m32 * m03;\r\n        const tmp_8  = m02 * m23;\r\n        const tmp_9  = m22 * m03;\r\n        const tmp_10 = m02 * m13;\r\n        const tmp_11 = m12 * m03;\r\n        const tmp_12 = m20 * m31;\r\n        const tmp_13 = m30 * m21;\r\n        const tmp_14 = m10 * m31;\r\n        const tmp_15 = m30 * m11;\r\n        const tmp_16 = m10 * m21;\r\n        const tmp_17 = m20 * m11;\r\n        const tmp_18 = m00 * m31;\r\n        const tmp_19 = m30 * m01;\r\n        const tmp_20 = m00 * m21;\r\n        const tmp_21 = m20 * m01;\r\n        const tmp_22 = m00 * m11;\r\n        const tmp_23 = m10 * m01;\r\n\r\n        const t0 = (tmp_0 * m11 + tmp_3 * m21 + tmp_4 * m31) - (tmp_1 * m11 + tmp_2 * m21 + tmp_5 * m31);\r\n        const t1 = (tmp_1 * m01 + tmp_6 * m21 + tmp_9 * m31) - (tmp_0 * m01 + tmp_7 * m21 + tmp_8 * m31);\r\n        const t2 = (tmp_2 * m01 + tmp_7 * m11 + tmp_10 * m31) - (tmp_3 * m01 + tmp_6 * m11 + tmp_11 * m31);\r\n        const t3 = (tmp_5 * m01 + tmp_8 * m11 + tmp_11 * m21) - (tmp_4 * m01 + tmp_9 * m11 + tmp_10 * m21);\r\n\r\n        const d = 1.0 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\r\n\r\n        dst[0] = d * t0;\r\n        dst[1] = d * t1;\r\n        dst[2] = d * t2;\r\n        dst[3] = d * t3;\r\n        dst[4] =\r\n            d * ((tmp_1 * m10 + tmp_2 * m20 + tmp_5 * m30) - (tmp_0 * m10 + tmp_3 * m20 + tmp_4 * m30));\r\n        dst[5] =\r\n            d * ((tmp_0 * m00 + tmp_7 * m20 + tmp_8 * m30) - (tmp_1 * m00 + tmp_6 * m20 + tmp_9 * m30));\r\n        dst[6]  = d * ((tmp_3 * m00 + tmp_6 * m10 + tmp_11 * m30) -\r\n                    (tmp_2 * m00 + tmp_7 * m10 + tmp_10 * m30));\r\n        dst[7]  = d * ((tmp_4 * m00 + tmp_9 * m10 + tmp_10 * m20) -\r\n                    (tmp_5 * m00 + tmp_8 * m10 + tmp_11 * m20));\r\n        dst[8]  = d * ((tmp_12 * m13 + tmp_15 * m23 + tmp_16 * m33) -\r\n                    (tmp_13 * m13 + tmp_14 * m23 + tmp_17 * m33));\r\n        dst[9]  = d * ((tmp_13 * m03 + tmp_18 * m23 + tmp_21 * m33) -\r\n                    (tmp_12 * m03 + tmp_19 * m23 + tmp_20 * m33));\r\n        dst[10] = d * ((tmp_14 * m03 + tmp_19 * m13 + tmp_22 * m33) -\r\n                    (tmp_15 * m03 + tmp_18 * m13 + tmp_23 * m33));\r\n        dst[11] = d * ((tmp_17 * m03 + tmp_20 * m13 + tmp_23 * m23) -\r\n                    (tmp_16 * m03 + tmp_21 * m13 + tmp_22 * m23));\r\n        dst[12] = d * ((tmp_14 * m22 + tmp_17 * m32 + tmp_13 * m12) -\r\n                    (tmp_16 * m32 + tmp_12 * m12 + tmp_15 * m22));\r\n        dst[13] = d * ((tmp_20 * m32 + tmp_12 * m02 + tmp_19 * m22) -\r\n                    (tmp_18 * m22 + tmp_21 * m32 + tmp_13 * m02));\r\n        dst[14] = d * ((tmp_18 * m12 + tmp_23 * m32 + tmp_15 * m02) -\r\n                    (tmp_22 * m32 + tmp_14 * m02 + tmp_19 * m12));\r\n        dst[15] = d * ((tmp_22 * m22 + tmp_16 * m02 + tmp_21 * m12) -\r\n                    (tmp_20 * m12 + tmp_23 * m22 + tmp_17 * m02));\r\n    }\r\n\r\n    /**\r\n     * Takes the transpose of a matrix.\r\n     * @param {!Matrix} dst The transpose of m result.\r\n     * @param {!Matrix} m The matrix.\r\n     */\r\n    public static transpose4(dst: Matrix, m: DeepImmutable<Matrix>): void {\r\n        const m00 = m[0 * 4 + 0];\r\n        const m01 = m[0 * 4 + 1];\r\n        const m02 = m[0 * 4 + 2];\r\n        const m03 = m[0 * 4 + 3];\r\n        const m10 = m[1 * 4 + 0];\r\n        const m11 = m[1 * 4 + 1];\r\n        const m12 = m[1 * 4 + 2];\r\n        const m13 = m[1 * 4 + 3];\r\n        const m20 = m[2 * 4 + 0];\r\n        const m21 = m[2 * 4 + 1];\r\n        const m22 = m[2 * 4 + 2];\r\n        const m23 = m[2 * 4 + 3];\r\n        const m30 = m[3 * 4 + 0];\r\n        const m31 = m[3 * 4 + 1];\r\n        const m32 = m[3 * 4 + 2];\r\n        const m33 = m[3 * 4 + 3];\r\n\r\n        dst[0]  = m00;\r\n        dst[1]  = m10;\r\n        dst[2]  = m20;\r\n        dst[3]  = m30;\r\n        dst[4]  = m01;\r\n        dst[5]  = m11;\r\n        dst[6]  = m21;\r\n        dst[7]  = m31;\r\n        dst[8]  = m02;\r\n        dst[9]  = m12;\r\n        dst[10] = m22;\r\n        dst[11] = m32;\r\n        dst[12] = m03;\r\n        dst[13] = m13;\r\n        dst[14] = m23;\r\n        dst[15] = m33;\r\n    }\r\n\r\n    /**\r\n     * Computes a 4-by-4 perspective transformation matrix given the left, right,\r\n     * top, bottom, near and far clipping planes. The arguments define a frustum\r\n     * extending in the negative z direction. The arguments near and far are the\r\n     * distances to the near and far clipping planes. Note that near and far are not\r\n     * z coordinates, but rather they are distances along the negative z-axis. The\r\n     * matrix generated sends the viewing frustum to the unit box. We assume a unit\r\n     * box extending from -1 to 1 in the x and y dimensions and from 0 to 1 in the z\r\n     * dimension.\r\n     * @param {!FloatArray} dst The perspective projection matrix result.\r\n     * @param {number} left The x coordinate of the left plane of the box.\r\n     * @param {number} right The x coordinate of the right plane of the box.\r\n     * @param {number} bottom The y coordinate of the bottom plane of the box.\r\n     * @param {number} top The y coordinate of the right plane of the box.\r\n     * @param {number} near_ The negative z coordinate of the near plane of the box.\r\n     * @param {number} far_ The negative z coordinate of the far plane of the box.\r\n     */\r\n    public static frustum(dst: FloatArray, left: float, right: float, bottom: float, top: float, near_: float, far_: float): void {\r\n        const dx: float = right - left;\r\n        const dy: float = top - bottom;\r\n        const dz: float = near_ - far_;\r\n\r\n        dst[0]  = 2.0 * near_ / dx;\r\n        dst[1]  = 0.0;\r\n        dst[2]  = 0.0;\r\n        dst[3]  = 0.0;\r\n        dst[4]  = 0.0;\r\n        dst[5]  = 2.0 * near_ / dy;\r\n        dst[6]  = 0.0;\r\n        dst[7]  = 0.0;\r\n        dst[8]  = (left + right) / dx;\r\n        dst[9]  = (top + bottom) / dy;\r\n        dst[10] = far_ / dz;\r\n        dst[11] = -1.0;\r\n        dst[12] = 0.0;\r\n        dst[13] = 0.0;\r\n        dst[14] = near_ * far_ / dz;\r\n        dst[15] = 0.0;\r\n    }\r\n\r\n    public static getAxis(dst: FloatArray, m: DeepImmutable<FloatArray>, axis: int): void {\r\n        const off: int = axis * 4;\r\n        dst[0]         = m[off + 0];\r\n        dst[1]         = m[off + 1];\r\n        dst[2]         = m[off + 2];\r\n    }\r\n\r\n    /**\r\n     * Multiplies a scalar by a vector.\r\n     * @param {number} k The scalar.\r\n     * @param {!FloatArray} v The vector.\r\n     * @param {!number} length The length of vector v.\r\n     */\r\n    public static mulScalarVector(k: number, v: FloatArray, length: size_t): void {\r\n        for (let i = 0; i < length; ++i) {\r\n            v[i] = v[i] * k;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds two vectors; assumes a and b have the same dimension.\r\n     * @param {!FloatArray} dst The sum of a and b result.\r\n     * @param {!FloatArray} a Operand vector.\r\n     * @param {!FloatArray} b Operand vector.\r\n     * @param {!number} length The length of vector a and b.\r\n     */\r\n    public static addVector(dst: FloatArray, a: DeepImmutable<FloatArray>, b: DeepImmutable<FloatArray>, length: size_t): void {\r\n        for (let i = 0; i < length; ++i) {\r\n            dst[i] = a[i] + b[i];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Divides a vector by its Euclidean length and returns the quotient.\r\n     * @param {!Float32Array} dst The normalized vector.\r\n     * @param {!Float32Array} a The vector.\r\n     * @param {!number} length The length of vector a.\r\n     */\r\n    public static normalize(dst: Float32Array, a: DeepImmutable<Float32Array>, length: size_t): void {\r\n        let n: float = 0.0;\r\n\r\n        for (let i = 0; i < length; ++i) {\r\n            n += a[i] * a[i];\r\n        }\r\n        n = Math.sqrt(n);\r\n        if (n > 0.00001)\r\n        {\r\n            for (let i = 0; i < length; ++i) {\r\n                dst[i] = a[i] / n;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            for (let i = 0; i < length; ++i) {\r\n                dst[i] = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Subtracts two vectors.\r\n     * @param {!FloatArray} dst The difference of a and b result.\r\n     * @param {!FloatArray} a Operand vector.\r\n     * @param {!FloatArray} b Operand vector.\r\n     * @param {!number} length The length of vector a and b.\r\n     */\r\n    public static subVector(dst: FloatArray, a: DeepImmutable<FloatArray>, b: DeepImmutable<FloatArray>, length: size_t): void {\r\n        for (let i = 0; i < length; ++i) {\r\n            dst[i] = a[i] - b[i];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Computes the cross product of two vectors; assumes both vectors have\r\n     * three entries.\r\n     * @return {!FloatArray} The vector a cross b result.\r\n     * @param {!FloatArray} a Operand vector.\r\n     * @param {!FloatArray} b Operand vector.\r\n     */\r\n    public static cross(dst: FloatArray, a: DeepImmutable<FloatArray>, b: DeepImmutable<FloatArray>): void {\r\n        dst[0] = a[1] * b[2] - a[2] * b[1];\r\n        dst[1] = a[2] * b[0] - a[0] * b[2];\r\n        dst[2] = a[0] * b[1] - a[1] * b[0];\r\n    }\r\n\r\n    /**\r\n     * Computes the dot product of two vectors; assumes that a and b have\r\n     * the same dimension.\r\n     * @param {!Float32Array} a Operand vector.\r\n     * @param {!Float32Array} b Operand vector.\r\n     * @return {number} The dot product of a and b.\r\n     */\r\n    public static dot(a: DeepImmutable<Float32Array>, b: DeepImmutable<Float32Array>): float {\r\n        return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]);\r\n    }\r\n\r\n    /**\r\n     * Computes a 4-by-4 camera look-at transformation. This is the\r\n     * inverse of lookAt The transformation generated is an\r\n     * orthogonal rotation matrix with translation component.\r\n     * @param {!FloatArray} dst The camera look-at matrix result.\r\n     * @param {!FloatArray} eye The position of the eye.\r\n     * @param {!FloatArray} target The position meant to be viewed.\r\n     * @param {!FloatArray} up A vector pointing up.\r\n     */\r\n    public static cameraLookAt(dst: FloatArray, eye: DeepImmutable<FloatArray>, target: DeepImmutable<FloatArray>, up: DeepImmutable<FloatArray>): void {\r\n        let t0: Float32Array = new Float32Array(3);\r\n        let t1: Float32Array = new Float32Array(3);\r\n        let t2: Float32Array = new Float32Array(3);\r\n        Matrix.subVector(t0, eye, target, 3);\r\n        Matrix.normalize(t0, t0, 3);\r\n        Matrix.cross(t1, up, t0);\r\n        Matrix.normalize(t1, t1, 3);\r\n        Matrix.cross(t2, t0, t1);\r\n\r\n        dst[0]  = t1[0];\r\n        dst[1]  = t1[1];\r\n        dst[2]  = t1[2];\r\n        dst[3]  = 0.0;\r\n        dst[4]  = t2[0];\r\n        dst[5]  = t2[1];\r\n        dst[6]  = t2[2];\r\n        dst[7]  = 0.0;\r\n        dst[8]  = t0[0];\r\n        dst[9]  = t0[1];\r\n        dst[10] = t0[2];\r\n        dst[11] = 0.0;\r\n        dst[12] = eye[0];\r\n        dst[13] = eye[1];\r\n        dst[14] = eye[2];\r\n        dst[15] = 1.0;\r\n    }\r\n\r\n    /**\r\n     * Resets the pseudoRandom function sequence.\r\n     */\r\n    public static resetPseudoRandom(): void {\r\n        Matrix._randomSeed = 0;\r\n    }\r\n\r\n    /**\r\n     * Returns a deterministic pseudorandom number between 0 and 1\r\n     * @return {float} a random number between 0 and 1\r\n     */\r\n    public static pseudoRandom(): float {\r\n        Matrix._randomSeed = (134775813 * Matrix._randomSeed + 1) % Matrix._RANDOM_RANGE;\r\n        return Matrix._randomSeed / Matrix._randomSeed;\r\n    }\r\n\r\n    /**\r\n     * Creates a 4-by-4 matrix which translates by the given vector v.\r\n     * @param {!FloatArray} dst The translation matrix result.\r\n     * @param {!Float32Array} v The vector by which to translate.\r\n     */\r\n    public static translation(dst: FloatArray, v: DeepImmutable<Float32Array>): void {\r\n        dst[0]  = 1;\r\n        dst[1]  = 0;\r\n        dst[2]  = 0;\r\n        dst[3]  = 0;\r\n        dst[4]  = 0;\r\n        dst[5]  = 1;\r\n        dst[6]  = 0;\r\n        dst[7]  = 0;\r\n        dst[8]  = 0;\r\n        dst[9]  = 0;\r\n        dst[10] = 1;\r\n        dst[11] = 0;\r\n        dst[12] = v[0];\r\n        dst[13] = v[1];\r\n        dst[14] = v[2];\r\n        dst[15] = 1;\r\n    }\r\n\r\n    /**\r\n     * Modifies the given 4-by-4 matrix by translation by the given vector v.\r\n     * @param {!FloatArray} m The matrix result.\r\n     * @param {!Float32Array} v The vector by which to translate.\r\n     */\r\n    public static translate(m: FloatArray, v: DeepImmutable<Float32Array>): void {\r\n        const v0  = v[0];\r\n        const v1  = v[1];\r\n        const v2  = v[2];\r\n        const m00 = m[0];\r\n        const m01 = m[1];\r\n        const m02 = m[2];\r\n        const m03 = m[3];\r\n        const m10 = m[1 * 4 + 0];\r\n        const m11 = m[1 * 4 + 1];\r\n        const m12 = m[1 * 4 + 2];\r\n        const m13 = m[1 * 4 + 3];\r\n        const m20 = m[2 * 4 + 0];\r\n        const m21 = m[2 * 4 + 1];\r\n        const m22 = m[2 * 4 + 2];\r\n        const m23 = m[2 * 4 + 3];\r\n        const m30 = m[3 * 4 + 0];\r\n        const m31 = m[3 * 4 + 1];\r\n        const m32 = m[3 * 4 + 2];\r\n        const m33 = m[3 * 4 + 3];\r\n\r\n        m[12] = m00 * v0 + m10 * v1 + m20 * v2 + m30;\r\n        m[13] = m01 * v0 + m11 * v1 + m21 * v2 + m31;\r\n        m[14] = m02 * v0 + m12 * v1 + m22 * v2 + m32;\r\n        m[15] = m03 * v0 + m13 * v1 + m23 * v2 + m33;\r\n    }\r\n\r\n    /**\r\n     * Converts degrees to radians.\r\n     * @param {number} degrees A value in degrees.\r\n     * @return {number} the value in radians.\r\n     */\r\n    public static degToRad(degrees: float): float {\r\n        return degrees * Math.PI / 180.0;\r\n    }\r\n}","import { ASSERT, BuildArray, Nullable, double, float, FloatArray, int, size_t, uint32_t } from \"./types\";\r\n\r\nimport { Behavior } from \"./behavior\";\r\nimport { Buffer } from \"./buffer\";\r\nimport { Context, ContextWebGPU } from \"./context\";\r\nimport { FPSTimer } from \"./fpsTimer\";\r\nimport { IO } from \"./io\";\r\nimport { Program } from \"./program\";\r\nimport { Matrix } from \"./matrix\";\r\nimport { Model, FishModel } from \"./model\";\r\nimport { ResourceHelper } from \"./resourceHelper\";\r\nimport { Texture } from \"./texture\";\r\nimport { FogUniforms, LightWorldPositionUniform, LightUniforms, WorldUniforms } from \"./uniforms\";\r\n\r\n/**\r\n * Define global variables, enums, constant variables and Class Aquarium.\r\n */\r\n\r\nexport enum MODELNAME {\r\n    MODELFIRST,\r\n    MODELRUINCOlOMN,\r\n    MODELARCH,\r\n    MODELROCKA,\r\n    MODELROCKB,\r\n    MODELROCKC,\r\n    MODELSUNKNSHIPBOXES,\r\n    MODELSUNKNSHIPDECK,\r\n    MODELSUNKNSHIPHULL,\r\n    MODELFLOORBASE_BAKED,\r\n    MODELSUNKNSUB,\r\n    MODELCORAL,\r\n    MODELSTONE,\r\n    MODELCORALSTONEA,\r\n    MODELCORALSTONEB,\r\n    MODELGLOBEBASE,\r\n    MODELTREASURECHEST,\r\n    MODELENVIRONMENTBOX,\r\n    MODELSUPPORTBEAMS,\r\n    MODELSKYBOX,\r\n    MODELGLOBEINNER,\r\n    MODELSEAWEEDA,\r\n    MODELSEAWEEDB,\r\n    MODELSMALLFISHA,\r\n    MODELMEDIUMFISHA,\r\n    MODELMEDIUMFISHB,\r\n    MODELBIGFISHA,\r\n    MODELBIGFISHB,\r\n    MODELSMALLFISHAINSTANCEDDRAWS,\r\n    MODELMEDIUMFISHAINSTANCEDDRAWS,\r\n    MODELMEDIUMFISHBINSTANCEDDRAWS,\r\n    MODELBIGFISHAINSTANCEDDRAWS,\r\n    MODELBIGFISHBINSTANCEDDRAWS,\r\n    MODELMAX\r\n}\r\n\r\nexport enum MODELGROUP {\r\n    FISH,\r\n    FISHINSTANCEDDRAW,\r\n    INNER,\r\n    SEAWEED,\r\n    GENERIC,\r\n    OUTSIDE,\r\n    GROUPMAX\r\n}\r\n\r\nexport class G_sceneInfo {\r\n    namestr: string;\r\n    name: MODELNAME;\r\n    program: Array<string>;\r\n    fog: boolean;\r\n    type: MODELGROUP;\r\n    blend?: boolean;\r\n}\r\n\r\nexport enum FISHENUM {\r\n    BIG,\r\n    MEDIUM,\r\n    SMALL,\r\n    MAX\r\n}\r\n\r\nexport enum TOGGLE {\r\n    // Stop rendering after specified time.\r\n    AUTOSTOP,\r\n    // Enable alpha blending.\r\n    ENABLEALPHABLENDING,\r\n    // Enable 4 times MSAA.\r\n    ENABLEMSAAx4,\r\n    // Go through instanced draw.\r\n    ENABLEINSTANCEDDRAWS,\r\n    // The toggle is only supported on WebGPU backend.\r\n    // By default, the app will enable dynamic buffer offset.\r\n    // The toggle is to disable dbo feature.\r\n    ENABLEDYNAMICBUFFEROFFSET,\r\n    // Turn off render pass on d3d12\r\n    DISABLED3D12RENDERPASS,\r\n    // Turn off WebGPU validation,\r\n    DISABLEWEBGPUVALIDATION,\r\n    // Disable control panel,\r\n    DISABLECONTROLPANEL,\r\n    // Select integrated gpu if available.\r\n    INTEGRATEDGPU,\r\n    // Select discrete gpu if available.\r\n    DISCRETEGPU,\r\n    // Update and draw for each model on OpenGL and Angle backend, but draw once per frame on other\r\n    // backend.\r\n    UPATEANDDRAWFOREACHMODEL,\r\n    // Support Full Screen mode\r\n    ENABLEFULLSCREENMODE,\r\n    // Print logs such as avg fps\r\n    PRINTLOG,\r\n    // Use async buffer mapping to upload data\r\n    BUFFERMAPPINGASYNC,\r\n    // Simulate fish come and go for WEBGPU backend\r\n    SIMULATINGFISHCOMEANDGO,\r\n    // Turn off vsync, donot limit fps to 60\r\n    TURNOFFVSYNC,\r\n    TOGGLEMAX\r\n}\r\n\r\nexport const g_sceneInfo: G_sceneInfo[] = [\r\n    {\r\n        namestr: \"SmallFishA\",\r\n        name: MODELNAME.MODELSMALLFISHA,\r\n        program: [\"fishVertexShader\", \"fishReflectionFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISH\r\n    },\r\n    {\r\n        namestr: \"MediumFishA\",\r\n        name: MODELNAME.MODELMEDIUMFISHA,\r\n        program: [\"fishVertexShader\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISH\r\n    },\r\n    {\r\n        namestr: \"MediumFishB\",\r\n        name: MODELNAME.MODELMEDIUMFISHB,\r\n        program: [\"fishVertexShader\", \"fishReflectionFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISH\r\n    },\r\n    {\r\n        namestr: \"BigFishA\",\r\n        name: MODELNAME.MODELBIGFISHA,\r\n        program: [\"fishVertexShader\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISH\r\n    },\r\n    {\r\n        namestr: \"BigFishB\",\r\n        name: MODELNAME.MODELBIGFISHB,\r\n        program: [\"fishVertexShader\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISH\r\n    },\r\n    {\r\n        namestr: \"SmallFishA\",\r\n        name: MODELNAME.MODELSMALLFISHAINSTANCEDDRAWS,\r\n        program: [\"fishVertexShaderInstancedDraws\", \"fishReflectionFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISHINSTANCEDDRAW\r\n    },\r\n    {\r\n        namestr:  \"MediumFishA\",\r\n        name: MODELNAME.MODELMEDIUMFISHAINSTANCEDDRAWS,\r\n        program: [\"fishVertexShaderInstancedDraws\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISHINSTANCEDDRAW\r\n    },\r\n    {\r\n        namestr: \"MediumFishB\",\r\n        name: MODELNAME.MODELMEDIUMFISHBINSTANCEDDRAWS,\r\n        program: [\"fishVertexShaderInstancedDraws\", \"fishReflectionFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISHINSTANCEDDRAW\r\n    },\r\n    {\r\n        namestr: \"BigFishA\",\r\n        name: MODELNAME.MODELBIGFISHAINSTANCEDDRAWS,\r\n        program: [\"fishVertexShaderInstancedDraws\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISHINSTANCEDDRAW\r\n    },\r\n    {\r\n        namestr: \"BigFishB\",\r\n        name: MODELNAME.MODELBIGFISHBINSTANCEDDRAWS,\r\n        program: [\"fishVertexShaderInstancedDraws\", \"fishNormalMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.FISHINSTANCEDDRAW\r\n    },\r\n    {\r\n        namestr: \"Arch\",\r\n        name: MODELNAME.MODELARCH,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"Coral\",\r\n        name: MODELNAME.MODELCORAL,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"CoralStoneA\",\r\n        name: MODELNAME.MODELCORALSTONEA,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"CoralStoneB\",\r\n        name: MODELNAME.MODELCORALSTONEB,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"EnvironmentBox\",\r\n        name: MODELNAME.MODELENVIRONMENTBOX,\r\n        program: [\"diffuseVertexShader\", \"diffuseFragmentShader\"],\r\n        fog: false,\r\n        type: MODELGROUP.OUTSIDE\r\n    },\r\n    {\r\n        namestr: \"FloorBase_Baked\",\r\n        name: MODELNAME.MODELFLOORBASE_BAKED,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"GlobeBase\",\r\n        name: MODELNAME.MODELGLOBEBASE,\r\n        program: [\"diffuseVertexShader\", \"diffuseFragmentShader\"],\r\n        fog: false,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"GlobeInner\",\r\n        name: MODELNAME.MODELGLOBEINNER,\r\n        program: [\"innerRefractionMapVertexShader\", \"innerRefractionMapFragmentShader\"],\r\n        fog: true,\r\n        type: MODELGROUP.INNER\r\n    },\r\n    {\r\n        namestr: \"RockA\",\r\n        name: MODELNAME.MODELROCKA,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"RockB\", \"name\": MODELNAME.MODELROCKB,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"RockC\",\r\n        name: MODELNAME.MODELROCKC,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"RuinColumn\",\r\n        name: MODELNAME.MODELRUINCOlOMN,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"Stone\",\r\n        name: MODELNAME.MODELSTONE,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"SunknShipBoxes\",\r\n        name: MODELNAME.MODELSUNKNSHIPBOXES,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"SunknShipDeck\",\r\n        name: MODELNAME.MODELSUNKNSHIPDECK,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"SunknShipHull\",\r\n        name: MODELNAME.MODELSUNKNSHIPHULL,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"SunknSub\",\r\n        name: MODELNAME.MODELSUNKNSUB,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    },\r\n    {\r\n        namestr: \"SeaweedA\",\r\n        name: MODELNAME.MODELSEAWEEDA,\r\n        program: [\"seaweedVertexShader\", \"seaweedFragmentShader\"],\r\n        fog: false,\r\n        type: MODELGROUP.SEAWEED\r\n    },\r\n    {\r\n        namestr: \"SeaweedB\",\r\n        name: MODELNAME.MODELSEAWEEDB,\r\n        program: [\"seaweedVertexShader\", \"seaweedFragmentShader\"],\r\n        fog: false,\r\n        type: MODELGROUP.SEAWEED\r\n    },\r\n    {\r\n        namestr: \"Skybox\",\r\n        name: MODELNAME.MODELSKYBOX,\r\n        program: [\"diffuseVertexShader\", \"diffuseFragmentShader\"],\r\n        fog: false,\r\n        type: MODELGROUP.OUTSIDE\r\n    },\r\n    {\r\n        namestr: \"SupportBeams\",\r\n        name: MODELNAME.MODELSUPPORTBEAMS,\r\n        program: [\"\", \"\"],\r\n        fog: false,\r\n        type: MODELGROUP.OUTSIDE\r\n    },\r\n    {\r\n        namestr: \"TreasureChest\",\r\n        name: MODELNAME.MODELTREASURECHEST,\r\n        program: [\"\", \"\"],\r\n        fog: true,\r\n        type: MODELGROUP.GENERIC\r\n    }\r\n];\r\n\r\nexport interface Fish {\r\n    name: string;\r\n    modelName: MODELNAME;\r\n    type: FISHENUM;\r\n    speed: float;\r\n    speedRange: float;\r\n    radius: float;\r\n    radiusRange: float;\r\n    tailSpeed: float;\r\n    heightOffset: float;\r\n    heightRange: float;\r\n\r\n    fishLength: float;\r\n    fishWaveLength: float;\r\n    fishBendAmount: float;\r\n\r\n    lasers?: boolean;\r\n    laserRot?: float;\r\n    laserOff?: Array<float>;\r\n    laserScale?: Array<float>;\r\n}\r\n\r\nexport const fishTable: Fish[] = [\r\n    {\r\n        name: \"SmallFishA\",\r\n        modelName: MODELNAME.MODELSMALLFISHA,\r\n        type: FISHENUM.SMALL,\r\n        speed: 1.0,\r\n        speedRange: 1.5,\r\n        radius: 30.0,\r\n        radiusRange: 25.0,\r\n        tailSpeed: 10.0,\r\n        heightOffset: 0.0,\r\n        heightRange: 16.0,\r\n        fishLength: 10.0,\r\n        fishWaveLength: 1.0,\r\n        fishBendAmount: 2.0\r\n    },\r\n    {\r\n        name: \"MediumFishA\",\r\n        modelName: MODELNAME.MODELMEDIUMFISHA,\r\n        type: FISHENUM.MEDIUM,\r\n        speed: 1.0,\r\n        speedRange: 2.0,\r\n        radius: 10.0,\r\n        radiusRange: 20.0,\r\n        tailSpeed: 1.0,\r\n        heightOffset: 0.0,\r\n        heightRange: 16.0,\r\n        fishLength: 10.0,\r\n        fishWaveLength: -2.0,\r\n        fishBendAmount: 2.0\r\n    },\r\n    {\r\n        name: \"MediumFishB\",\r\n        modelName: MODELNAME.MODELMEDIUMFISHB,\r\n        type: FISHENUM.MEDIUM,\r\n        speed: 0.5,\r\n        speedRange: 4.0,\r\n        radius: 10.0,\r\n        radiusRange: 20.0,\r\n        tailSpeed: 3.0,\r\n        heightOffset: -8.0,\r\n        heightRange: 5.0,\r\n        fishLength: 10.0,\r\n        fishWaveLength: -2.0,\r\n        fishBendAmount: 2.0\r\n    },\r\n    {\r\n        name: \"BigFishA\",\r\n        modelName: MODELNAME.MODELBIGFISHA,\r\n        type: FISHENUM.BIG,\r\n        speed: 0.5,\r\n        speedRange: 0.5,\r\n        radius: 50.0,\r\n        radiusRange: 3.0,\r\n        tailSpeed: 1.5,\r\n        heightOffset: 0.0,\r\n        heightRange: 16.0,\r\n        fishLength: 10.0,\r\n        fishWaveLength: -1.0,\r\n        fishBendAmount: 0.5,\r\n        lasers: true,\r\n        laserRot: 0.04,\r\n        laserOff: [0.0, 0.1, 9.0],\r\n        laserScale: [0.3, 0.3, 1000.0]\r\n    },\r\n    {\r\n        name: \"BigFishB\",\r\n        modelName: MODELNAME.MODELBIGFISHB,\r\n        type: FISHENUM.BIG,\r\n        speed: 0.5,\r\n        speedRange: 0.5,\r\n        radius: 45.0,\r\n        radiusRange: 3.0,\r\n        tailSpeed: 1.0,\r\n        heightOffset: 0.0,\r\n        heightRange: 16.0,\r\n        fishLength: 10.0,\r\n        fishWaveLength: -0.7,\r\n        fishBendAmount: 0.3,\r\n        lasers: true,\r\n        laserRot: 0.04,\r\n        laserOff: [0.0, -0.3, 9.0],\r\n        laserScale: [0.3, 0.3, 1000.0]\r\n    }\r\n]\r\n\r\nexport const g_tailOffsetMult: float         = 1.0;\r\nexport const g_endOfDome: float              = Math.PI / 8.0;\r\nexport const g_tankRadius: float             = 74.0;\r\nexport const g_tankHeight: float             = 36.0;\r\nexport const g_standHeight: float            = 25.0;\r\nexport const g_sharkSpeed: float             = 0.3;\r\nexport const g_sharkClockOffset: float       = 17.0;\r\nexport const g_sharkXClock: float            = 1.0;\r\nexport const g_sharkYClock: float            = 0.17;\r\nexport const g_sharkZClock: float            = 1.0;\r\nexport const g_numBubbleSets: int            = 10;\r\nexport const g_laserEta: float               = 1.2;\r\nexport const g_laserLenFudge: float          = 1.0;\r\nexport const g_numLightRays: int             = 5;\r\nexport const g_lightRayY: int                = 50;\r\nexport const g_lightRayDurationMin: int      = 1;\r\nexport const g_lightRayDurationRange: int    = 1;\r\nexport const g_lightRaySpeed: int            = 4;\r\nexport const g_lightRaySpread: int           = 7;\r\nexport const g_lightRayPosRange: int         = 20;\r\nexport const g_lightRayRotRange: float       = 1.0;\r\nexport const g_lightRayRotLerp: float        = 0.2;\r\nexport const g_lightRayOffset: float         = Math.PI * 2.0 / g_numLightRays;\r\nexport const g_bubbleTimer: float            = 0.0;\r\nexport const g_bubbleIndex: int              = 0;\r\n\r\nexport const g_numFishSmall: int             = 100;\r\nexport const g_numFishMedium: int            = 1000;\r\nexport const g_numFishBig: int               = 10000;\r\nexport const g_numFishLeftSmall: int         = 80;\r\nexport const g_numFishLeftBig: int           = 160;\r\nexport const g_sand_shininess: float         = 5.0;\r\nexport const g_sand_specularFactor: float    = 0.3;\r\nexport const g_generic_shininess: float      = 50.0;\r\nexport const g_generic_specularFactor: float = 1.0;\r\nexport const g_outside_shininess: float      = 50.0;\r\nexport const g_outside_specularFactor: float = 0.0;\r\nexport const g_seaweed_shininess: float      = 50.0;\r\nexport const g_seaweed_specularFactor: float = 1.0;\r\nexport const g_inner_shininess: float        = 50.0;\r\nexport const g_inner_specularFactor: float   = 1.0;\r\nexport const g_fish_shininess: float         = 5.0;\r\nexport const g_fish_specularFactor: float    = 0.3;\r\n\r\nexport const g_speed: float                  = 1.0;\r\nexport const g_targetHeight: float           = 63.3;\r\nexport const g_targetRadius: float           = 91.6;\r\nexport const g_eyeHeight: float              = 7.5;\r\nexport const g_eyeSpeed: float               = 0.0258;\r\nexport const g_filedOfView: float            = 82.699;\r\nexport const g_ambientRed: float             = 0.218;\r\nexport const g_ambientGreen: float           = 0.502;\r\nexport const g_ambientBlue: float            = 0.706;\r\nexport const g_fogPower: float               = 16.5;\r\nexport const g_fogMult: float                = 1.5;\r\nexport const g_fogOffset: float              = 0.738;\r\nexport const g_fogRed: float                 = 0.338;\r\nexport const g_fogGreen: float               = 0.81;\r\nexport const g_fogBlue: float                = 1.0;\r\nexport const g_fishHeightRange: float        = 1.0;\r\nexport const g_fishHeight: float             = 25.0;\r\nexport const g_fishSpeed: float              = 0.124;\r\nexport const g_fishOffset: float             = 0.52;\r\nexport const g_fishXClock: float             = 1.0;\r\nexport const g_fishYClock: float             = 0.556;\r\nexport const g_fishZClock: float             = 1.0;\r\nexport const g_fishTailSpeed: float          = 1.0;\r\nexport const g_refractionFudge: float        = 3.0;\r\nexport const g_eta: float                    = 1.0;\r\nexport const g_tankColorFudge: float         = 0.796;\r\nexport const g_fovFudge: float               = 1.0;\r\nexport const g_net_offset: Array<float>      = [0.0, 0.0, 0.0];\r\nexport const g_net_offsetMult: float         = 1.21;\r\nexport const g_eyeRadius: float              = 13.2;\r\nexport const g_fieldOfView: float            = 82.699;\r\n\r\nexport class Global {\r\n\r\n    public projection: Array<float>\r\n    public view: Array<float>\r\n    public worldInverse: Array<float>\r\n    public viewProjectionInverse: Array<float>\r\n    public skyView: Array<float>\r\n    public skyViewProjection: Array<float>\r\n    public skyViewProjectionInverse: Array<float>\r\n    public eyePosition: Array<float>\r\n    public target: Array<float>\r\n    public up: Array<float>;\r\n    public v3t0: Array<float>\r\n    public v3t1: Array<float>\r\n    public m4t0: Array<float>\r\n    public m4t1: Array<float>\r\n    public m4t2: Array<float>\r\n    public m4t3: Array<float>\r\n    public colorMult: Array<float>;\r\n    public then: double;\r\n    public start: double;\r\n    public mclock: float;\r\n    public eyeClock: float;\r\n    public alpha: string;\r\n\r\n    constructor() {\r\n        this.projection               = BuildArray(16, () => 0.0);\r\n        this.view                     = BuildArray(16, () => 0.0);\r\n        this.worldInverse             = BuildArray(16, () => 0.0);\r\n        this.viewProjectionInverse    = BuildArray(16, () => 0.0);\r\n        this.skyView                  = BuildArray(16, () => 0.0);\r\n        this.skyViewProjection        = BuildArray(16, () => 0.0);\r\n        this.skyViewProjectionInverse = BuildArray(16, () => 0.0);\r\n        this.eyePosition              = BuildArray(3, () => 0.0);\r\n        this.target                   = BuildArray(3, () => 0.0);\r\n        this.up                       = [0, 1, 0];\r\n        this.v3t0                     = BuildArray(3, () => 0.0);\r\n        this.v3t1                     = BuildArray(3, () => 0.0);\r\n        this.m4t0                     = BuildArray(16, () => 0.0);\r\n        this.m4t1                     = BuildArray(16, () => 0.0);\r\n        this.m4t2                     = BuildArray(16, () => 0.0);\r\n        this.m4t3                     = BuildArray(16, () => 0.0);\r\n        this.colorMult                = [1, 1, 1, 1];\r\n    }\r\n\r\n}\r\n\r\nexport class AquariumOptions {\r\n    canvas: HTMLCanvasElement;\r\n    num_fish?: int;\r\n    enable_msaa?: boolean;\r\n    disable_dynamic_buffer_offset?: boolean;\r\n    integrated_gpu?: boolean;\r\n    discrete_gpu?: boolean;\r\n    enable_full_screen_mode?: boolean;\r\n    print_log?: boolean;\r\n    buffer_mapping_async?: boolean;\r\n    turn_off_vsync?: boolean;\r\n    test_time?: int;\r\n    disable_webgpu_validation?: boolean;\r\n    enable_alpha_blending?: string;\r\n    simulating_fish_come_and_go?: boolean;\r\n    disable_control_panel?: boolean;\r\n}\r\n\r\nexport class Aquarium {\r\n\r\n    public toggleBitset: Array<boolean>;\r\n    public lightWorldPositionUniform: Nullable<LightWorldPositionUniform> = new LightWorldPositionUniform();\r\n    public worldUniforms: Nullable<WorldUniforms> = new WorldUniforms();\r\n    public lightUniforms: Nullable<LightUniforms> = new LightUniforms();\r\n    public fogUniforms: Nullable<FogUniforms> = new FogUniforms();\r\n    public g: Nullable<Global> = new Global();\r\n    public fishCount: Array<int>;\r\n\r\n    private _modelEnumMap: Record<string, MODELNAME> = {};\r\n    private _textureMap: Record<string, Nullable<Texture>> = {};\r\n    private _programMap: Record<string, Nullable<Program>> = {};\r\n    private _aquariumModels: Array<Nullable<Model>>;\r\n    private _context: Nullable<Context> = null;\r\n    private _fpsTimer: Nullable<FPSTimer> = null; // object to measure frames per second;\r\n    private _curFishCount: int;\r\n    private _preFishCount: int;\r\n    private _testTime: int;\r\n    private _skyUrls: Array<string>;\r\n    private _fishBehavior: Array<Nullable<Behavior>>;\r\n\r\n    private _fisCountGetter: () => int;\r\n    private _fisCountSetter: (fishCount: int) => void;\r\n\r\n    constructor() {            \r\n        this._curFishCount = 1;\r\n        this._preFishCount = 0;\r\n\r\n        this.g.then          = 0.0;\r\n        this.g.mclock        = 0.0;\r\n        this.g.eyeClock      = 0.0;\r\n        this.g.alpha         = \"1\";\r\n\r\n        this.lightUniforms.ambient    = [g_ambientRed, g_ambientGreen, g_ambientBlue, 0.0];\r\n        this.lightUniforms.lightColor = [1.0, 1.0, 1.0, 1.0];\r\n        this.lightUniforms.specular   = [1.0, 1.0, 1.0, 1.0];\r\n\r\n        this.fogUniforms.fogColor  = [g_fogRed, g_fogGreen, g_fogBlue, 1.0];\r\n        this.fogUniforms.fogPower  = g_fogPower;\r\n        this.fogUniforms.fogMult   = g_fogMult;\r\n        this.fogUniforms.fogOffset = g_fogOffset;\r\n\r\n        this.fishCount = [0, 0, 0, 0, 0];\r\n\r\n        this.toggleBitset    = BuildArray(TOGGLE.TOGGLEMAX, () => false);\r\n        this._aquariumModels = BuildArray(MODELNAME.MODELMAX, () => null);\r\n        this._fpsTimer       = new FPSTimer();\r\n\r\n        this._fisCountGetter = () => { return this.curFishCount};\r\n        this._fisCountSetter = (fishCount: int) => { this.curFishCount = fishCount};\r\n    }\r\n\r\n    public dispose(): void {\r\n        \r\n    }\r\n\r\n    public get skybox(): Nullable<Texture> {\r\n        return this._textureMap[\"skybox\"];\r\n    }\r\n\r\n    public get curFishCount(): int {\r\n        return this._curFishCount;\r\n    }\r\n\r\n    public set curFishCount(value: int) {\r\n        // Not fully working yet\r\n        // this._curFishCount = value;\r\n    }\r\n\r\n    public get preFishCount(): int {\r\n        return this._preFishCount;\r\n    }\r\n\r\n    public async init(options: AquariumOptions): Promise<boolean> {\r\n        return Promise.resolve().then(async () => {\r\n            // Create context\r\n            this._context = new ContextWebGPU();\r\n\r\n            const availableToggleBitset: Array<boolean> = this._context.availableToggleBitset;\r\n            if (availableToggleBitset[TOGGLE.UPATEANDDRAWFOREACHMODEL]) {\r\n                this.toggleBitset[TOGGLE.UPATEANDDRAWFOREACHMODEL] = true;\r\n            }\r\n            if (availableToggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET]) {\r\n                this.toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET] = true;\r\n            }\r\n            this.toggleBitset[TOGGLE.ENABLEALPHABLENDING] = true;\r\n\r\n            if (!this._processOptions(options, availableToggleBitset)) {\r\n                return false;\r\n            }\r\n\r\n            if (!await this._context.initialize(this.toggleBitset, options.canvas)) {\r\n                return false;\r\n            }\r\n\r\n            this._calculateFishCount();\r\n\r\n            console.log(\"Init resources ...\");\r\n            this._getElapsedTime();\r\n\r\n            const resourceHelper: ResourceHelper = this._context.resourceHelper;\r\n            const skyUrls: string[] = resourceHelper.getSkyBoxUrls();\r\n            this._textureMap[\"skybox\"] = await this._context.createTextureWebGPU(\"skybox\", skyUrls);\r\n\r\n            // Init general buffer and binding groups for WebGPU backend.\r\n            this._context.initGeneralResources(this);\r\n            // Avoid resource allocation in the first render loop\r\n            this._preFishCount = this._curFishCount;\r\n\r\n            this._setupModelEnumMap();\r\n            await this.loadResource();\r\n            this._context.flush();\r\n\r\n            console.log(\"End loading.\\nCost \" + this._getElapsedTime() + \"s totally.\");\r\n\r\n            this._resetFpsTime();\r\n\r\n            return true;\r\n        });\r\n    }\r\n\r\n    private _processOptions(options: AquariumOptions, availableToggleBitset: Array<boolean>): boolean {\r\n        if (!options) {\r\n            return false;\r\n        }\r\n\r\n        if (options.num_fish) {\r\n            this._curFishCount = options.num_fish;\r\n            if (this._curFishCount < 0) {\r\n                console.error(\"Fish count should larger or equal to 0.\");\r\n                return false;\r\n            }\r\n        }\r\n        if (options.enable_msaa) {\r\n            if (!availableToggleBitset[TOGGLE.ENABLEMSAAx4]) {\r\n                console.error(\"MSAA isn't implemented for the backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.ENABLEMSAAx4] = true;\r\n        }\r\n        if (options.disable_dynamic_buffer_offset) {\r\n            if (!availableToggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET]) {\r\n                console.error(\"Dynamic buffer offset is not supported.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET] = true;\r\n        }\r\n        if (options.integrated_gpu) {\r\n            if (!availableToggleBitset[TOGGLE.INTEGRATEDGPU] &&\r\n                !availableToggleBitset[TOGGLE.DISCRETEGPU])  {\r\n                console.error(\"Dynamically choose gpu isn't supported for the backend.\");\r\n                return false;\r\n            }\r\n\r\n            if (availableToggleBitset[TOGGLE.DISCRETEGPU]) {\r\n                console.error(\"Integrated and Discrete gpu cannot be used simultaneosly.\");\r\n            }\r\n            this.toggleBitset[TOGGLE.INTEGRATEDGPU] = true;\r\n        }\r\n        if (options.discrete_gpu) {\r\n            if (!availableToggleBitset[TOGGLE.INTEGRATEDGPU] &&\r\n                !availableToggleBitset[TOGGLE.DISCRETEGPU])  {\r\n                console.error(\"Dynamically choose gpu isn't supported for the backend.\");\r\n                return false;\r\n            }\r\n\r\n            if (availableToggleBitset[TOGGLE.INTEGRATEDGPU]) {\r\n                console.error(\"Integrated and Discrete gpu cannot be used simultaneosly.\");\r\n            }\r\n            this.toggleBitset[TOGGLE.DISCRETEGPU] = true;\r\n        }\r\n        if (options.enable_full_screen_mode) {\r\n            if (!availableToggleBitset[TOGGLE.ENABLEFULLSCREENMODE]) {\r\n                console.error(\"Full screen mode isn't supported for the backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.ENABLEFULLSCREENMODE] = true;\r\n        }\r\n        if (options.print_log) {\r\n            this.toggleBitset[TOGGLE.PRINTLOG] = true;\r\n        }\r\n        if (options.buffer_mapping_async) {\r\n            if (!availableToggleBitset[TOGGLE.BUFFERMAPPINGASYNC]) {\r\n                console.error(\"Buffer mapping async isn't supported for the backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.BUFFERMAPPINGASYNC] = true;\r\n        }\r\n        if (options.turn_off_vsync) {\r\n            if (!availableToggleBitset[TOGGLE.TURNOFFVSYNC]) {\r\n                console.error(\"Turn off vsync isn't supported for the backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.TURNOFFVSYNC] = true;\r\n        }\r\n        if (options.test_time) {\r\n            this._testTime = options.test_time;\r\n            this.toggleBitset[TOGGLE.AUTOSTOP] = true;\r\n        }\r\n        if (options.disable_webgpu_validation) {\r\n            if (!availableToggleBitset[TOGGLE.DISABLEWEBGPUVALIDATION]) {\r\n                console.error(\"Disable validation for WebGPU backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.DISABLEWEBGPUVALIDATION] = true;\r\n        }\r\n        if (options.enable_alpha_blending) {\r\n            this.g.alpha = options.enable_alpha_blending;\r\n            if (this.g.alpha === \"false\") {\r\n                this.toggleBitset[TOGGLE.ENABLEALPHABLENDING] = false;\r\n            }\r\n        }\r\n        if (options.simulating_fish_come_and_go) {\r\n            if (!availableToggleBitset[TOGGLE.SIMULATINGFISHCOMEANDGO]) {\r\n                console.error(\"Simulating fish come and go is only implemented for WebGPU backend.\");\r\n                return false;\r\n            }\r\n            this.toggleBitset[TOGGLE.SIMULATINGFISHCOMEANDGO] = true;\r\n        }\r\n        if (options.disable_control_panel) {\r\n            this.toggleBitset[TOGGLE.DISABLECONTROLPANEL] = true;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private _resetFpsTime(): void {\r\n        this.g.start = performance.now() / 1000.0;\r\n        this.g.then  = this.g.start\r\n    }\r\n\r\n    /**\r\n     * Main render loop.\r\n     */\r\n    public display(): void {\r\n        let shouldQuit: boolean = this._context.shouldQuit();\r\n        if (!shouldQuit) {\r\n            this._context.statsBegin()\r\n\r\n            this._context.keyBoardQuit();\r\n            this._render();\r\n\r\n            this._context.doFlush(this.toggleBitset);\r\n\r\n            if (this.toggleBitset[TOGGLE.AUTOSTOP]\r\n                && (this.g.then - this.g.start) > this._testTime) {\r\n                shouldQuit = true\r\n            }\r\n\r\n            this._context.statsEnd();\r\n        }\r\n\r\n        if (!shouldQuit) {\r\n            window.requestAnimationFrame(this.display.bind(this));\r\n        }\r\n        else {\r\n            this._context.terminate();\r\n\r\n            if (this.toggleBitset[TOGGLE.PRINTLOG]) {\r\n                this._printAvgFps();\r\n            }\r\n        }\r\n    }\r\n\r\n    private async loadResource(): Promise<void> {\r\n        return Promise.resolve().then(async () => {\r\n            await this._loadModels();\r\n            await this._loadPlacement();\r\n            if (this.toggleBitset[TOGGLE.SIMULATINGFISHCOMEANDGO]) {\r\n                await this._loadFishScenario();\r\n            }\r\n        });\r\n    }\r\n\r\n    private _setupModelEnumMap(): void {\r\n        for (let info of g_sceneInfo) {\r\n            this._modelEnumMap[info.namestr] = info.name;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load world matrices of models from json file.\r\n     */\r\n    private async _loadPlacement(): Promise<void> {\r\n        const resourceHelper: ResourceHelper = this._context.resourceHelper;\r\n        const proppath: string = resourceHelper.propPlacementPath;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            IO.LoadJSON(proppath, (json: any, exception: string) => {\r\n                if (exception) {\r\n                    console.error(\"Unable to load placement file: \" + exception);\r\n                    reject(exception);\r\n                }\r\n\r\n                ASSERT(\"objects\" in json, \"JSON file does not contain an 'objects' key.\");\r\n                let objects = json.objects;\r\n                ASSERT(Array.isArray(objects), \"'objects' value is not an array.\");\r\n\r\n                for (let i: size_t = 0; i < objects.length; ++i) {\r\n                    const name: any          = objects[i].name;\r\n                    const worldMatrix: any[] = objects[i].worldMatrix;\r\n                    ASSERT(Array.isArray(worldMatrix) && worldMatrix.length == 16, \"Invalid world matrix\");\r\n                \r\n                    let matrix: Array<float> = [];\r\n                    for (let j: size_t = 0; j < worldMatrix.length; ++j) {\r\n                        matrix.push(worldMatrix[j] as float);\r\n                    }\r\n\r\n                    const modelname: MODELNAME = this._modelEnumMap[name as string];\r\n                    // MODELFIRST means the model is not found in the Map\r\n                    if (modelname !== MODELNAME.MODELFIRST && this._aquariumModels[modelname]) {\r\n                        this._aquariumModels[modelname].worldmatrices.push(matrix);\r\n                    }\r\n                }\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    private async _loadModels(): Promise<void> {\r\n        return Promise.resolve().then(async () => {\r\n            const enableInstanceddraw: boolean = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS];\r\n            for (let info of g_sceneInfo) {\r\n                if ((enableInstanceddraw && info.type === MODELGROUP.FISH)\r\n                    || ((!enableInstanceddraw) && info.type === MODELGROUP.FISHINSTANCEDDRAW)) {\r\n                    continue;\r\n                }\r\n                await this._loadModel(info);\r\n            }\r\n        });\r\n    }\r\n\r\n    private async _loadFishScenario(): Promise<void> {\r\n        const resourceHelper: ResourceHelper = this._context.resourceHelper;\r\n        const fishBehaviorPath: string = resourceHelper.fishBehaviorPath;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            IO.LoadJSON(fishBehaviorPath, (json: any, exception: string) => {\r\n                if (exception) {\r\n                    console.error(\"Unable to load fish scenario file: \" + exception);\r\n                    reject(exception);\r\n                }\r\n\r\n                ASSERT(\"behaviors\" in json, \"JSON file does not contain a 'behaviors' key.\");\r\n                let behaviors = json.behaviors;\r\n                ASSERT(Array.isArray(behaviors), \"'behaviors' value is not an array.\");\r\n\r\n                for (let i: size_t = 0; i < behaviors.length; ++i) {\r\n                    const frame: int = behaviors[i].frame as int;\r\n                    const op: string = behaviors[i].op as string;\r\n                    const count: int = behaviors[i].count as int;\r\n\r\n                    const behave: Behavior = new Behavior(frame, op, count);\r\n                    this._fishBehavior.push(behave);\r\n                }\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Load vertex and index buffers, textures and program for each model.\r\n     * @param info the model\r\n     */\r\n    private async _loadModel(info: G_sceneInfo): Promise<void> {\r\n        const resourceHelper: ResourceHelper = this._context.resourceHelper;\r\n        const imagePath: string              = resourceHelper.imagePath;\r\n        const programPath: string            = resourceHelper.programPath\r\n        const modelPath: string              = resourceHelper.getModelPath(info.namestr);\r\n    \r\n        return new Promise(async (resolve, reject) => {\r\n            IO.LoadJSON(modelPath, async (json: any, exception: string) => {\r\n                if (exception) {\r\n                    console.error(\"Unable to load model file: \" + exception);\r\n                    reject(exception);\r\n                }\r\n\r\n                ASSERT(\"models\" in json, \"JSON file does not contain a 'models' key.\");\r\n                let models = json.models;\r\n                ASSERT(Array.isArray(models), \"'models' value is not an array.\");\r\n\r\n                let model: Nullable<Model> = null;\r\n                if (this.toggleBitset[TOGGLE.ENABLEALPHABLENDING] &&\r\n                    info.type !== MODELGROUP.INNER && info.type !== MODELGROUP.OUTSIDE) {\r\n                    model = this._context.createModel(this, info.type, info.name, true);\r\n                }\r\n                else {\r\n                    model = this._context.createModel(this, info.type, info.name, info.blend);\r\n                }\r\n                this._aquariumModels[info.name] = model;\r\n\r\n                let value = models[models.length - 1];\r\n                {\r\n                    // Set up textures\r\n                    const textures: any[] = value.textures;\r\n                    for (let textureName in textures) {\r\n                        const name: string  = textureName as string;\r\n                        const image: string = textures[textureName] as string;\r\n\r\n                        if (!(image in this._textureMap)) {\r\n                            this._textureMap[image] = await this._context.createTextureWebGPU(name, imagePath + image);\r\n                        }\r\n\r\n                        model.textureMap[name] = this._textureMap[image];\r\n                    }\r\n\r\n                    // Set up vertices\r\n                    const arrays: any[] = value.fields;\r\n                    for (let arrayName in arrays) {\r\n                        const texture: any        = arrays[arrayName];\r\n                        const name: string        = arrayName as string;\r\n                        const numComponents: int  = texture.numComponents as int;\r\n                        const type: string        = texture.type as string;\r\n                        let buffer: Nullable<Buffer> = null;\r\n                        if (name == \"indices\") {\r\n                            ASSERT(type === \"Uint16Array\", \"Invalid indices array type.\");\r\n                            let vec: Array<int> = [];\r\n                            for (let data of texture.data) {\r\n                                vec.push(data as int);\r\n                            }\r\n                            buffer = this._context.createBufferWebGPU(numComponents, new Uint16Array(vec), true);\r\n                        }\r\n                        else {\r\n                            ASSERT(type === \"Float32Array\", \"Invalid vertices array type.\");\r\n                            let vec: Array<float> = [];\r\n                            for (let data of texture.data) {\r\n                                vec.push(data as float);\r\n                            }\r\n                            buffer = this._context.createBufferWebGPU(numComponents, new Float32Array(vec), false);\r\n                        }\r\n\r\n                        model.bufferMap[name] = buffer;\r\n                    }\r\n\r\n                    // setup program\r\n                    // There are 3 programs\r\n                    // DM\r\n                    // DM+NM\r\n                    // DM+NM+RM\r\n                    let vsId: string = info.program[0];\r\n                    let fsId: string = info.program[1];\r\n\r\n                    if (vsId !== \"\" && fsId !== \"\") {\r\n                        model.textureMap[\"skybox\"] = this._textureMap[\"skybox\"];\r\n                    }\r\n                    else if (\"reflection\" in model.textureMap && model.textureMap[\"reflection\"] !== null) {\r\n                        vsId = \"reflectionMapVertexShader\";\r\n                        fsId = \"reflectionMapFragmentShader\";\r\n\r\n                        model.textureMap[\"skybox\"] = this._textureMap[\"skybox\"];\r\n                    }\r\n                    else if (\"normalMap\" in model.textureMap && model.textureMap[\"normalMap\"] !== null) {\r\n                        vsId = \"normalMapVertexShader\";\r\n                        fsId = \"normalMapFragmentShader\";\r\n                    }\r\n                    else {\r\n                        vsId = \"diffuseVertexShader\";\r\n                        fsId = \"diffuseFragmentShader\";\r\n                    }\r\n\r\n                    let program: Nullable<Program> = null;\r\n                    const programId: string = vsId + fsId;\r\n                    if (programId in this._programMap) {\r\n                        program = this._programMap[programId];\r\n                    }\r\n                    else {\r\n                        program = this._context.createProgram(programPath + vsId, programPath + fsId);\r\n                        if (this.toggleBitset[TOGGLE.ENABLEALPHABLENDING] &&\r\n                            info.type !== MODELGROUP.INNER && info.type !== MODELGROUP.OUTSIDE) {\r\n                            await program.compileProgram(true, this.g.alpha);\r\n                        }\r\n                        else {\r\n                            await program.compileProgram(false, this.g.alpha);\r\n                        }\r\n                        this._programMap[programId] = program;\r\n                    }\r\n\r\n                    model.program = program;\r\n                    model.init();\r\n                }\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calculate fish count for each type of fish\r\n     */\r\n    private _calculateFishCount(): void {\r\n        let numLeft: int = this._curFishCount;\r\n        for (let i: size_t = 0; i < FISHENUM.MAX; ++i) {\r\n            for (let j: size_t = 0; j < fishTable.length; ++j) {\r\n                const fishInfo: Fish = fishTable[j];\r\n                if (fishInfo.type != i) {\r\n                    continue;\r\n                }\r\n                let numfloat: int = numLeft;\r\n                if (i == FISHENUM.BIG) {\r\n                    let temp: int = this._curFishCount < g_numFishSmall ? 1 : 2;\r\n                    numfloat = Math.min(numLeft, temp);\r\n                }\r\n                else if (i === FISHENUM.MEDIUM) {\r\n                    if (this._curFishCount < g_numFishMedium) {\r\n                        numfloat = Math.min(numLeft, this._curFishCount / 10);\r\n                    }\r\n                    else if (this._curFishCount < g_numFishBig)  {\r\n                        numfloat = Math.min(numLeft, g_numFishLeftSmall);\r\n                    }\r\n                    else {\r\n                        numfloat = Math.min(numLeft, g_numFishLeftBig);\r\n                    }\r\n                }\r\n                numLeft                                                        = numLeft - numfloat;\r\n                this.fishCount[fishInfo.modelName - MODELNAME.MODELSMALLFISHA] = numfloat;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _getElapsedTime(): double {\r\n        // Update our time\r\n        const now: double = performance.now() / 1000.0; // now in seconds\r\n        let elapsedTime: double = 0.0;\r\n        if (this.g.then == 0.0) {\r\n            elapsedTime = 0.0;\r\n        }\r\n        else {\r\n            elapsedTime = now - this.g.then;\r\n        }\r\n        this.g.then = now;\r\n\r\n        return elapsedTime;\r\n    }\r\n\r\n    private _printAvgFps(): void {\r\n        const avg: int = this._fpsTimer.variance();\r\n\r\n        console.log(\"Avg FPS: \" + avg);\r\n        if (avg == 0) {\r\n            console.log(\"Invalid value. The fps is unstable.\");\r\n        }\r\n    }\r\n\r\n    private _updateGlobalUniforms(): void {\r\n        let g = this.g;\r\n        let lightWorldPositionUniform = this.lightWorldPositionUniform;\r\n\r\n        let elapsedTime: double   = this._getElapsedTime();\r\n        let renderingTime: double = g.then - g.start;\r\n\r\n        this._fpsTimer.update(elapsedTime, renderingTime, this._testTime);\r\n        g.mclock += elapsedTime * g_speed;\r\n        g.eyeClock += elapsedTime * g_eyeSpeed;\r\n\r\n        g.eyePosition[0] = Math.sin(g.eyeClock) * g_eyeRadius;\r\n        g.eyePosition[1] = g_eyeHeight;\r\n        g.eyePosition[2] = Math.cos(g.eyeClock) * g_eyeRadius;\r\n        g.target[0]      = Math.sin(g.eyeClock + Math.PI) * g_targetRadius;\r\n        g.target[1]      = g_targetHeight;\r\n        g.target[2]      = Math.cos(g.eyeClock + Math.PI) * g_targetRadius;\r\n\r\n        let nearPlane: float = 1.0;\r\n        let farPlane: float  = 25000.0;\r\n        let aspect: float    = (this._context.clientWidth * 1.0) / (this._context.clientHeight * 1.0);\r\n        let top: float       = Math.tan(Matrix.degToRad(g_fieldOfView * g_fovFudge) * 0.5) * nearPlane;\r\n        let bottom: float    = -top;\r\n        let left: float      = aspect * bottom;\r\n        let right: float     = aspect * top;\r\n        let width: float     = Math.abs(right - left);\r\n        let height: float    = Math.abs(top - bottom);\r\n        let xOff: float      = width * g_net_offset[0] * g_net_offsetMult;\r\n        let yOff: float      = height * g_net_offset[1] * g_net_offsetMult;\r\n\r\n        // set frustum and camera look at\r\n        Matrix.frustum(g.projection, left + xOff, right + xOff, bottom + yOff, top + yOff, nearPlane, farPlane);\r\n        Matrix.cameraLookAt(lightWorldPositionUniform.viewInverse, g.eyePosition, g.target, g.up);\r\n        Matrix.inverse4(g.view, lightWorldPositionUniform.viewInverse);\r\n        Matrix.mulMatrixMatrix4(lightWorldPositionUniform.viewProjection, g.view, g.projection);\r\n        Matrix.inverse4(g.viewProjectionInverse, lightWorldPositionUniform.viewProjection);\r\n\r\n        g.skyView = g.view.slice();\r\n        g.skyView[12] = 0.0;\r\n        g.skyView[13] = 0.0;\r\n        g.skyView[14] = 0.0;\r\n        Matrix.mulMatrixMatrix4(g.skyViewProjection, g.skyView, g.projection);\r\n        Matrix.inverse4(g.skyViewProjectionInverse, g.skyViewProjection);\r\n\r\n        Matrix.getAxis(g.v3t0, lightWorldPositionUniform.viewInverse, 0);\r\n        Matrix.getAxis(g.v3t1, lightWorldPositionUniform.viewInverse, 1);\r\n        Matrix.mulScalarVector(20.0, g.v3t0, 3);\r\n        Matrix.mulScalarVector(30.0, g.v3t1, 3);\r\n        Matrix.addVector(lightWorldPositionUniform.lightWorldPos, g.eyePosition, g.v3t0, 3);\r\n        Matrix.addVector(lightWorldPositionUniform.lightWorldPos,\r\n                         lightWorldPositionUniform.lightWorldPos, g.v3t1, 3);\r\n\r\n        // update world uniforms for WebGPU backend\r\n        this._context.updateWorldlUniforms(this);\r\n    }\r\n\r\n    private _render(): void {\r\n        Matrix.resetPseudoRandom();\r\n\r\n        this._context.preFrame();\r\n\r\n        // Global Uniforms should update after command reallocation.\r\n        this._updateGlobalUniforms();\r\n\r\n        if (this.toggleBitset[TOGGLE.SIMULATINGFISHCOMEANDGO]) {\r\n            if (this._fishBehavior.length > 0) {\r\n                const behave: Behavior = this._fishBehavior[0];\r\n                let frame:int          = behave.frame;\r\n                if (frame == 0) {\r\n                    this._fishBehavior.shift(); // pop front element\r\n                    if (behave.op === \"+\") {\r\n                        this._curFishCount += behave.count;\r\n                    }\r\n                    else {\r\n                        this._curFishCount -= behave.count;\r\n                    }\r\n                    console.log(\"Fish count \" + this._curFishCount);\r\n                }\r\n                else {\r\n                    behave.frame = --frame;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]) {\r\n            if (this.curFishCount != this.preFishCount) {\r\n                this._calculateFishCount();\r\n                const enableDynamicBufferOffset: boolean = this.toggleBitset[TOGGLE.ENABLEDYNAMICBUFFEROFFSET];\r\n                this._context.reallocResource(this.preFishCount, this.curFishCount, enableDynamicBufferOffset);\r\n                this._preFishCount = this.curFishCount;\r\n\r\n                this._resetFpsTime();\r\n            }\r\n        }\r\n\r\n        const updateAndDrawForEachFish: Boolean = this.toggleBitset[TOGGLE.UPATEANDDRAWFOREACHMODEL];\r\n \r\n        if (updateAndDrawForEachFish) {\r\n            this._updateAndDrawBackground();\r\n            this._updateAndDrawFishes();\r\n            this._context.updateFPS(this._fpsTimer, this._fisCountGetter, this._fisCountSetter , this.toggleBitset);\r\n        }\r\n        else {\r\n            this._updateBackground();\r\n            this._updateFishes();\r\n            this._context.updateFPS(this._fpsTimer, this._fisCountGetter, this._fisCountSetter, this.toggleBitset);\r\n\r\n            // Begin render pass\r\n            this._context.beginRenderPass();\r\n\r\n            this._drawBackground();\r\n            this._drawFishes();\r\n            this._context.showFPS();\r\n\r\n            // End renderpass\r\n        }\r\n    }\r\n\r\n    private _updateAndDrawBackground(): void {\r\n        for (let i: int = MODELNAME.MODELRUINCOlOMN; i <= MODELNAME.MODELSEAWEEDB; ++i) {\r\n            const model: Model = this._aquariumModels[i];\r\n            if (model) {\r\n                this._updateWorldMatrixAndDraw(model);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _drawBackground(): void {\r\n        for (let i: int = MODELNAME.MODELRUINCOlOMN; i <= MODELNAME.MODELSEAWEEDB; ++i) {\r\n            const model: Model = this._aquariumModels[i];\r\n            if (model) {\r\n                model.draw();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateAndDrawFishes(): void {\r\n        const begin: int = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                    ? MODELNAME.MODELSMALLFISHAINSTANCEDDRAWS\r\n                                    : MODELNAME.MODELSMALLFISHA;\r\n        const end: int = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                    ? MODELNAME.MODELBIGFISHBINSTANCEDDRAWS\r\n                                    : MODELNAME.MODELBIGFISHB;\r\n\r\n        for (let i: int = begin; i <= end; ++i) {\r\n            const model: FishModel = this._aquariumModels[i] as FishModel;\r\n\r\n            if (!model) {\r\n                continue;\r\n            }\r\n\r\n            const fishInfo: Fish  = fishTable[i - begin];\r\n            const numFish: int    = this.fishCount[i - begin];\r\n\r\n            model.prepareForDraw();\r\n\r\n            const fishBaseClock: float   = this.g.mclock * g_fishSpeed;\r\n            const fishRadius: float      = fishInfo.radius;\r\n            const fishRadiusRange: float = fishInfo.radiusRange;\r\n            const fishSpeed: float       = fishInfo.speed;\r\n            const fishSpeedRange: float  = fishInfo.speedRange;\r\n            const fishTailSpeed: float   = fishInfo.tailSpeed * g_fishTailSpeed;\r\n            const fishOffset: float      = g_fishOffset;\r\n            // const fishClockSpeed: float  = g_fishSpeed;\r\n            const fishHeight: float      = g_fishHeight + fishInfo.heightOffset;\r\n            const fishHeightRange: float = g_fishHeightRange * fishInfo.heightRange;\r\n            const fishXClock: float      = g_fishXClock;\r\n            const fishYClock: float      = g_fishYClock;\r\n            const fishZClock: float      = g_fishZClock;\r\n\r\n            for (let ii: int = 0; ii < numFish; ++ii) {\r\n                const fishClock: float      = fishBaseClock + ii * fishOffset;\r\n                const speed: float          = fishSpeed + (Matrix.pseudoRandom() * 1.0) * fishSpeedRange;\r\n                const scale: float          = 1.0 + Matrix.pseudoRandom() * 1.0;\r\n                const xRadius: float        = fishRadius + (Matrix.pseudoRandom() * 1.0) * fishRadiusRange;\r\n                const yRadius: float        = 2.0 + (Matrix.pseudoRandom() * 1.0) * fishHeightRange;\r\n                const zRadius: float        = fishRadius + (Matrix.pseudoRandom() * 1.0) * fishRadiusRange;\r\n                const fishSpeedClock: float = fishClock * speed;\r\n                const xClock: float         = fishSpeedClock * fishXClock;\r\n                const yClock: float         = fishSpeedClock * fishYClock;\r\n                const zClock: float         = fishSpeedClock * fishZClock;\r\n\r\n                model.updateFishPerUniforms(\r\n                    Math.sin(xClock) * xRadius, Math.sin(yClock) * yRadius + fishHeight, Math.cos(zClock) * zRadius,\r\n                    Math.sin(xClock - 0.04) * xRadius, Math.sin(yClock - 0.01) * yRadius + fishHeight,\r\n                    Math.cos(zClock - 0.04) * zRadius, scale,\r\n                    (((this.g.mclock + ii * g_tailOffsetMult) * fishTailSpeed * speed) % (Math.PI * 2.0)),\r\n                    ii);\r\n\r\n                model.updatePerInstanceUniforms(this.worldUniforms);\r\n                model.draw();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateBackground(): void {\r\n        for (let i: int = MODELNAME.MODELRUINCOlOMN; i <= MODELNAME.MODELSEAWEEDB; ++i) {\r\n            const model: Model = this._aquariumModels[i];\r\n            if (model) {\r\n                this._updateWorldMatrix(model);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateFishes(): void {\r\n        const begin: int = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                    ? MODELNAME.MODELSMALLFISHAINSTANCEDDRAWS\r\n                                    : MODELNAME.MODELSMALLFISHA;\r\n        const end: int = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                    ? MODELNAME.MODELBIGFISHBINSTANCEDDRAWS\r\n                                    : MODELNAME.MODELBIGFISHB;\r\n\r\n        for (let i: int = begin; i <= end; ++i) {\r\n            const model: FishModel = this._aquariumModels[i] as FishModel;\r\n\r\n            if (!model) {\r\n                continue;\r\n            }\r\n\r\n            const fishInfo: Fish = fishTable[i - begin];\r\n            const numFish: int   = this.fishCount[i - begin];\r\n\r\n            model.prepareForDraw();\r\n\r\n            const fishBaseClock: float   = this.g.mclock * g_fishSpeed;\r\n            const fishRadius: float      = fishInfo.radius;\r\n            const fishRadiusRange: float = fishInfo.radiusRange;\r\n            const fishSpeed: float       = fishInfo.speed;\r\n            const fishSpeedRange: float  = fishInfo.speedRange;\r\n            const fishTailSpeed: float   = fishInfo.tailSpeed * g_fishTailSpeed;\r\n            const fishOffset: float      = g_fishOffset;\r\n            // const fishClockSpeed: float  = g_fishSpeed;\r\n            const fishHeight: float      = g_fishHeight + fishInfo.heightOffset;\r\n            const fishHeightRange: float = g_fishHeightRange * fishInfo.heightRange;\r\n            const fishXClock: float      = g_fishXClock;\r\n            const fishYClock: float      = g_fishYClock;\r\n            const fishZClock: float      = g_fishZClock;\r\n\r\n            for (let ii: int = 0; ii < numFish; ++ii) {\r\n                const fishClock: float      = fishBaseClock + ii * fishOffset;\r\n                const speed: float          = fishSpeed + (Matrix.pseudoRandom() * 1.0) * fishSpeedRange;\r\n                const scale: float          = 1.0 + Matrix.pseudoRandom() * 1.0;\r\n                const xRadius: float        = fishRadius + (Matrix.pseudoRandom() * 1.0) * fishRadiusRange;\r\n                const yRadius: float        = 2.0 + (Matrix.pseudoRandom() * 1.0) * fishHeightRange;\r\n                const zRadius: float        = fishRadius + (Matrix.pseudoRandom() * 1.0) * fishRadiusRange;\r\n                const fishSpeedClock: float = fishClock * speed;\r\n                const xClock: float         = fishSpeedClock * fishXClock;\r\n                const yClock: float         = fishSpeedClock * fishYClock;\r\n                const zClock: float         = fishSpeedClock * fishZClock;\r\n\r\n                model.updateFishPerUniforms(\r\n                    Math.sin(xClock) * xRadius, Math.sin(yClock) * yRadius + fishHeight, Math.cos(zClock) * zRadius,\r\n                    Math.sin(xClock - 0.04) * xRadius, Math.sin(yClock - 0.01) * yRadius + fishHeight,\r\n                    Math.cos(zClock - 0.04) * zRadius, scale,\r\n                    (((this.g.mclock + ii * g_tailOffsetMult) * fishTailSpeed * speed) % (Math.PI * 2.0)),\r\n                    ii);\r\n            }\r\n        }\r\n\r\n        this._context.updateAllFishData();\r\n    }\r\n\r\n    private _drawFishes(): void {\r\n        const begin = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                ? MODELNAME.MODELSMALLFISHAINSTANCEDDRAWS\r\n                                : MODELNAME.MODELSMALLFISHA;\r\n        const end = this.toggleBitset[TOGGLE.ENABLEINSTANCEDDRAWS]\r\n                                ? MODELNAME.MODELBIGFISHBINSTANCEDDRAWS\r\n                                : MODELNAME.MODELBIGFISHB;\r\n\r\n        for (let i: int = begin; i <= end; ++i) {\r\n            const model: FishModel = this._aquariumModels[i] as FishModel;\r\n            if (model) {\r\n                model.draw();\r\n            }            \r\n        }\r\n    }\r\n\r\n    private _updateWorldProjections(w: FloatArray) {\r\n        ASSERT(w.length === 16, \"The length of the array should be equal to 16.\");\r\n        for (let i: uint32_t = 0; i < 16; ++i) {\r\n            this.worldUniforms.world[i] = w[i];\r\n        }\r\n        Matrix.mulMatrixMatrix4(this.worldUniforms.worldViewProjection, this.worldUniforms.world,\r\n                                this.lightWorldPositionUniform.viewProjection);\r\n        Matrix.inverse4(this.g.worldInverse, this.worldUniforms.world);\r\n        Matrix.transpose4(this.worldUniforms.worldInverseTranspose, this.g.worldInverse);\r\n    }\r\n\r\n    private _updateWorldMatrixAndDraw(model: Nullable<Model>): void {\r\n        if (model.worldmatrices.length > 0) {\r\n            for (let world of model.worldmatrices) {\r\n                this._updateWorldProjections(world);\r\n                model.prepareForDraw();\r\n                model.updatePerInstanceUniforms(this.worldUniforms);\r\n                model.draw();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateWorldMatrix(model: Nullable<Model>): void {\r\n        if (model.worldmatrices.length > 0) {\r\n            for (let world of model.worldmatrices) {\r\n                this._updateWorldProjections(world);\r\n                model.updatePerInstanceUniforms(this.worldUniforms);\r\n            }\r\n        }\r\n\r\n        model.prepareForDraw();\r\n    }\r\n\r\n}","import { Aquarium, AquariumOptions } from \"./aquarium\";\r\n\r\nasync function runWebGPUAquarium() {\r\n    const canvas = document.getElementById('gfx') as HTMLCanvasElement;\r\n    const aquarium: Aquarium = new Aquarium();\r\n    const options: AquariumOptions = {\r\n        canvas: canvas,\r\n        enable_full_screen_mode: true,\r\n        num_fish: 50,\r\n        enable_msaa: true,\r\n        buffer_mapping_async: false,\r\n        disable_control_panel: false,\r\n    }\r\n    aquarium.init(options)\r\n        .then((success: boolean) => {\r\n            if (success) {\r\n                aquarium.display();\r\n            }\r\n            else {\r\n                console.error('Unable to initialize aquarium!');\r\n            }\r\n        }) \r\n        .catch((error) => {\r\n            console.error(error); \r\n        });\r\n}\r\n\r\nrunWebGPUAquarium();"],"sourceRoot":""}